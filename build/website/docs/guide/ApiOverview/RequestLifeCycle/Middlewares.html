<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
                    <title>phpDocumentor</title>
    

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <base href="../../../">
    <link rel="icon" href="images/favicon.ico"/>
    <link rel="stylesheet" href="css/normalize.css">
    <link rel="stylesheet" href="css/base.css">
            <link rel="preconnect" href="https://fonts.gstatic.com">
        <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@100;200;300;400;600;700&display=swap" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:wght@400;600;700&display=swap" rel="stylesheet">
        <link rel="stylesheet" href="css/template.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0/css/all.min.css" integrity="sha256-ybRkN9dBjhcS2qrW1z+hfCxq+1aBdwyQM5wlQoQVt/0=" crossorigin="anonymous" />
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/themes/prism-okaidia.css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/plugins/line-numbers/prism-line-numbers.css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/plugins/line-highlight/prism-line-highlight.css">
                <script src="https://cdn.jsdelivr.net/npm/fuse.js@3.4.6"></script>
        <script src="https://cdn.jsdelivr.net/npm/css-vars-ponyfill@2"></script>
        <script src="js/template.js"></script>
        <script src="js/search.js"></script>
        <script defer src="js/searchIndex.js"></script>
    </head>
<body id="top">
    <header class="phpdocumentor-header phpdocumentor-section">
    <h1 class="phpdocumentor-title"><a href="" class="phpdocumentor-title__link">phpDocumentor</a></h1>
    <input class="phpdocumentor-header__menu-button" type="checkbox" id="menu-button" name="menu-button" />
    <label class="phpdocumentor-header__menu-icon" for="menu-button">
        <i class="fas fa-bars"></i>
    </label>
    <section data-search-form class="phpdocumentor-search">
    <label>
        <span class="visually-hidden">Search for</span>
        <svg class="phpdocumentor-search__icon" width="21" height="20" viewBox="0 0 21 20" fill="none" xmlns="http://www.w3.org/2000/svg">
            <circle cx="7.5" cy="7.5" r="6.5" stroke="currentColor" stroke-width="2"/>
            <line x1="12.4892" y1="12.2727" x2="19.1559" y2="18.9393" stroke="currentColor" stroke-width="3"/>
        </svg>
        <input type="search" class="phpdocumentor-field phpdocumentor-search__field" placeholder="Loading .." disabled />
    </label>
</section>

    <nav class="phpdocumentor-topnav">
    <ul class="phpdocumentor-topnav__menu">
        </ul>
</nav>
</header>

    <main class="phpdocumentor">
        <div class="phpdocumentor-section">
            <input class="phpdocumentor-sidebar__menu-button" type="checkbox" id="sidebar-button" name="sidebar-button" />
<label class="phpdocumentor-sidebar__menu-icon" for="sidebar-button">
    Menu
</label>
<aside class="phpdocumentor-column -three phpdocumentor-sidebar">
                    <section class="phpdocumentor-sidebar__category">
            <h2 class="phpdocumentor-sidebar__category-header">typo3-explained</h2>
                                    <h4 class="phpdocumentor-sidebar__root-namespace">
    <a href="guide/Introduction/Index.html#introduction" class="">Introduction</a>
</h4>
    <ul class="phpdocumentor-list">
                    <li>
                <a href="guide/Introduction/Index.html#system-overview-1" class="">System Overview</a>
                
            </li>
                    <li>
                <a href="guide/Introduction/Index.html#a-basic-installation" class="">A basic installation</a>
                
            </li>
            </ul>

                                    <h4 class="phpdocumentor-sidebar__root-namespace">
    <a href="guide/ApiOverview/Index.html#api-a-z" class="">API A-Z</a>
</h4>

                                    <h4 class="phpdocumentor-sidebar__root-namespace">
    <a href="guide/CodingGuidelines/Index.html#cgl" class="">Coding Guidelines</a>
</h4>
    <ul class="phpdocumentor-list">
                    <li>
                <a href="guide/CodingGuidelines/Introduction.html#cgl-introduction" class="">Introduction</a>
                
            </li>
                    <li>
                <a href="guide/CodingGuidelines/CglPhp/Index.html#cgl-php" class="">PHP Coding Guidelines</a>
                
            </li>
                    <li>
                <a href="guide/CodingGuidelines/CglJavaScript/Index.html#cgl-javascript" class="">JavaScript Coding Guidelines</a>
                
            </li>
                    <li>
                <a href="guide/CodingGuidelines/CglTypeScript/Index.html#cgl-typescript" class="">TypeScript Coding Guidelines</a>
                
            </li>
                    <li>
                <a href="guide/CodingGuidelines/CglTypoScript/Index.html#cgl-typoscript" class="">TypoScript Coding Guidelines</a>
                
            </li>
                    <li>
                <a href="guide/CodingGuidelines/CglTsConfig.html#cgl-tsconfig" class="">TSconfig Coding Guidelines</a>
                
            </li>
                    <li>
                <a href="guide/CodingGuidelines/CglXliff/Index.html#cgl-xliff" class="">Xliff Coding Guidelines</a>
                
            </li>
                    <li>
                <a href="guide/CodingGuidelines/CglYaml.html#cgl-yaml" class="">Yaml Coding Guidelines</a>
                
            </li>
                    <li>
                <a href="guide/CodingGuidelines/CglRest/Index.html#cgl-rest" class="">reStructuredText (reST)</a>
                
            </li>
            </ul>

                                    <h4 class="phpdocumentor-sidebar__root-namespace">
    <a href="guide/Configuration/Index.html#configuration" class="">Configuration</a>
</h4>
    <ul class="phpdocumentor-list">
                    <li>
                <a href="guide/Configuration/ConfigurationOverview.html#config-overview" class="">Configuration overview</a>
                
            </li>
                    <li>
                <a href="guide/Configuration/Glossary.html#configuration-classification" class="">Glossary</a>
                
            </li>
                    <li>
                <a href="guide/Configuration/ConfigurationFiles.html#configuration-files" class="">Configuration files</a>
                
            </li>
                    <li>
                <a href="guide/Configuration/ConfigurationModule/Index.html#configuration-module" class="">Configuration module</a>
                
            </li>
                    <li>
                <a href="guide/Configuration/FeatureToggles.html#feature-toggles" class="">Feature toggles</a>
                
            </li>
                    <li>
                <a href="guide/Configuration/GlobalVariables.html#globals-variables" class="">$GLOBALS</a>
                
            </li>
                    <li>
                <a href="guide/Configuration/Typo3ConfVars/Index.html#typo3-conf-vars" class="">TYPO3_CONF_VARS</a>
                
            </li>
                    <li>
                <a href="guide/Configuration/Typo3Information.html#typo3Information" class="">Global meta information about TYPO3</a>
                
            </li>
                    <li>
                <a href="guide/Configuration/Tsconfig.html#tsconfig" class="">TSconfig</a>
                
            </li>
                    <li>
                <a href="guide/Configuration/TypoScriptSyntax/Index.html#typoscript-syntax-about" class="">TypoScript syntax</a>
                
            </li>
                    <li>
                <a href="guide/Configuration/UserSettingsConfiguration/Index.html#user-settings" class="">User settings configuration</a>
                
            </li>
                    <li>
                <a href="guide/Configuration/Yaml/Index.html#yaml" class="">YAML</a>
                
            </li>
            </ul>

                                    <h4 class="phpdocumentor-sidebar__root-namespace">
    <a href="guide/ExtensionArchitecture/Index.html#extension-development" class="">Extension development</a>
</h4>
    <ul class="phpdocumentor-list">
                    <li>
                <a href="guide/ExtensionArchitecture/Concepts/Index.html#extension-concepts" class="">Concepts</a>
                
            </li>
                    <li>
                <a href="guide/ExtensionArchitecture/FileStructure/Index.html#extension-reserved-folders-legacy" class="">File structure</a>
                
            </li>
                    <li>
                <a href="guide/ExtensionArchitecture/HowTo/Index.html#extension-howto" class="">Howto</a>
                
            </li>
                    <li>
                <a href="guide/ExtensionArchitecture/Extbase/Index.html#extbase" class="">Extbase</a>
                
            </li>
                    <li>
                <a href="guide/ExtensionArchitecture/BestPractises/Index.html#extension-Best-practises" class="">Best practises and conventions</a>
                
            </li>
                    <li>
                <a href="guide/ExtensionArchitecture/Tutorials/Index.html#extension-tutorials" class="">Tutorials</a>
                
            </li>
            </ul>

                                    <h4 class="phpdocumentor-sidebar__root-namespace">
    <a href="guide/Security/Index.html#security" class="">Security guidelines</a>
</h4>
    <ul class="phpdocumentor-list">
                    <li>
                <a href="guide/Security/Introduction/Index.html#security-introduction" class="">Introduction</a>
                
            </li>
                    <li>
                <a href="guide/Security/SecurityTeam/Index.html#security-team" class="">The TYPO3 Security Team</a>
                
            </li>
                    <li>
                <a href="guide/Security/GeneralInformation/Index.html#security-general-information" class="">General Information</a>
                
            </li>
                    <li>
                <a href="guide/Security/TypesOfThreats/Index.html#security-threats" class="">Types of Security Threats</a>
                
            </li>
                    <li>
                <a href="guide/Security/GeneralGuidelines/Index.html#security-general-guidelines" class="">General guidelines</a>
                
            </li>
                    <li>
                <a href="guide/Security/GuidelinesAdministrators/Index.html#security-administrators" class="">Guidelines for System Administrators</a>
                
            </li>
                    <li>
                <a href="guide/Security/GuidelinesExtensionDevelopment/Index.html#security-extension-development" class="">Guidelines for extension development</a>
                
            </li>
                    <li>
                <a href="guide/Security/GuidelinesIntegrators/Index.html#security-integrators" class="">Guidelines for TYPO3 integrators</a>
                
            </li>
                    <li>
                <a href="guide/Security/GuidelinesEditors/Index.html#security-editors" class="">Guidelines for editors</a>
                
            </li>
                    <li>
                <a href="guide/Security/Backups/Index.html#security-backups" class="">Backup strategy</a>
                
            </li>
                    <li>
                <a href="guide/Security/HackedSite/Index.html#security-detect-analyze-repair" class="">Detect, analyze and repair a hacked site</a>
                
            </li>
            </ul>

                                    <h4 class="phpdocumentor-sidebar__root-namespace">
    <a href="guide/Testing/Index.html#testing" class="">Testing</a>
</h4>
    <ul class="phpdocumentor-list">
                    <li>
                <a href="guide/Testing/History.html#testing-history" class="">History</a>
                
            </li>
                    <li>
                <a href="guide/Testing/CoreTesting.html#testing-core" class="">Core testing</a>
                
            </li>
                    <li>
                <a href="guide/Testing/ExtensionTesting.html#testing-extensions" class="">Extension testing</a>
                
            </li>
                    <li>
                <a href="guide/Testing/ProjectTesting.html#testing-projects" class="">Project testing</a>
                
            </li>
                    <li>
                <a href="guide/Testing/WritingUnit.html#testing-writing-unit" class="">Writing unit tests</a>
                
            </li>
                    <li>
                <a href="guide/Testing/WritingFunctional.html#testing-writing-functional" class="">Writing functional tests</a>
                
            </li>
                    <li>
                <a href="guide/Testing/WritingAcceptance.html#testing-writing-acceptance" class="">Writing acceptance tests</a>
                
            </li>
                    <li>
                <a href="guide/Testing/Faq.html#testing-faq" class="">FAQ</a>
                
            </li>
            </ul>

                                    <h4 class="phpdocumentor-sidebar__root-namespace">
    <a href="guide/About.html#about" class="">About This Manual</a>
</h4>
    <ul class="phpdocumentor-list">
                    <li>
                <a href="guide/About.html#intended-audience" class="">Intended Audience</a>
                
            </li>
                    <li>
                <a href="guide/About.html#code-examples-1" class="">Code examples</a>
                
            </li>
                    <li>
                <a href="guide/About.html#feedback-and-contribute" class="">Feedback and Contribute</a>
                
            </li>
                    <li>
                <a href="guide/About.html#credits-1" class="">Credits</a>
                
            </li>
                    <li>
                <a href="guide/About.html#dedication-1" class="">Dedication</a>
                
            </li>
            </ul>

                                    <h4 class="phpdocumentor-sidebar__root-namespace">
    <a href="guide/Sitemap.html#sitemap" class="">Sitemap</a>
</h4>

                                    <h4 class="phpdocumentor-sidebar__root-namespace">
    <a href="guide/genindex.html#index" class="">Index</a>
</h4>

                        </section>
            
    <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Reports</h2>
                <h3 class="phpdocumentor-sidebar__root-package"><a href="reports/deprecated.html">Deprecated</a></h3>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="reports/errors.html">Errors</a></h3>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="reports/markers.html">Markers</a></h3>
    </section>

    <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Indices</h2>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="indices/files.html">Files</a></h3>
    </section>
</aside>

            <div class="phpdocumentor-column -nine phpdocumentor-content">
                                        <section>
        
<div class="section" id="request-handling">
    <h1>Middlewares (Request handling)</h1>
            <p>TYPO3 has implemented <a href="https://www.php-fig.org/psr/psr-15/">PSR-15</a> for handling incoming HTTP requests. The
implementation within TYPO3 is often called &quot;Middlewares&quot;, as PSR-15 consists of
two interfaces where one is called Middleware.</p>
            <a id="request-handling-basic-concept"></a>
    </div>
<div class="section" id="basic-concept">
    <h1>Basic concept</h1>
            <p>The most important information is available at
<a href="https://www.php-fig.org/psr/psr-15/">https://www.php-fig.org/psr/psr-15/</a> and <a href="https://www.php-fig.org/psr/psr-15/meta/">https://www.php-fig.org/psr/psr-15/meta/</a>
where the standard itself is explained.</p>
            <p>The idea is to use <a href="https://www.php-fig.org/psr/psr-7/">PSR-7</a> Request and Response as a base, and
wrap the execution with middlewares which implement <a href="https://www.php-fig.org/psr/psr-15/">PSR-15</a>. PSR-15 will receive
the incoming request and return the created response. Within PSR-15 multiple
request handlers and middlewares can be executed. Each of them can adjust the
request and response.</p>
            <a id="request-handling-typo3-implementation"></a>
    </div>
<div class="section" id="typo3-implementation">
    <h1>TYPO3 implementation</h1>
            <p>TYPO3 has implemented the PSR-15 approach in the following way:</p>
            
    
<ol>
    <li>TYPO3 will create a typo3-request.</li>
    <li>TYPO3 will collect and sort all configured PSR-15 middlewares.</li>
    <li>TYPO3 will convert all middlewares to PSR-15 request handlers.</li>
    <li>TYPO3 will call the first middleware with request and the next middleware.</li>
    <li>Each middleware can modify the request if needed, see request-handling-middlewares.</li>
    <li>Final Request is passed to the last RequestHandler (\TYPO3\CMS\Frontend\Http\RequestHandler
or \TYPO3\CMS\Backend\Http\RequestHandler) which generates PSR-7 response and passes
it back to the last middleware.</li>
    <li>Each middleware gets back a PSR-7 response from middleware later in the stack and passes it up the stack to the previous middleware.
Each middleware can modify the response before passing it back.</li>
    <li>This response is passed back to the execution flow.</li>
</ol>
            <a id="request-handling-middlewares"></a>
    </div>
<div class="section" id="middlewares">
    <h1>Middlewares</h1>
            <p>Each middleware has to implement the PSR-15 MiddlewareInterface:</p>
            <pre><code class="language-php">namespace Psr\Http\Server;

use Psr\Http\Message\ResponseInterface;
use Psr\Http\Message\ServerRequestInterface;

/**
 * Participant in processing a server request and response
 *
 * An HTTP middleware component participates in processing an HTTP message:
 * by acting on the request, generating the response, or forwarding the
 * request to a subsequent middleware and possibly acting on its response.
 */
interface MiddlewareInterface
{
    /**
     * Process an incoming server request
     *
     * Processes an incoming server request in order to produce a response.
     * If unable to produce the response itself, it may delegate to the provided
     * request handler to do so.
     */
    public function process(
        ServerRequestInterface $request,
        RequestHandlerInterface $handler
    ): ResponseInterface;
}</code></pre>
            <p>By doing so, the middleware can do one or multiple of the following:</p>
            

<ul>
    <li>Adjust the incoming request, e.g. add further information.</li>
    <li>Create and return a PSR-7 response.</li>
    <li>Call next request handler (which again can be a middleware).</li>
    <li>Adjust response received from the next request handler.</li>
</ul>
            <a id="request-handling-middleware-examples"></a>
    </div>
<div class="section" id="middleware-examples">
    <h1>Middleware examples</h1>
            <p>The following list shows typical use cases for middlewares.</p>
            

<ul>
    <li>A middleware to return a JSON response with localized
strings.</li>
</ul>
            <a id="request-handling-returning-custom-response"></a>
            <div class="section" id="returning-a-custom-response">
    <h2>Returning a custom response</h2>
            <p>This middleware will check whether TYPO3 is in maintenance mode and will return
an unavailable response in that case. Otherwise the next middleware will be
called, and its response is returned instead.</p>
            <pre><code class="language-php">public function process(
    ServerRequestInterface $request,
    RequestHandlerInterface $handler
): ResponseInterface {
    if (/* if logic */) {
        return GeneralUtility::makeInstance(ErrorController::class)
            -&gt;unavailableAction(
                $request,
                &#039;This page is temporarily unavailable.&#039;
            );
    }

    return $handler-&gt;handle($request);
}</code></pre>
            <a id="request-handling-enriching-request"></a>
    </div>
            <div class="section" id="enriching-the-request">
    <h2>Enriching the request</h2>
            <p>The current request can be extended with further information, e.g. the current
resolved site and language could be attached to the request.</p>
            <p>In order to do so, a new request is built with additional attributes, before
calling the next request handler with the enhanced request.</p>
            <pre><code class="language-php">public function process(
    ServerRequestInterface $request,
    RequestHandlerInterface $handler
): ResponseInterface {
    $routeResult = $this-&gt;matcher-&gt;matchRequest($request);

    $request = $request-&gt;withAttribute(&#039;site&#039;, $routeResult-&gt;getSite());
    $request = $request-&gt;withAttribute(&#039;language&#039;, $routeResult-&gt;getLanguage());

    return $handler-&gt;handle($request);
}</code></pre>
            <a id="request-handling-enriching-response"></a>
    </div>
            <div class="section" id="enriching-the-response">
    <h2>Enriching the response</h2>
            <p>This middleware will check the length of generated output, and add a header
with this information to the response.</p>
            <p>In order to do so, the next request handler is called. It will return the generated
response, which can be enriched before it gets returned.</p>
            <p>If you want to modify the response coming from certain middleware,
your middleware has to be configured to be before it.
Order of processing middlewares when enriching response is opposite
to when middlewares are modifying the request.</p>
            <pre><code class="language-php">public function process(
    ServerRequestInterface $request,
    RequestHandlerInterface $handler
): ResponseInterface {
    $response = $handler-&gt;handle($request);

    if (/* if logic */) {
        $response = $response-&gt;withHeader(
            &#039;Content-Length&#039;,
            (string)$response-&gt;getBody()-&gt;getSize()
        );
    }

    return $response;
}</code></pre>
            <a id="request-handling-configuring-middlewares"></a>
    </div>
    </div>
<div class="section" id="configuring-middlewares">
    <h1>Configuring middlewares</h1>
            <p>In order to implement a custom middleware, this middleware has to be configured.
TYPO3 already provides some middlewares out of the box. Beside adding your own
middlewares, it&#039;s also possible to remove existing middlewares from
the configuration.</p>
            <p>The configuration is provided within
Configuration/RequestMiddlewares.php of an extension:</p>
            <pre><code class="language-php">return [
    &#039;frontend&#039; =&gt; [
        &#039;middleware-identifier&#039; =&gt; [
            &#039;target&#039; =&gt; \Vendor\SomeExtension\Middleware\ConcreteClass::class,
            &#039;before&#039; =&gt; [
                &#039;another-middleware-identifier&#039;,
            ],
            &#039;after&#039; =&gt; [
                &#039;yet-another-middleware-identifier&#039;,
            ],
        ],
    ],
    &#039;backend&#039; =&gt; [
        &#039;middleware-identifier&#039; =&gt; [
            &#039;target&#039; =&gt; \Vendor\SomeExtension\Middleware\AnotherConcreteClass::class,
            &#039;before&#039; =&gt; [
                &#039;another-middleware-identifier&#039;,
            ],
            &#039;after&#039; =&gt; [
                &#039;yet-another-middleware-identifier&#039;,
            ],
        ],
    ],
];</code></pre>

            <p>TYPO3 has multiple stacks where one middleware might only be necessary in one
of them. Therefore the configuration defines the context on its first level to define the
context. Within each context the middleware is registered as new subsection with
an unique identifier as key.</p>
            <p>The default stacks are: frontend and backend.</p>
            <p>Each middleware consists of the following options:</p>
            <dl>
                        <dt>target</dt>
        
        <dd><p>PHP string</p><p>FQCN (=Fully Qualified Class Name) to use as middleware.</p></dd>                        <dt>before</dt>
        
        <dd><p>PHP Array</p><p>List of middleware identifiers. The middleware itself is
executed before any other middleware within this array.</p></dd>                        <dt>after</dt>
        
        <dd><p>PHP Array</p><p>List of middleware identifiers. The middleware itself is
executed after any other middleware within this array.</p></dd>                        <dt>disabled</dt>
        
        <dd><p>PHP boolean</p><p>Allows to disable specific middlewares.</p></dd>    </dl>
            <p>The before and after configuration is used to sort middlewares in form of a stack.
You can check the calculated order in the configuration module in TYPO3 Backend.</p>
            <p>Middleware which is configured before another middleware (higher in the stack) wraps execution of following middlewares.
Code written before $handler->handle($request); in the process method can modify
the request before it&#039;s passed to the next middlewares. Code written after $handler->handle($request);
can modify the response provided by next middlewares.</p>
            <p>Middleware which is configured after another (e.g. MiddlewareB from the diagram above),
will see changes to the request made by previous middleware (MiddlewareA),
but will not see changes made to the response from MiddlewareA.</p>
    </div>
<div class="section" id="override-ordering-of-middlewares">
    <h1>Override ordering of middlewares</h1>
            <p>To change the ordering of middlewares shipped by the Core an extension can override the registration in
Configuration/RequestMiddlewares.php:</p>
            <pre><code class="language-php">return [
    &#039;frontend&#039; =&gt; [
        &#039;middleware-identifier&#039; =&gt; [
            &#039;after&#039; =&gt; [
                &#039;another-middleware-identifier&#039;,
            ],
            &#039;before&#039; =&gt; [
                &#039;3rd-middleware-identifier&#039;,
            ]
        ],
    ]
];</code></pre>
            <p>However, this could lead to circular ordering depending on the ordering constraints of other
middlewares. Alternatively an existing middleware can be disabled and reregistered again with a new
identifier. This will circumvent the risk of circularity:</p>
            <pre><code class="language-php">return [
    &#039;frontend&#039; =&gt; [
        &#039;middleware-identifier&#039; =&gt; [
            &#039;disabled&#039; =&gt; true
        ],
        &#039;overwrite-middleware-identifier&#039; =&gt; [
            &#039;target&#039; =&gt; \MyVendor\SomeExtension\Middleware\MyMiddleware::class,
            &#039;after&#039; =&gt; [
                &#039;another-middleware-identifier&#039;,
            ],
            &#039;before&#039; =&gt; [
                &#039;3rd-middleware-identifier&#039;,
            ]
        ]
    ]
];</code></pre>
            <blockquote><p>Always check the integrity of the middleware stack after changing the default ordering.
This can be done in the configuration module that comes with <a href="EXT:lowlevel">EXT:lowlevel</a>.</p></blockquote>
            <a id="request-handling-psr-17"></a>
    </div>
<div class="section" id="creating-new-request-response-objects">
    <h1>Creating new request / response objects</h1>
            <p><a href="https://www.php-fig.org/psr/psr-17/">PSR-17</a> HTTP Factory interfaces are provided by psr/http-factory and should be used as
dependencies for <a href="https://www.php-fig.org/psr/psr-15/">PSR-15</a> request handlers or services that need to create <a href="https://www.php-fig.org/psr/psr-7/">PSR-7</a> message objects.</p>
            <p>It is discouraged to explicitly create <a href="https://www.php-fig.org/psr/psr-7/">PSR-7</a> instances of classes from the \TYPO3\CMS\Core\Http
namespace (they are not public APIs). Instead, use type declarations against <a href="https://www.php-fig.org/psr/psr-17/">PSR-17</a> HTTP Message Factory
interfaces and dependency injection.</p>
            <div class="section" id="example">
    <h2>Example</h2>
            <p>A middleware that needs to send a JSON response when a certain condition is met, uses the
<a href="https://www.php-fig.org/psr/psr-17/">PSR-17</a> response factory interface (the concrete TYPO3 implementation is injected as a constructor
dependency) to create a new <a href="https://www.php-fig.org/psr/psr-7/">PSR-7</a> response object:</p>
            <pre><code class="language-php">use Psr\Http\Message\ResponseFactoryInterface;
use Psr\Http\Message\ResponseInterface;
use Psr\Http\Message\ServerRequestInterface;
use Psr\Http\Server\MiddlewareInterface;
use Psr\Http\Server\RequestHandlerInterface;

class StatusCheckMiddleware implements MiddlewareInterface
{
    /** @var ResponseFactoryInterface */
    private $responseFactory;

    public function __construct(ResponseFactoryInterface $responseFactory)
    {
        $this-&gt;responseFactory = $responseFactory;
    }

    public function process(ServerRequestInterface $request, RequestHandlerInterface $handler): ResponseInterface
    {
        if ($request-&gt;getRequestTarget() === &#039;/check&#039;) {
            $data = [&#039;status&#039; =&gt; &#039;ok&#039;];
            $response = $this-&gt;responseFactory-&gt;createResponse()
                -&gt;withHeader(&#039;Content-Type&#039;, &#039;application/json; charset=utf-8&#039;);
            $response-&gt;getBody()-&gt;write(json_encode($data));
            return $response;
        }
        return $handler-&gt;handle($request);
    }
}</code></pre>
            <a id="request-handling-psr-18"></a>
    </div>
    </div>
<div class="section" id="executing-http-requests-in-middlewares">
    <h1>Executing HTTP requests in middlewares</h1>
            <p>The <a href="https://www.php-fig.org/psr/psr-18/">PSR-18</a> HTTP Client is intended to be used by <a href="https://www.php-fig.org/psr/psr-15/">PSR-15</a> request handlers in order to perform HTTP
requests based on <a href="https://www.php-fig.org/psr/psr-7/">PSR-7</a> message objects without relying on a specific HTTP client implementation.</p>
            <p><a href="https://www.php-fig.org/psr/psr-18/">PSR-18</a> consists of a client interface and three exception interfaces:</p>
            

<ul>
    <li class="dash">\Psr\Http\Client\ClientInterface</li>
    <li class="dash">\Psr\Http\Client\ClientExceptionInterface</li>
    <li class="dash">\Psr\Http\Client\NetworkExceptionInterface</li>
    <li class="dash">\Psr\Http\Client\RequestExceptionInterface</li>
</ul>
            <p>Request handlers use dependency injection to retrieve the concrete implementation
of the <a href="https://www.php-fig.org/psr/psr-18/">PSR-18</a> HTTP client interface \Psr\Http\Client\ClientInterface.</p>
            <p>The <a href="https://www.php-fig.org/psr/psr-18/">PSR-18</a> HTTP Client interface is provided by psr/http-client and may be used as
dependency for services in order to perform HTTP requests using <a href="https://www.php-fig.org/psr/psr-7/">PSR-7</a> request objects.
<a href="https://www.php-fig.org/psr/psr-7/">PSR-7</a> request objects can be created with the PSR-17 Request Factory interface.</p>
            <div class="phpdocumentor-admonition -note">
            <svg class="phpdocumentor-admonition__icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"></path></svg>
                    <article>
        <p>This does not replace the currently available Guzzle wrapper
\TYPO3\CMS\Core\Http\RequestFactory-request(), but is available as a more generic,
framework-agnostic alternative. The PSR-18 interface does not allow you to pass
request-specific guzzle options. But global options defined in $GLOBALS['TYPO3_CONF_VARS']['HTTP']
are taken into account because GuzzleHTTP is used as the backend for this PSR-18 implementation.
The concrete implementation is internal and will be replaced by a native guzzle PSR-18
implementation once it is available.</p>

    </article>
</div>
            <div class="section" id="example-usage">
    <h2>Example usage</h2>
            <p>A middleware might need to request an external service in order to transform the response
into a new response. The PSR-18 HTTP client interface is used to perform the external
HTTP request. The PSR-17 Request Factory Interface is used to create the HTTP request that
the PSR-18 HTTP Client expects. The PSR-7 Response Factory is then used to create a new
response to be returned to the user. All of these interface implementations are injected
as constructor dependencies:</p>
            <pre><code class="language-php">use Psr\Http\Client\ClientInterface;
use Psr\Http\Message\RequestFactoryInterface;
use Psr\Http\Message\ResponseFactoryInterface;
use Psr\Http\Message\ResponseInterface;
use Psr\Http\Message\ServerRequestInterface;
use Psr\Http\Server\MiddlewareInterface;
use Psr\Http\Server\RequestHandlerInterface;

class ExampleMiddleware implements MiddlewareInterface
{
    /** @var ResponseFactory */
    private $responseFactory;

    /** @var RequestFactory */
    private $requestFactory;

    /** @var ClientInterface */
    private $client;

    public function __construct(
        ResponseFactoryInterface $responseFactory,
        RequestFactoryInterface $requestFactory,
        ClientInterface $client
    ) {
        $this-&gt;responseFactory = $responseFactory;
        $this-&gt;requestFactory = $requestFactory;
        $this-&gt;client = $client;
    }

    public function process(ServerRequestInterface $request, RequestHandlerInterface $handler): ResponseInterface
    {
        if ($request-&gt;getRequestTarget() === &#039;/example&#039;) {
            $req = $this-&gt;requestFactory-&gt;createRequest(&#039;GET&#039;, &#039;https://api.external.app/endpoint.json&#039;);
            // Perform HTTP request
            $res = $this-&gt;client-&gt;sendRequest($req);
            // Process data
            $data = [
                &#039;content&#039; =&gt; json_decode((string)$res-&gt;getBody())
            ];
            $response = $this-&gt;responseFactory-&gt;createResponse()
                -&gt;withHeader(&#039;Content-Type&#039;, &#039;application/json; charset=utf-8&#039;);
            $response-&gt;getBody()-&gt;write(json_encode($data));
            return $response;
        }
        return $handler-&gt;handle($request);
    }
}</code></pre>
            <a id="request-handling-debugging"></a>
    </div>
    </div>
<div class="section" id="debugging">
    <h1>Debugging</h1>
            <p>In order to see which middlewares are configured and to see the order of
execution, TYPO3 offers a the menu entry HTTP Middlewares (PSR-15)
within the &quot;Configuration&quot; module:</p>
            <figure>
    <img
    src="./Images/AutomaticScreenshots/RequestHandling/ConfigurationMiddleware.png"
                        />

            
                    <figcaption><p>TYPO3 configuration module listing configured middlewares.</p>
</figcaption>
            </figure>

    </div>

    </section>
                            </div>
            <section data-search-results class="phpdocumentor-search-results phpdocumentor-search-results--hidden">
    <section class="phpdocumentor-search-results__dialog">
        <header class="phpdocumentor-search-results__header">
            <h2 class="phpdocumentor-search-results__title">Search results</h2>
            <button class="phpdocumentor-search-results__close"><i class="fas fa-times"></i></button>
        </header>
        <section class="phpdocumentor-search-results__body">
            <ul class="phpdocumentor-search-results__entries"></ul>
        </section>
    </section>
</section>
        </div>
        <a href="guide/ApiOverview/RequestLifeCycle/Middlewares.html#top" class="phpdocumentor-back-to-top"><i class="fas fa-chevron-circle-up"></i></a>

    </main>

    <script>
        cssVars({});
    </script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/prism.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/plugins/line-numbers/prism-line-numbers.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/plugins/line-highlight/prism-line-highlight.min.js"></script>
</body>
</html>