<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
                    <title>phpDocumentor</title>
    

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <base href="../../../../">
    <link rel="icon" href="images/favicon.ico"/>
    <link rel="stylesheet" href="css/normalize.css">
    <link rel="stylesheet" href="css/base.css">
            <link rel="preconnect" href="https://fonts.gstatic.com">
        <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@100;200;300;400;600;700&display=swap" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:wght@400;600;700&display=swap" rel="stylesheet">
        <link rel="stylesheet" href="css/template.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0/css/all.min.css" integrity="sha256-ybRkN9dBjhcS2qrW1z+hfCxq+1aBdwyQM5wlQoQVt/0=" crossorigin="anonymous" />
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/themes/prism-okaidia.css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/plugins/line-numbers/prism-line-numbers.css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/plugins/line-highlight/prism-line-highlight.css">
                <script src="https://cdn.jsdelivr.net/npm/fuse.js@3.4.6"></script>
        <script src="https://cdn.jsdelivr.net/npm/css-vars-ponyfill@2"></script>
        <script src="js/template.js"></script>
        <script src="js/search.js"></script>
        <script defer src="js/searchIndex.js"></script>
    </head>
<body id="top">
    <header class="phpdocumentor-header phpdocumentor-section">
    <h1 class="phpdocumentor-title"><a href="" class="phpdocumentor-title__link">phpDocumentor</a></h1>
    <input class="phpdocumentor-header__menu-button" type="checkbox" id="menu-button" name="menu-button" />
    <label class="phpdocumentor-header__menu-icon" for="menu-button">
        <i class="fas fa-bars"></i>
    </label>
    <section data-search-form class="phpdocumentor-search">
    <label>
        <span class="visually-hidden">Search for</span>
        <svg class="phpdocumentor-search__icon" width="21" height="20" viewBox="0 0 21 20" fill="none" xmlns="http://www.w3.org/2000/svg">
            <circle cx="7.5" cy="7.5" r="6.5" stroke="currentColor" stroke-width="2"/>
            <line x1="12.4892" y1="12.2727" x2="19.1559" y2="18.9393" stroke="currentColor" stroke-width="3"/>
        </svg>
        <input type="search" class="phpdocumentor-field phpdocumentor-search__field" placeholder="Loading .." disabled />
    </label>
</section>

    <nav class="phpdocumentor-topnav">
    <ul class="phpdocumentor-topnav__menu">
        </ul>
</nav>
</header>

    <main class="phpdocumentor">
        <div class="phpdocumentor-section">
            <input class="phpdocumentor-sidebar__menu-button" type="checkbox" id="sidebar-button" name="sidebar-button" />
<label class="phpdocumentor-sidebar__menu-icon" for="sidebar-button">
    Menu
</label>
<aside class="phpdocumentor-column -three phpdocumentor-sidebar">
                    <section class="phpdocumentor-sidebar__category">
            <h2 class="phpdocumentor-sidebar__category-header">typo3-explained</h2>
                                    <h4 class="phpdocumentor-sidebar__root-namespace">
    <a href="guide/Introduction/Index.html#introduction" class="">Introduction</a>
</h4>
    <ul class="phpdocumentor-list">
                    <li>
                <a href="guide/Introduction/Index.html#system-overview-1" class="">System Overview</a>
                
            </li>
                    <li>
                <a href="guide/Introduction/Index.html#a-basic-installation" class="">A basic installation</a>
                
            </li>
            </ul>

                                    <h4 class="phpdocumentor-sidebar__root-namespace">
    <a href="guide/ApiOverview/Index.html#api-a-z" class="">API A-Z</a>
</h4>

                                    <h4 class="phpdocumentor-sidebar__root-namespace">
    <a href="guide/CodingGuidelines/Index.html#cgl" class="">Coding Guidelines</a>
</h4>
    <ul class="phpdocumentor-list">
                    <li>
                <a href="guide/CodingGuidelines/Introduction.html#cgl-introduction" class="">Introduction</a>
                
            </li>
                    <li>
                <a href="guide/CodingGuidelines/CglPhp/Index.html#cgl-php" class="">PHP Coding Guidelines</a>
                
            </li>
                    <li>
                <a href="guide/CodingGuidelines/CglJavaScript/Index.html#cgl-javascript" class="">JavaScript Coding Guidelines</a>
                
            </li>
                    <li>
                <a href="guide/CodingGuidelines/CglTypeScript/Index.html#cgl-typescript" class="">TypeScript Coding Guidelines</a>
                
            </li>
                    <li>
                <a href="guide/CodingGuidelines/CglTypoScript/Index.html#cgl-typoscript" class="">TypoScript Coding Guidelines</a>
                
            </li>
                    <li>
                <a href="guide/CodingGuidelines/CglTsConfig.html#cgl-tsconfig" class="">TSconfig Coding Guidelines</a>
                
            </li>
                    <li>
                <a href="guide/CodingGuidelines/CglXliff/Index.html#cgl-xliff" class="">Xliff Coding Guidelines</a>
                
            </li>
                    <li>
                <a href="guide/CodingGuidelines/CglYaml.html#cgl-yaml" class="">Yaml Coding Guidelines</a>
                
            </li>
                    <li>
                <a href="guide/CodingGuidelines/CglRest/Index.html#cgl-rest" class="">reStructuredText (reST)</a>
                
            </li>
            </ul>

                                    <h4 class="phpdocumentor-sidebar__root-namespace">
    <a href="guide/Configuration/Index.html#configuration" class="">Configuration</a>
</h4>
    <ul class="phpdocumentor-list">
                    <li>
                <a href="guide/Configuration/ConfigurationOverview.html#config-overview" class="">Configuration overview</a>
                
            </li>
                    <li>
                <a href="guide/Configuration/Glossary.html#configuration-classification" class="">Glossary</a>
                
            </li>
                    <li>
                <a href="guide/Configuration/ConfigurationFiles.html#configuration-files" class="">Configuration files</a>
                
            </li>
                    <li>
                <a href="guide/Configuration/ConfigurationModule/Index.html#configuration-module" class="">Configuration module</a>
                
            </li>
                    <li>
                <a href="guide/Configuration/FeatureToggles.html#feature-toggles" class="">Feature toggles</a>
                
            </li>
                    <li>
                <a href="guide/Configuration/GlobalVariables.html#globals-variables" class="">$GLOBALS</a>
                
            </li>
                    <li>
                <a href="guide/Configuration/Typo3ConfVars/Index.html#typo3-conf-vars" class="">TYPO3_CONF_VARS</a>
                
            </li>
                    <li>
                <a href="guide/Configuration/Typo3Information.html#typo3Information" class="">Global meta information about TYPO3</a>
                
            </li>
                    <li>
                <a href="guide/Configuration/Tsconfig.html#tsconfig" class="">TSconfig</a>
                
            </li>
                    <li>
                <a href="guide/Configuration/TypoScriptSyntax/Index.html#typoscript-syntax-about" class="">TypoScript syntax</a>
                
            </li>
                    <li>
                <a href="guide/Configuration/UserSettingsConfiguration/Index.html#user-settings" class="">User settings configuration</a>
                
            </li>
                    <li>
                <a href="guide/Configuration/Yaml/Index.html#yaml" class="">YAML</a>
                
            </li>
            </ul>

                                    <h4 class="phpdocumentor-sidebar__root-namespace">
    <a href="guide/ExtensionArchitecture/Index.html#extension-development" class="">Extension development</a>
</h4>
    <ul class="phpdocumentor-list">
                    <li>
                <a href="guide/ExtensionArchitecture/Concepts/Index.html#extension-concepts" class="">Concepts</a>
                
            </li>
                    <li>
                <a href="guide/ExtensionArchitecture/FileStructure/Index.html#extension-reserved-folders-legacy" class="">File structure</a>
                
            </li>
                    <li>
                <a href="guide/ExtensionArchitecture/HowTo/Index.html#extension-howto" class="">Howto</a>
                
            </li>
                    <li>
                <a href="guide/ExtensionArchitecture/Extbase/Index.html#extbase" class="">Extbase</a>
                
            </li>
                    <li>
                <a href="guide/ExtensionArchitecture/BestPractises/Index.html#extension-Best-practises" class="">Best practises and conventions</a>
                
            </li>
                    <li>
                <a href="guide/ExtensionArchitecture/Tutorials/Index.html#extension-tutorials" class="">Tutorials</a>
                
            </li>
            </ul>

                                    <h4 class="phpdocumentor-sidebar__root-namespace">
    <a href="guide/Security/Index.html#security" class="">Security guidelines</a>
</h4>
    <ul class="phpdocumentor-list">
                    <li>
                <a href="guide/Security/Introduction/Index.html#security-introduction" class="">Introduction</a>
                
            </li>
                    <li>
                <a href="guide/Security/SecurityTeam/Index.html#security-team" class="">The TYPO3 Security Team</a>
                
            </li>
                    <li>
                <a href="guide/Security/GeneralInformation/Index.html#security-general-information" class="">General Information</a>
                
            </li>
                    <li>
                <a href="guide/Security/TypesOfThreats/Index.html#security-threats" class="">Types of Security Threats</a>
                
            </li>
                    <li>
                <a href="guide/Security/GeneralGuidelines/Index.html#security-general-guidelines" class="">General guidelines</a>
                
            </li>
                    <li>
                <a href="guide/Security/GuidelinesAdministrators/Index.html#security-administrators" class="">Guidelines for System Administrators</a>
                
            </li>
                    <li>
                <a href="guide/Security/GuidelinesExtensionDevelopment/Index.html#security-extension-development" class="">Guidelines for extension development</a>
                
            </li>
                    <li>
                <a href="guide/Security/GuidelinesIntegrators/Index.html#security-integrators" class="">Guidelines for TYPO3 integrators</a>
                
            </li>
                    <li>
                <a href="guide/Security/GuidelinesEditors/Index.html#security-editors" class="">Guidelines for editors</a>
                
            </li>
                    <li>
                <a href="guide/Security/Backups/Index.html#security-backups" class="">Backup strategy</a>
                
            </li>
                    <li>
                <a href="guide/Security/HackedSite/Index.html#security-detect-analyze-repair" class="">Detect, analyze and repair a hacked site</a>
                
            </li>
            </ul>

                                    <h4 class="phpdocumentor-sidebar__root-namespace">
    <a href="guide/Testing/Index.html#testing" class="">Testing</a>
</h4>
    <ul class="phpdocumentor-list">
                    <li>
                <a href="guide/Testing/History.html#testing-history" class="">History</a>
                
            </li>
                    <li>
                <a href="guide/Testing/CoreTesting.html#testing-core" class="">Core testing</a>
                
            </li>
                    <li>
                <a href="guide/Testing/ExtensionTesting.html#testing-extensions" class="">Extension testing</a>
                
            </li>
                    <li>
                <a href="guide/Testing/ProjectTesting.html#testing-projects" class="">Project testing</a>
                
            </li>
                    <li>
                <a href="guide/Testing/WritingUnit.html#testing-writing-unit" class="">Writing unit tests</a>
                
            </li>
                    <li>
                <a href="guide/Testing/WritingFunctional.html#testing-writing-functional" class="">Writing functional tests</a>
                
            </li>
                    <li>
                <a href="guide/Testing/WritingAcceptance.html#testing-writing-acceptance" class="">Writing acceptance tests</a>
                
            </li>
                    <li>
                <a href="guide/Testing/Faq.html#testing-faq" class="">FAQ</a>
                
            </li>
            </ul>

                                    <h4 class="phpdocumentor-sidebar__root-namespace">
    <a href="guide/About.html#about" class="">About This Manual</a>
</h4>
    <ul class="phpdocumentor-list">
                    <li>
                <a href="guide/About.html#intended-audience" class="">Intended Audience</a>
                
            </li>
                    <li>
                <a href="guide/About.html#code-examples-1" class="">Code examples</a>
                
            </li>
                    <li>
                <a href="guide/About.html#feedback-and-contribute" class="">Feedback and Contribute</a>
                
            </li>
                    <li>
                <a href="guide/About.html#credits-1" class="">Credits</a>
                
            </li>
                    <li>
                <a href="guide/About.html#dedication-1" class="">Dedication</a>
                
            </li>
            </ul>

                                    <h4 class="phpdocumentor-sidebar__root-namespace">
    <a href="guide/Sitemap.html#sitemap" class="">Sitemap</a>
</h4>

                                    <h4 class="phpdocumentor-sidebar__root-namespace">
    <a href="guide/genindex.html#index" class="">Index</a>
</h4>

                        </section>
            
    <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Reports</h2>
                <h3 class="phpdocumentor-sidebar__root-package"><a href="reports/deprecated.html">Deprecated</a></h3>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="reports/errors.html">Errors</a></h3>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="reports/markers.html">Markers</a></h3>
    </section>

    <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Indices</h2>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="indices/files.html">Files</a></h3>
    </section>
</aside>

            <div class="phpdocumentor-column -nine phpdocumentor-content">
                                        <section>
        
<a id="tce-database-basics"></a>
<div class="section" id="datahandler-basics">
    <h1>Database: DataHandler basics (Formerly Known as TCEmain)</h1>
            <p>When you are using TCE from your backend applications you need to
prepare two arrays of information which contain the instructions to
DataHandler (\TYPO3\CMS\Core\DataHandling\DataHandler)
of what actions to perform. They fall into two categories:
data and commands.</p>
            <p>&quot;Data&quot; is when you want to write information to a database table or
create a new record.</p>
            <p>&quot;Commands&quot; is when you want to move, copy or delete a record in the
system.</p>
            <p>The data and commands are created as multidimensional arrays and to
understand the API of DataHandler you need to understand the
hierarchy of these two arrays.</p>
            <div class="phpdocumentor-admonition -caution">
                <svg class="phpdocumentor-admonition__icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg>
                <article>
        <p>The DataHandler needs a properly configured TCA. If your field
is not configured in the TCA the DataHandler will not be able to
interact with it. This also is the case if you configured
&quot;type&quot;=&quot;none&quot; (which is in fact a valid type) or if an invalid
type is specified. In that case the DataHandler is not
able to determine the correct value of the field.</p>

    </article>
</div>
            <a id="tce-commands"></a>
    </div>
<div class="section" id="basic-usage">
    <h1>Basic Usage</h1>
            <pre><code class="language-php">use TYPO3\CMS\Core\Utility\GeneralUtility;
use TYPO3\CMS\Core\DataHandling\DataHandler;

$dataHandler = GeneralUtility::makeInstance(DataHandler::class);

$cmd = [];
$data = [];
$dataHandler-&gt;start($data, $cmd);</code></pre>
    </div>
<div class="section" id="commands-array">
    <h1>Commands array</h1>
            <p>Syntax:</p>
            <pre><code class="language-none">$cmd[ tablename ][ uid ][ command ] = value</code></pre>
            <p>Description of keywords in syntax:</p>
            <p>:header-rows: 1</p>
            <blockquote>

<ul>
    <li class="dash">:Key,20: Key
:Type,20: Data type
:Description,60: Description</li>
    <li class="dash"><dl>
                        <dt>:Key:</dt>
        
        <dd>tablename</dd>                        <dt>:Type:</dt>
        
        <dd>string</dd>                        <dt>:Description:</dt>
        
        <dd>Name of the database table. Must be configured in $GLOBALS['TCA'] array,
otherwise it cannot be processed.</dd>    </dl></li>
    <li class="dash"><dl>
                        <dt>:Key:</dt>
        
        <dd>uid</dd>                        <dt>:Type:</dt>
        
        <dd>integer</dd>                        <dt>:Description:</dt>
        
        <dd>The UID of the record that is manipulated. This is always an integer.</dd>    </dl></li>
    <li class="dash"><dl>
                        <dt>:Key:</dt>
        
        <dd>command</dd>                        <dt>:Type:</dt>
        
        <dd>string (command keyword)</dd>                        <dt>:Description:</dt>
        
        <dd><p>The command type you want to execute.</p><div class="phpdocumentor-admonition -note">
            <svg class="phpdocumentor-admonition__icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"></path></svg>
                    <article>
        <p>record! The first command in the array will be taken.</p>

    </article>
</div><p>See table below for command keywords and values</p></dd>    </dl></li>
    <li class="dash"><dl>
                        <dt>:Key:</dt>
        
        <dd>value</dd>                        <dt>:Type:</dt>
        
        <dd>mixed</dd>                        <dt>:Description:</dt>
        
        <dd><p>The value for the command</p><p>See table below for command keywords and values</p></dd>    </dl></li>
</ul></blockquote>
            <a id="tce-command-keywords"></a>
            <div class="section" id="command-keywords-and-values">
    <h2>Command keywords and values</h2>
            <p>:header-rows: 1</p>
            <blockquote>

<ul>
    <li class="dash">:Command,20: Command
:Type,20: Data type
:Value,60: Value</li>
    <li class="dash"><dl>
                        <dt>:Command:</dt>
        
        <dd>copy</dd>                        <dt>:Type:</dt>
        
        <dd>integer</dd>                        <dt>:Value:</dt>
        
        <dd><p>The significance of the value depends on whether it is positive or
negative:</p>

<ul>
    <li class="dash">Positive value: The value points to a page UID. A copy of the record
(and possibly child elements/tree below) will be inserted inside that
page as the first element.</li>
    <li class="dash">Negative value$GLOBALS['TCA'][...]['ctrl']['sortby'] is
set, then it will be positioned <em>after</em>.</li>
    <li class="dash">Zero value: Record is inserted on tree root level.</li>
    <li class="dash"><p>array: The array has to contain the integer value as in examples above and
may contain field =&gt; value pairs for updates. The array is structured
like:</p><pre><code class="language-php">[
   &#039;action&#039; =&gt; &#039;paste&#039;, // &#039;paste&#039; is used for both move and copy commands
   &#039;target&#039; =&gt; $pUid, // Defines the page to insert the record, or record uid to copy after
   &#039;update&#039; =&gt; $update, // Array with field =&gt; value to be updated.
]</code></pre></li>
</ul></dd>    </dl></li>
    <li class="dash"><dl>
                        <dt>:Command:</dt>
        
        <dd>move</dd>                        <dt>:Type:</dt>
        
        <dd>integer</dd>                        <dt>:Value:</dt>
        
        <dd>Works like &quot;copy&quot; but moves the record instead of making a copy.</dd>    </dl></li>
    <li class="dash"><dl>
                        <dt>:Command:</dt>
        
        <dd>delete</dd>                        <dt>:Type:</dt>
        
        <dd>1</dd>                        <dt>:Value:</dt>
        
        <dd><p>Value should always be &quot;1&quot;</p><p>This action will delete the record (or mark the record &quot;deleted&quot; if
configured in $GLOBALS['TCA']).</p></dd>    </dl></li>
    <li class="dash"><dl>
                        <dt>:Command:</dt>
        
        <dd>undelete</dd>                        <dt>:Type:</dt>
        
        <dd>1</dd>                        <dt>:Value:</dt>
        
        <dd><p>Value should always be &quot;1&quot;.</p><p>This action will set the deleted-flag back to 0.</p></dd>    </dl></li>
    <li class="dash"><dl>
                        <dt>:Command:</dt>
        
        <dd>localize</dd>                        <dt>:Type:</dt>
        
        <dd>integer</dd>                        <dt>:Value:</dt>
        
        <dd><p>Value is an uid of the sys_language to localize the record into.
Basically a localization of a record is making a copy of the record
(possibly excluding certain fields defined with l10n_mode) but
changing relevant fields to point to the right sys_language / original
language record.</p><p>Requirements for a successful localization is this:</p>

<ul>
    <li class="dash">[ctrl] options &quot;languageField&quot; and &quot;transOrigPointerField&quot; must be
defined for the table</li>
    <li class="dash">A sys_language record with the given sys_language_uid must
exist.</li>
    <li class="dash">The record to be localized by currently be set to &quot;Default&quot; language
and not have any value set for the TCA transOrigPointerField either.</li>
    <li class="dash">There cannot exist another localization to the given language for the
record (looking in the original record PID).</li>
</ul><p>Apart from this, ordinary permissions apply as if the user wants to
make a copy of the record on the same page.</p><p>The localize DataHandler command should be used when translating records in &quot;Connected Mode&quot;
(strict translation of records from the default language).
This command is used when selecting the &quot;Translate&quot; strategy in the content elements translation wizard.</p></dd>    </dl></li>
    <li class="dash"><dl>
                        <dt>:Command:</dt>
        
        <dd>copyToLanguage</dd>                        <dt>:Type:</dt>
        
        <dd>integer</dd>                        <dt>:Value:</dt>
        
        <dd><p>It behaves like localize command (both record and child records are copied to given language),
but does not set transOrigPointerField fields (e.g. l10n_parent).</p><p>The copyToLanguage command should be used when localizing records in the &quot;Free Mode&quot;.
This command is used when localizing content elements using translation wizard&#039;s &quot;Copy&quot; strategy.</p></dd>    </dl></li>
    <li class="dash"><dl>
                        <dt>:Command:</dt>
        
        <dd>inlineLocalizeSynchronize</dd>                        <dt>:Type:</dt>
        
        <dd>array</dd>                        <dt>:Value:</dt>
        
        <dd><p>Performs localization or synchronization of child records.
The command structure is like:</p><pre><code class="language-php">$cmd[&#039;tt_content&#039;][13][&#039;inlineLocalizeSynchronize&#039;] = [ // 13 is a parent record uid
  &#039;field&#039; =&gt; &#039;tx_myfieldname&#039;, // field we want to synchronize
  &#039;language&#039; =&gt; 2, // uid of the target language
  // either the key &#039;action&#039; or &#039;ids&#039; must be set
  &#039;action&#039; =&gt; &#039;localize&#039; // or &#039;synchronize&#039;
  &#039;ids&#039; =&gt;  [1, 2, 3] // array of child-ids to be localized
]</code></pre></dd>    </dl></li>
    <li class="dash"><dl>
                        <dt>:Command:</dt>
        
        <dd>version</dd>                        <dt>:Type:</dt>
        
        <dd>array</dd>                        <dt>:Value:</dt>
        
        <dd><p>Versioning action.</p><p><strong>Keys:</strong></p>

<ul>
    <li class="dash"><p>[action] : Keyword determining the versioning action. Options are:</p>

<ul>
    <li class="dash"><p>&quot;new&quot;: Indicates that a new version of the record should be
created.Additional keys, specific for &quot;new&quot; action:</p>

<ul>
    <li class="dash">[treeLevels]versioning_followPages )&gt;0
(&quot;branch&quot;) means the the whole branch is versioned ( <em>full copy</em> of
all tables), down to the level indicated by the value (1= 1 level
down, 2= 2 levels down, etc.). The treeLevel is recorded in the field
t3ver_swapmode and will be observed when the record is swapped
during publishing.</li>
    <li class="dash">[label]: Indicates the version label to apply. If not given, a
standard label including version number and date is added.</li>
</ul></li>
    <li class="dash"><p>&quot;swap&quot;: Indicates that the current online version should be swapped
with another.Additional keys, specific for &quot;swap&quot; action:</p>

<ul>
    <li class="dash">[swapWith]: Indicates the uid of the record to swap current version
with!</li>
    <li class="dash">[swapIntoWS]: Boolean, indicates that when a version is published it
should be swapped into the workspace of the offline record.</li>
</ul></li>
    <li class="dash">&quot;clearWSID&quot;: Indicates that the workspace of the record should be set
to zero (0). This removes versions out of workspaces without
publishing them.</li>
    <li class="dash">&quot;flush&quot;: Completely deletes a version without publishing it.</li>
    <li class="dash"><p>&quot;setStage&quot;The id-
key in the array can be a comma list of ids in order to perform the
stageChange over a number of records. Also, the internal variable
-generalComment (also available through /record/commit route as
&generalComment) can be used to set a default comment for all stage
changes of an instance of the data handler.* Additional keys for this action
are:</p>

<ul>
    <li class="dash">[stageId]: Values are: -1 (rejected), 0 (editing, default), 1 (review), 10 (publish)</li>
    <li class="dash">[comment]: Comment string that goes into the log.</li>
</ul></li>
</ul></li>
</ul></dd>    </dl></li>
</ul></blockquote>
            <a id="tce-command-examples"></a>
    </div>
            <div class="section" id="examples-of-commands">
    <h2>Examples of commands:</h2>
            <pre><code class="language-php">$cmd[&#039;tt_content&#039;][54][&#039;delete&#039;] = 1;    // Deletes tt_content record with uid=54
$cmd[&#039;tt_content&#039;][1203][&#039;copy&#039;] = -303; // Copies tt_content uid=1203 to the position after tt_content uid=303 (new record will have the same pid as tt_content uid=1203)
$cmd[&#039;tt_content&#039;][1203][&#039;copy&#039;] = 400;  // Copies tt_content uid=1203 to first position in page uid=400
$cmd[&#039;tt_content&#039;][1203][&#039;move&#039;] = 400;  // Moves tt_content uid=1203 to the first position in page uid=400</code></pre>
            <a id="tce-data"></a>
    </div>
            <div class="section" id="accessing-the-uid-of-copied-records">
    <h2>Accessing the uid of copied records:</h2>
            <p>The DataHandler keeps track of records created by copy
operations in its $copyMappingArray_merged property. This
property is public but marked as @internal. So it is subject to change
in future TYPO3 versions without notice.</p>
            <p>The $copyMappingArray_merged property can be used to determine the UID
of a record copy based on the UID of the copied record.</p>
            <div class="phpdocumentor-admonition -caution">
                <svg class="phpdocumentor-admonition__icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg>
                <article>
        <p>The $copyMappingArray_merged property should not be mixed up with
the $copyMappingArray property which contains only information
about the last copy operation and is cleared between each operation.</p>

    </article>
</div>
            <p>The structure of the $copyMappingArray_merged property looks like this:</p>
            <pre><code class="language-php">$copyMappingArray_merged = [
   &lt;table&gt; =&gt; [
      &lt;original-record-uid&gt; =&gt; &lt;record-copy-uid&gt;,
   ],
];</code></pre>
            <p>The property contains the names of the manipulated tables as keys and a map
of original record UIDs and UIDs of record copies as values.</p>
            <pre><code class="language-php">$cmd[&#039;tt_content&#039;][1203][&#039;copy&#039;] = 400;  // Copies tt_content uid=1203 to first position in page uid=400
$dataHandler-&gt;start([], $cmd);
$dataHandler-&gt;process_cmdmap()

$uid = $dataHandler-&gt;copyMappingArray_merged[&#039;tt_content&#039;][1203];</code></pre>
    </div>
    </div>
<div class="section" id="data-array">
    <h1>Data Array</h1>
            <p>Syntaxuid]['</p>
            <p>Description of keywords in syntax:</p>
            <p>:header-rows: 1</p>
            <blockquote>

<ul>
    <li class="dash">:Key,20: Key
:Type,20: Data type
:Description,60: Description</li>
    <li class="dash"><dl>
                        <dt>:Key:</dt>
        
        <dd>tablename</dd>                        <dt>:Type:</dt>
        
        <dd>string</dd>                        <dt>:Description:</dt>
        
        <dd>Name of the database table. Must be configured in $GLOBALS['TCA'] array,
otherwise it cannot be processed.</dd>    </dl></li>
    <li class="dash"><dl>
                        <dt>:Key:</dt>
        
        <dd>uid</dd>                        <dt>:Type:</dt>
        
        <dd>mixed</dd>                        <dt>:Description:</dt>
        
        <dd><p>The UID of the record that is modified. If the record already exists,
this is an integer.</p><p>If you&#039;re creating new records, use a random string prefixed with NEW, e.g. NEW7342abc5e6d.
You can use static strings (NEW1, NEW2, ...) or generate them using StringUtility::getUniqueId('NEW').</p></dd>    </dl></li>
    <li class="dash"><dl>
                        <dt>:Key:</dt>
        
        <dd>fieldname</dd>                        <dt>:Type:</dt>
        
        <dd>string</dd>                        <dt>:Description:</dt>
        
        <dd>Name of the database field you want to set a value for. Must be
configured in $GLOBALS['TCA'][*tablename*]['columns'].</dd>    </dl></li>
    <li class="dash"><dl>
                        <dt>:Key:</dt>
        
        <dd>value</dd>                        <dt>:Type:</dt>
        
        <dd>string</dd>                        <dt>:Description:</dt>
        
        <dd><p>Value for &quot;fieldname&quot;.</p><p>For fields of type <code>inline</code> this is a comma separated list (CSV) of UIDs of
referenced records.</p></dd>    </dl></li>
</ul></blockquote>
            <div class="phpdocumentor-admonition -note">
            <svg class="phpdocumentor-admonition__icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"></path></svg>
                    <article>
        <p>For FlexForms the data array of the FlexForm field is
deeper than three levels. The number of possible levels for FlexForms
is infinite and defined by the data structure of the FlexForm. But
FlexForm fields always end with a &quot;regular value&quot; of course.</p>

    </article>
</div>
            <a id="tce-data-examples"></a>
            <div class="section" id="examples-of-data-submission">
    <h2>Examples of data submission</h2>
            <p>This creates a new page titled &quot;The page title&quot; as the first page
inside page id 45:</p>
            <pre><code class="language-php">$data[&#039;pages&#039;][&#039;NEW9823be87&#039;] = [
   &#039;title&#039; =&gt; &#039;The page title&#039;,
   &#039;subtitle&#039; =&gt; &#039;Other title stuff&#039;,
   &#039;pid&#039; =&gt; &#039;45&#039;
];</code></pre>
            <p>This creates a new page titled &quot;The page title&quot; right after page id 45
in the tree:</p>
            <pre><code class="language-php">$data[&#039;pages&#039;][&#039;NEW9823be87&#039;] = [
   &#039;title&#039; =&gt; &#039;The page title&#039;,
   &#039;subtitle&#039; =&gt; &#039;Other title stuff&#039;,
   &#039;pid&#039; =&gt; &#039;-45&#039;
];</code></pre>
            <p>This creates two new pages right after each other, located right after
the page id 45:</p>
            <pre><code class="language-php">$data[&#039;pages&#039;][&#039;NEW9823be87&#039;] = [
   &#039;title&#039; =&gt; &#039;Page 1&#039;,
   &#039;pid&#039; =&gt; &#039;-45&#039;
];
$data[&#039;pages&#039;][&#039;NEWbe68s587&#039;] = [
   &#039;title&#039; =&gt; &#039;Page 2&#039;,
   &#039;pid&#039; =&gt; &#039;-NEW9823be87&#039;
];</code></pre>
            <p>Notice how the second &quot;pid&quot; value points to the &quot;NEW...&quot; id
placeholder of the first record. This works because the new id of the
first record can be accessed by the second record. However it works
only when the order in the array is as above since the processing
happens in that order!</p>
            <p>This creates a new content record with references to existing and
one new system category:</p>
            <pre><code class="language-php">$data[&#039;sys_category&#039;][&#039;NEW9823be87&#039;] = [
    &#039;title&#039; =&gt; &#039;New category&#039;,
    &#039;pid&#039; =&gt; 1,
];
$data[&#039;tt_content&#039;][&#039;NEWbe68s587&#039;] = [
    &#039;header&#039; =&gt; &#039;Look ma, categories!&#039;,
    &#039;pid&#039; =&gt; 45,
    &#039;categories&#039; =&gt; [
        1,
        2,
        &#039;NEW9823be87&#039;, // You can also use placeholders here
    ],
];</code></pre>
            <div class="phpdocumentor-admonition -note">
            <svg class="phpdocumentor-admonition__icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"></path></svg>
                    <article>
        <p>To get real uid of the record you have just created use DataHandler&#039;s substNEWwithIDs property like$uid = $dataHandler-substNEWwithIDs['NEW9823be87'];</p>

    </article>
</div>
            <p>This updates the page with uid=9834 to a new title, &quot;New title for
this page&quot;, and no_cache checked:</p>
            <pre><code class="language-php">$data[&#039;pages&#039;][9834] = [
    &#039;title&#039; =&gt; &#039;New title for this page&#039;,
    &#039;no_cache&#039; =&gt; &#039;1&#039;
];</code></pre>
            <a id="tce-clear-cache"></a>
    </div>
    </div>
<div class="section" id="clear-cache">
    <h1>Clear cache</h1>
            <p>TCE also has an API for clearing the cache tables of TYPO3:</p>
            <p>Syntax</p>
            <pre><code class="language-php">$dataHandler-&gt;clear_cacheCmd($cacheCmd);</code></pre>
            <p>:header-rows: 1</p>
            <blockquote>

<ul>
    <li class="dash">:Value,30: $cacheCmd values
:Description,70: Description</li>
    <li class="dash"><dl>
                        <dt>:Value:</dt>
        
        <dd>[integer]</dd>                        <dt>:Description:</dt>
        
        <dd>Clear the cache for the page id given.</dd>    </dl></li>
    <li class="dash"><dl>
                        <dt>:Value:</dt>
        
        <dd>&quot;all&quot;</dd>                        <dt>:Description:</dt>
        
        <dd><p>Clears all cache tables (cache_pages, cache_pagesection,
cache_hash).</p><p>Only available for admin-users unless explicitly allowed by User
TSconfig &quot;options.clearCache.all&quot;.</p></dd>    </dl></li>
    <li class="dash"><dl>
                        <dt>:Value:</dt>
        
        <dd>&quot;pages&quot;</dd>                        <dt>:Description:</dt>
        
        <dd><p>Clears all pages from cache_pages.</p><p>Only available for admin-users unless explicitly allowed by User
TSconfig &quot;options.clearCache.pages&quot;.</p></dd>    </dl></li>
</ul></blockquote>
            <a id="tce-cache-hook"></a>
            <div class="section" id="clear-cache-using-cache-tags">
    <h2>Clear cache using cache tags</h2>
            <p>Every processing of data or commands is finalized with flushing a few caches in the pages group. Cache tags are used to specifically flush the the relevant cache entries instead of the cache as whole.</p>
            <p>By default the following cache tags are flushed:</p>
            

<ul>
    <li>The table name of the updated record, e.g. pages when updating a page or
tx_myextension_mytable when updating a record of this table.</li>
    <li>A combination of table name and record UID, e.g. pages_10 when
updating the page with UID 10 or tx_myextension_mytable_20 when
updating the record with UID 20 of this table.</li>
    <li>A page UID prefixed with pageID_` (:php:pageId_&lt;page-uid&gt;), e.g. :php:pageId_10when updating a page with UID 10 (additionally all related pages, see :ref:t3tsconfig:clearcache-pagegrandparent &lt;pagetcemain-clearcache-pagegrandparent&gt;<a href="abe724823b717374d190d1512b7e587ccabbd2fdt3tsconfig:clearcache-pagesiblingchildren">abe724823b717374d190d1512b7e587ccabbd2fdt3tsconfig:clearcache-pagesiblingchildren</a> &lt;pagetcemain-clearcache-pagesiblingchildren&gt;) and :php:pageId_10when updating a record if a record of any table placed on the page with UID 10 (:php:&lt;table&gt;.pid = 10`) is updated.</li>
</ul>
            <p>Notice that you can also use the TypoScriptFrontendController::addCacheTags() method to register additional tags for the cache entry of the current page while it is rendered. This way you can implement an elaborate caching behavior which ensures that every record update in the TYPO3 backend (which is processed by the DataHandler) automatically flushes the cache of all pages where that record is displayed.</p>
            <p>Following the rules mentioned above you could register cache tags from within
your Extbase plugin (e.g. controller or a custom viewhelper):</p>
            <pre><code class="language-php">public function __construct(TypoScriptFrontendController $frontendController)
{
    $this-&gt;frontendController = $frontendController;
}

public function showAction(ExampleModel $example): ResponseInterface
{
   // ...

   $this-&gt;frontendController-&gt;addCacheTags([
       sprintf(&#039;tx_myextension_example_%d&#039;, $example-&gt;getUid()),
   ]);
}</code></pre>
    </div>
            <div class="section" id="hook-for-cache-post-processing">
    <h2>Hook for Cache Post-processing</h2>
            <p>You can configure cache post-processing with a user defined PHP
function. Configuration of the hook can be done from
ext_localconf.php. An example might look like:</p>
            <pre><code class="language-php">$GLOBALS[&#039;TYPO3_CONF_VARS&#039;][&#039;SC_OPTIONS&#039;][&#039;t3lib/class.t3lib_tcemain.php&#039;][&#039;clearCachePostProc&#039;][] =
    \Vendor\SomeExtension\Hook\DataHandlerHook::class . &#039;-&gt;postProcessClearCache&#039;;</code></pre>
            <a id="tce-flags"></a>
    </div>
    </div>
<div class="section" id="flags-in-datahandler">
    <h1>Flags in DataHandler</h1>
            <p>There are a few internal variables you can set prior to executing
commands or data submission. These are the most significant:</p>
            <p>:header-rows: 1</p>
            <blockquote>

<ul>
    <li class="dash">:Variable,30: Internal variable
:Type,20: Data type
:Description,50: Description</li>
    <li class="dash"><dl>
                        <dt>:Variable:</dt>
        
        <dd>-&gt;deleteTree</dd>                        <dt>:Type:</dt>
        
        <dd>Boolean</dd>                        <dt>:Description:</dt>
        
        <dd><p>Sets whether a page tree branch can be recursively deleted.</p><p>If this is set, then a page is deleted by deleting the whole branch
under it (user must have delete permissions to it all). If not set,
then the page is deleted <em>only</em> if it has no branch.</p><p>Default is false.</p></dd>    </dl></li>
    <li class="dash"><dl>
                        <dt>:Variable:</dt>
        
        <dd>-&gt;copyTree</dd>                        <dt>:Type:</dt>
        
        <dd>Integer</dd>                        <dt>:Description:</dt>
        
        <dd><p>Sets the number of branches on a page tree to copy.</p><p>If 0 then branch is <em>not</em> copied. If 1 then pages on the 1st level is
copied. If 2 then pages on the second level is copied, and so on.</p><p>Default is zero.</p></dd>    </dl></li>
    <li class="dash"><dl>
                        <dt>:Variable:</dt>
        
        <dd>-&gt;reverseOrder</dd>                        <dt>:Type:</dt>
        
        <dd>Boolean</dd>                        <dt>:Description:</dt>
        
        <dd><p>If set, the data array is reversed in the order, which is a nice thing
if you&#039;re creating a whole bunch of new records.</p><p>Default is zero.</p></dd>    </dl></li>
    <li class="dash"><dl>
                        <dt>:Variable:</dt>
        
        <dd>-&gt;copyWhichTables</dd>                        <dt>:Type:</dt>
        
        <dd>list of strings (tables)</dd>                        <dt>:Description:</dt>
        
        <dd><p>This list of tables decides which tables will be copied. If empty then
none will. If &quot;*&quot; then all will (that the user has permission to of
course).</p><p>Default is &quot;*&quot;.</p></dd>    </dl></li>
</ul></blockquote>
    </div>

    </section>
                            </div>
            <section data-search-results class="phpdocumentor-search-results phpdocumentor-search-results--hidden">
    <section class="phpdocumentor-search-results__dialog">
        <header class="phpdocumentor-search-results__header">
            <h2 class="phpdocumentor-search-results__title">Search results</h2>
            <button class="phpdocumentor-search-results__close"><i class="fas fa-times"></i></button>
        </header>
        <section class="phpdocumentor-search-results__body">
            <ul class="phpdocumentor-search-results__entries"></ul>
        </section>
    </section>
</section>
        </div>
        <a href="guide/ApiOverview/Typo3CoreEngine/Database/Index.html#top" class="phpdocumentor-back-to-top"><i class="fas fa-chevron-circle-up"></i></a>

    </main>

    <script>
        cssVars({});
    </script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/prism.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/plugins/line-numbers/prism-line-numbers.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/plugins/line-highlight/prism-line-highlight.min.js"></script>
</body>
</html>