<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
                    <title>phpDocumentor</title>
    

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <base href="../../../../">
    <link rel="icon" href="images/favicon.ico"/>
    <link rel="stylesheet" href="css/normalize.css">
    <link rel="stylesheet" href="css/base.css">
            <link rel="preconnect" href="https://fonts.gstatic.com">
        <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@100;200;300;400;600;700&display=swap" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:wght@400;600;700&display=swap" rel="stylesheet">
        <link rel="stylesheet" href="css/template.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0/css/all.min.css" integrity="sha256-ybRkN9dBjhcS2qrW1z+hfCxq+1aBdwyQM5wlQoQVt/0=" crossorigin="anonymous" />
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/themes/prism-okaidia.css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/plugins/line-numbers/prism-line-numbers.css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/plugins/line-highlight/prism-line-highlight.css">
                <script src="https://cdn.jsdelivr.net/npm/fuse.js@3.4.6"></script>
        <script src="https://cdn.jsdelivr.net/npm/css-vars-ponyfill@2"></script>
        <script src="js/template.js"></script>
        <script src="js/search.js"></script>
        <script defer src="js/searchIndex.js"></script>
    </head>
<body id="top">
    <header class="phpdocumentor-header phpdocumentor-section">
    <h1 class="phpdocumentor-title"><a href="" class="phpdocumentor-title__link">phpDocumentor</a></h1>
    <input class="phpdocumentor-header__menu-button" type="checkbox" id="menu-button" name="menu-button" />
    <label class="phpdocumentor-header__menu-icon" for="menu-button">
        <i class="fas fa-bars"></i>
    </label>
    <section data-search-form class="phpdocumentor-search">
    <label>
        <span class="visually-hidden">Search for</span>
        <svg class="phpdocumentor-search__icon" width="21" height="20" viewBox="0 0 21 20" fill="none" xmlns="http://www.w3.org/2000/svg">
            <circle cx="7.5" cy="7.5" r="6.5" stroke="currentColor" stroke-width="2"/>
            <line x1="12.4892" y1="12.2727" x2="19.1559" y2="18.9393" stroke="currentColor" stroke-width="3"/>
        </svg>
        <input type="search" class="phpdocumentor-field phpdocumentor-search__field" placeholder="Loading .." disabled />
    </label>
</section>

    <nav class="phpdocumentor-topnav">
    <ul class="phpdocumentor-topnav__menu">
        </ul>
</nav>
</header>

    <main class="phpdocumentor">
        <div class="phpdocumentor-section">
            <input class="phpdocumentor-sidebar__menu-button" type="checkbox" id="sidebar-button" name="sidebar-button" />
<label class="phpdocumentor-sidebar__menu-icon" for="sidebar-button">
    Menu
</label>
<aside class="phpdocumentor-column -three phpdocumentor-sidebar">
                    <section class="phpdocumentor-sidebar__category">
            <h2 class="phpdocumentor-sidebar__category-header">typo3-explained</h2>
                                    <h4 class="phpdocumentor-sidebar__root-namespace">
    <a href="guide/Introduction/Index.html#introduction" class="">Introduction</a>
</h4>
    <ul class="phpdocumentor-list">
                    <li>
                <a href="guide/Introduction/Index.html#system-overview-1" class="">System Overview</a>
                
            </li>
                    <li>
                <a href="guide/Introduction/Index.html#a-basic-installation" class="">A basic installation</a>
                
            </li>
            </ul>

                                    <h4 class="phpdocumentor-sidebar__root-namespace">
    <a href="guide/ApiOverview/Index.html#api-a-z" class="">API A-Z</a>
</h4>

                                    <h4 class="phpdocumentor-sidebar__root-namespace">
    <a href="guide/CodingGuidelines/Index.html#cgl" class="">Coding Guidelines</a>
</h4>
    <ul class="phpdocumentor-list">
                    <li>
                <a href="guide/CodingGuidelines/Introduction.html#cgl-introduction" class="">Introduction</a>
                
            </li>
                    <li>
                <a href="guide/CodingGuidelines/CglPhp/Index.html#cgl-php" class="">PHP Coding Guidelines</a>
                
            </li>
                    <li>
                <a href="guide/CodingGuidelines/CglJavaScript/Index.html#cgl-javascript" class="">JavaScript Coding Guidelines</a>
                
            </li>
                    <li>
                <a href="guide/CodingGuidelines/CglTypeScript/Index.html#cgl-typescript" class="">TypeScript Coding Guidelines</a>
                
            </li>
                    <li>
                <a href="guide/CodingGuidelines/CglTypoScript/Index.html#cgl-typoscript" class="">TypoScript Coding Guidelines</a>
                
            </li>
                    <li>
                <a href="guide/CodingGuidelines/CglTsConfig.html#cgl-tsconfig" class="">TSconfig Coding Guidelines</a>
                
            </li>
                    <li>
                <a href="guide/CodingGuidelines/CglXliff/Index.html#cgl-xliff" class="">Xliff Coding Guidelines</a>
                
            </li>
                    <li>
                <a href="guide/CodingGuidelines/CglYaml.html#cgl-yaml" class="">Yaml Coding Guidelines</a>
                
            </li>
                    <li>
                <a href="guide/CodingGuidelines/CglRest/Index.html#cgl-rest" class="">reStructuredText (reST)</a>
                
            </li>
            </ul>

                                    <h4 class="phpdocumentor-sidebar__root-namespace">
    <a href="guide/Configuration/Index.html#configuration" class="">Configuration</a>
</h4>
    <ul class="phpdocumentor-list">
                    <li>
                <a href="guide/Configuration/ConfigurationOverview.html#config-overview" class="">Configuration overview</a>
                
            </li>
                    <li>
                <a href="guide/Configuration/Glossary.html#configuration-classification" class="">Glossary</a>
                
            </li>
                    <li>
                <a href="guide/Configuration/ConfigurationFiles.html#configuration-files" class="">Configuration files</a>
                
            </li>
                    <li>
                <a href="guide/Configuration/ConfigurationModule/Index.html#configuration-module" class="">Configuration module</a>
                
            </li>
                    <li>
                <a href="guide/Configuration/FeatureToggles.html#feature-toggles" class="">Feature toggles</a>
                
            </li>
                    <li>
                <a href="guide/Configuration/GlobalVariables.html#globals-variables" class="">$GLOBALS</a>
                
            </li>
                    <li>
                <a href="guide/Configuration/Typo3ConfVars/Index.html#typo3-conf-vars" class="">TYPO3_CONF_VARS</a>
                
            </li>
                    <li>
                <a href="guide/Configuration/Typo3Information.html#typo3Information" class="">Global meta information about TYPO3</a>
                
            </li>
                    <li>
                <a href="guide/Configuration/Tsconfig.html#tsconfig" class="">TSconfig</a>
                
            </li>
                    <li>
                <a href="guide/Configuration/TypoScriptSyntax/Index.html#typoscript-syntax-about" class="">TypoScript syntax</a>
                
            </li>
                    <li>
                <a href="guide/Configuration/UserSettingsConfiguration/Index.html#user-settings" class="">User settings configuration</a>
                
            </li>
                    <li>
                <a href="guide/Configuration/Yaml/Index.html#yaml" class="">YAML</a>
                
            </li>
            </ul>

                                    <h4 class="phpdocumentor-sidebar__root-namespace">
    <a href="guide/ExtensionArchitecture/Index.html#extension-development" class="">Extension development</a>
</h4>
    <ul class="phpdocumentor-list">
                    <li>
                <a href="guide/ExtensionArchitecture/Concepts/Index.html#extension-concepts" class="">Concepts</a>
                
            </li>
                    <li>
                <a href="guide/ExtensionArchitecture/FileStructure/Index.html#extension-reserved-folders-legacy" class="">File structure</a>
                
            </li>
                    <li>
                <a href="guide/ExtensionArchitecture/HowTo/Index.html#extension-howto" class="">Howto</a>
                
            </li>
                    <li>
                <a href="guide/ExtensionArchitecture/Extbase/Index.html#extbase" class="">Extbase</a>
                
            </li>
                    <li>
                <a href="guide/ExtensionArchitecture/BestPractises/Index.html#extension-Best-practises" class="">Best practises and conventions</a>
                
            </li>
                    <li>
                <a href="guide/ExtensionArchitecture/Tutorials/Index.html#extension-tutorials" class="">Tutorials</a>
                
            </li>
            </ul>

                                    <h4 class="phpdocumentor-sidebar__root-namespace">
    <a href="guide/Security/Index.html#security" class="">Security guidelines</a>
</h4>
    <ul class="phpdocumentor-list">
                    <li>
                <a href="guide/Security/Introduction/Index.html#security-introduction" class="">Introduction</a>
                
            </li>
                    <li>
                <a href="guide/Security/SecurityTeam/Index.html#security-team" class="">The TYPO3 Security Team</a>
                
            </li>
                    <li>
                <a href="guide/Security/GeneralInformation/Index.html#security-general-information" class="">General Information</a>
                
            </li>
                    <li>
                <a href="guide/Security/TypesOfThreats/Index.html#security-threats" class="">Types of Security Threats</a>
                
            </li>
                    <li>
                <a href="guide/Security/GeneralGuidelines/Index.html#security-general-guidelines" class="">General guidelines</a>
                
            </li>
                    <li>
                <a href="guide/Security/GuidelinesAdministrators/Index.html#security-administrators" class="">Guidelines for System Administrators</a>
                
            </li>
                    <li>
                <a href="guide/Security/GuidelinesExtensionDevelopment/Index.html#security-extension-development" class="">Guidelines for extension development</a>
                
            </li>
                    <li>
                <a href="guide/Security/GuidelinesIntegrators/Index.html#security-integrators" class="">Guidelines for TYPO3 integrators</a>
                
            </li>
                    <li>
                <a href="guide/Security/GuidelinesEditors/Index.html#security-editors" class="">Guidelines for editors</a>
                
            </li>
                    <li>
                <a href="guide/Security/Backups/Index.html#security-backups" class="">Backup strategy</a>
                
            </li>
                    <li>
                <a href="guide/Security/HackedSite/Index.html#security-detect-analyze-repair" class="">Detect, analyze and repair a hacked site</a>
                
            </li>
            </ul>

                                    <h4 class="phpdocumentor-sidebar__root-namespace">
    <a href="guide/Testing/Index.html#testing" class="">Testing</a>
</h4>
    <ul class="phpdocumentor-list">
                    <li>
                <a href="guide/Testing/History.html#testing-history" class="">History</a>
                
            </li>
                    <li>
                <a href="guide/Testing/CoreTesting.html#testing-core" class="">Core testing</a>
                
            </li>
                    <li>
                <a href="guide/Testing/ExtensionTesting.html#testing-extensions" class="">Extension testing</a>
                
            </li>
                    <li>
                <a href="guide/Testing/ProjectTesting.html#testing-projects" class="">Project testing</a>
                
            </li>
                    <li>
                <a href="guide/Testing/WritingUnit.html#testing-writing-unit" class="">Writing unit tests</a>
                
            </li>
                    <li>
                <a href="guide/Testing/WritingFunctional.html#testing-writing-functional" class="">Writing functional tests</a>
                
            </li>
                    <li>
                <a href="guide/Testing/WritingAcceptance.html#testing-writing-acceptance" class="">Writing acceptance tests</a>
                
            </li>
                    <li>
                <a href="guide/Testing/Faq.html#testing-faq" class="">FAQ</a>
                
            </li>
            </ul>

                                    <h4 class="phpdocumentor-sidebar__root-namespace">
    <a href="guide/About.html#about" class="">About This Manual</a>
</h4>
    <ul class="phpdocumentor-list">
                    <li>
                <a href="guide/About.html#intended-audience" class="">Intended Audience</a>
                
            </li>
                    <li>
                <a href="guide/About.html#code-examples-1" class="">Code examples</a>
                
            </li>
                    <li>
                <a href="guide/About.html#feedback-and-contribute" class="">Feedback and Contribute</a>
                
            </li>
                    <li>
                <a href="guide/About.html#credits-1" class="">Credits</a>
                
            </li>
                    <li>
                <a href="guide/About.html#dedication-1" class="">Dedication</a>
                
            </li>
            </ul>

                                    <h4 class="phpdocumentor-sidebar__root-namespace">
    <a href="guide/Sitemap.html#sitemap" class="">Sitemap</a>
</h4>

                                    <h4 class="phpdocumentor-sidebar__root-namespace">
    <a href="guide/genindex.html#index" class="">Index</a>
</h4>

                        </section>
            
    <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Reports</h2>
                <h3 class="phpdocumentor-sidebar__root-package"><a href="reports/deprecated.html">Deprecated</a></h3>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="reports/errors.html">Errors</a></h3>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="reports/markers.html">Markers</a></h3>
    </section>

    <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Indices</h2>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="indices/files.html">Files</a></h3>
    </section>
</aside>

            <div class="phpdocumentor-column -nine phpdocumentor-content">
                                        <section>
        
<div class="section" id="query-builder">
    <h1>Query builder</h1>
            <dl>
                        <dt>:depth: 1</dt>
        
        <dd>:local:</dd>    </dl>
            <p>The query builder provides a set of methods to create queries
programmatically.</p>
            <p>This chapter provides examples of the most common queries.</p>
            <div class="phpdocumentor-admonition -warning">
                <svg class="phpdocumentor-admonition__icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg>
                <article>
        <p>From a security point of view, the documentation of
-createNamedParameter()
and -quoteIdentifier() are
an absolute <strong>must read and follow</strong> section. Make very sure you understand
this and use it for <strong>each and every query</strong> to prevent SQL
injections!</p>

    </article>
</div>
            <p>The query builder comes with a happy little list of small methods:</p>
            

<ul>
    <li>Set type of query-select(), -count(), -update(),
-insert() and -delete()</li>
    <li>Prepare WHERE conditions</li>
    <li>Manipulate default WHERE restrictions added by TYPO3 for
-select()</li>
    <li>Add LIMIT, GROUP BY and other SQL functions</li>
    <li>executeQuery() executes a SELECT query and returns a result,
a \Doctrine\DBAL\Result object</li>
    <li>executeStatement() executes an INSERT, UPDATE or
DELETE statement and returns the number of affected rows.</li>
</ul>
            <p>Most of the query builder methods provide a fluent interface, return
an instance of the current query builder itself, and can be chained:</p>
            <pre><code class="language-php">$queryBuilder
    -&gt;select(&#039;uid&#039;)
    -&gt;from(&#039;pages&#039;);</code></pre>
    </div>
<div class="section" id="instantiation">
    <h1>Instantiation</h1>
            <p>To create an instance of the query builder, call
ConnectionPool::getQueryBuilderForTable() and pass the table as an
argument. The ConnectionPool object can be
injected via dependency injection.</p>
            <p>:caption: <a href="EXT:my_extension/Classes/Domain/Repository/MyRepository.php">EXT:my_extension/Classes/Domain/Repository/MyRepository.php</a></p>
            <dl>
                        <dt>Never instantiate and initialize the query builder manually using</dt>
        
        <dd>dependency injection or GeneralUtility::makeInstance(), otherwise you
will miss essential dependencies and runtime setup.</dd>                        <dt>..  note::</dt>
        
        <dd>The QueryBuilder holds internal state and should not be reused for
different queries$connection-createQueryBuilder() if the same table is
involved, or use $connectionPool-getQueryBuilderForTable() for a
query to a different table. Don&#039;t worry, creating those object instances
is quite fast.</dd><dd></dd>    </dl>
    </div>
<div class="section" id="select-and-addselect">
    <h1>select() and addSelect()</h1>
            <p>Create a SELECT query.</p>
            <p>Select all fields:</p>
            <pre><code class="language-php">// SELECT *
$queryBuilder-&gt;select(&#039;*&#039;)</code></pre>
            <p>-select() and a number of other methods of the query builder
are <a href="https://en.wikipedia.org/wiki/Variadic_function">variadic</a>
and can handle any number of arguments. In -select() each argument
is interpreted as a single field name to be selected:</p>
            <pre><code class="language-php">// SELECT `uid`, `pid`, `aField`
$queryBuilder-&gt;select(&#039;uid&#039;, &#039;pid&#039;, &#039;aField&#039;);</code></pre>
            <p>Argument unpacking can be used if the list of fields already is available as
array:</p>
            <pre><code class="language-php">// SELECT `uid`, `pid`, `aField`, `anotherField`
$fields = [&#039;uid&#039;, &#039;pid&#039;, &#039;aField&#039;, &#039;anotherField&#039;];
$queryBuilder-&gt;select(...$fields);</code></pre>
            <p>-select() automatically supports AS and quotes identifiers. This
can be especially useful for join() operations:</p>
            <pre><code class="language-php">// SELECT `tt_content`.`bodytext` AS `t1`.`text`
$queryBuilder-&gt;select(&#039;tt_content.bodytext AS t1.text&#039;)</code></pre>
            <p>With -select() the list of fields to be selected is specified, and with
-addSelect() further elements can be added to an existing list.</p>
            <p>Mind that -select() <strong>replaces</strong> any formerly registered list instead of
appending it. Thus, it is not very usefule to call select() twice in a
code flow or <strong>after</strong> an -addSelect(). The methods -where() and
-andWhere() share the same behavior-where() replaces all
formerly registered constraints, -andWhere() appends additional
constraints.</p>
            <p>A useful combination of -select() and -addSelect() can be:</p>
            <pre><code class="language-php">$queryBuilder-&gt;select(...$defaultList);
if ($needAdditionalFields) {
    $queryBuilder-&gt;addSelect(...$additionalFields);
}</code></pre>
            <p>Calling the executeQuery() function on a -select() query returns
a result object of type \Doctrine\DBAL\Result. To receive single rows, a
-fetchAssociative() loop is used on that object, or
-fetchAllAssociative() to return a single array with all rows. A typical
code flow of a SELECT query looks like this:</p>
            <pre><code class="language-php">$queryBuilder = $this-&gt;connectionPool-&gt;getQueryBuilderForTable(&#039;tt_content&#039;);
$result = $queryBuilder
    -&gt;select(&#039;uid&#039;, &#039;header&#039;, &#039;bodytext&#039;)
    -&gt;from(&#039;tt_content&#039;)
    -&gt;where(
        $queryBuilder-&gt;expr()-&gt;eq(&#039;bodytext&#039;, $queryBuilder-&gt;createNamedParameter(&#039;lorem&#039;))
    )
    -&gt;executeQuery();

while ($row = $result-&gt;fetchAssociative()) {
    // Do something with that single row
    debug($row);
}</code></pre>
            <p>Read how to correctly instantiate
a query builder with the connection pool.</p>
            <div class="section" id="default-restrictions">
    <h2>Default Restrictions</h2>
            <div class="phpdocumentor-admonition -note">
            <svg class="phpdocumentor-admonition__icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"></path></svg>
                    <article>
        <p>-select() and -count() queries trigger TYPO3 magic that adds
further default where clauses if the queried table is also registered via
$GLOBALS['TCA']. See the RestrictionBuilder section for details on that topic.</p>

    </article>
</div>
    </div>
    </div>
<div class="section" id="count">
    <h1>count()</h1>
            <p>Create a COUNT query, a typical usage:</p>
            <pre><code class="language-php">// SELECT COUNT(`uid`) FROM `tt_content` WHERE (`bodytext` = &#039;lorem&#039;)
//     AND ((`tt_content`.`deleted` = 0) AND (`tt_content`.`hidden` = 0)
//     AND (`tt_content`.`starttime` &lt;= 1669885410)
//     AND ((`tt_content`.`endtime` = 0) OR (`tt_content`.`endtime` &gt; 1669885410)))
$queryBuilder = $this-&gt;connectionPool-&gt;getQueryBuilderForTable(&#039;tt_content&#039;);
$count = $queryBuilder
    -&gt;count(&#039;uid&#039;)
    -&gt;from(&#039;tt_content&#039;)
    -&gt;where(
        $queryBuilder-&gt;expr()-&gt;eq(&#039;bodytext&#039;, $queryBuilder-&gt;createNamedParameter(&#039;lorem&#039;))
    )
    -&gt;executeQuery()
    -&gt;fetchOne();</code></pre>
            <p>Read how to correctly instantiate
a query builder with the connection pool.</p>
            <p>Remarks:</p>
            

<ul>
    <li>Similar to the -select() query type, -count() automatically
triggers the magic of the RestrictionBuilder that adds default restrictions such as
deleted, hidden, starttime and endtime when
defined in TCA.</li>
    <li>Similar to -select() query types, -executeQuery() with
-count() returns a result object of type \Doctrine\DBAL\Result.
To fetch the number of rows directly, use -fetchOne().</li>
    <li>The first argument to -count() is required, typically
-count(*) or -count('uid') is used, the field name is
automatically quoted.</li>
    <li><p>There is no support for DISTINCT, instead a -groupBy() has to
be used, for example:</p><pre><code class="language-php">// Equivalent to:
// SELECT DISTINCT some_field, another_field FROM my_table

$queryBuilder
    -&gt;select(&#039;some_field&#039;, &#039;another_field&#039;)
    -&gt;from(&#039;my_table&#039;)
    -&gt;groupBy(&#039;some_field&#039;)
    -&gt;addGroupBy(&#039;another_field&#039;);</code></pre></li>
    <li>If -count() is combined with -groupBy(), the result may
return multiple rows. The order of those rows depends on the used
DBMS (Database management system). Therefore, to ensure the same
order of result rows on multiple different databases, a -groupBy()
should always be combined with an -orderBy().</li>
</ul>
    </div>
<div class="section" id="delete">
    <h1>delete()</h1>
            <p>Create a DELETE FROM query. The method requires the table name from which
data is to be deleted. Classic usage:</p>
            <pre><code class="language-php">// DELETE FROM `tt_content` WHERE `bodytext` = &#039;lorem&#039;
$queryBuilder = $this-&gt;connectionPool-&gt;getQueryBuilderForTable(&#039;tt_content&#039;);
$affectedRows = $queryBuilder
    -&gt;delete(&#039;tt_content&#039;)
    -&gt;where(
        $queryBuilder-&gt;expr()-&gt;eq(&#039;bodytext&#039;, $queryBuilder-&gt;createNamedParameter(&#039;lorem&#039;))
    )
    -&gt;executeStatement();</code></pre>
            <p>Read how to correctly instantiate
a query builder with the connection pool.</p>
            <p>Remarks:</p>
            

<ul>
    <li>For simple cases it is often easier to write and read using the
-delete() method of the Connection
object.</li>
    <li>In contrast to -select(), -delete() does <strong>not</strong>
automatically add WHERE restrictions like <code>AND `deleted` = 0</code>.</li>
    <li>-delete() does <strong>not</strong> magically transform a
<code>DELETE FROM `tt_content` WHERE `uid` = 4711</code> into something like
<code>UPDATE `tt_content` SET `deleted` = 1 WHERE `uid` = 4711</code> internally.
A soft-delete must be handled at application level with a dedicated
lookup in $GLOBALS['TCA']['theTable']['ctrl']['deleted'] to check if
a specific table can handle the soft-delete, together with an
-update() instead.</li>
    <li>Deleting from multiple tables at once is <strong>not</strong> supported:
<code>DELETE FROM `table1`, `table2`</code> can not be created.</li>
    <li>-delete() ignores -join()</li>
    <li>-delete() ignores setMaxResults()DELETE with
LIMIT does not work.</li>
</ul>
            <a id="database-query-builder-update-set"></a>
    </div>
<div class="section" id="update-and-set">
    <h1>update() and set()</h1>
            <p>Create an UPDATE query. Typical usage:</p>
            <pre><code class="language-php">// UPDATE `tt_content` SET `bodytext` = &#039;dolor&#039; WHERE `bodytext` = &#039;lorem&#039;</code></pre>
            <dl>
                        <dt>$queryBuilder = $this-&gt;connectionPool-&gt;getQueryBuilderForTable(&#039;tt_content&#039;);</dt>
        
        <dd><dl>
                        <dt>$queryBuilder</dt>
        
        <dd>-&gt;update(&#039;tt_content&#039;)
-&gt;where(
    $queryBuilder-&gt;expr()-&gt;eq(&#039;bodytext&#039;, $queryBuilder-&gt;createNamedParameter(&#039;lorem&#039;))
)
-&gt;set(&#039;bodytext&#039;, &#039;dolor&#039;)
-&gt;executeStatement();</dd>    </dl></dd>    </dl>
            <p>Read how to correctly instantiate
a query builder with the connection pool.</p>
            <p>-update() requires the table to update as the first argument and a table
alias (for example, t) as optional second argument. The table alias can
then be used in -set() and -where() expressions:</p>
            <pre><code class="language-php">// UPDATE `tt_content` `t` SET `t`.`bodytext` = &#039;dolor&#039; WHERE `t`.`bodytext` = &#039;lorem&#039;
$queryBuilder = $this-&gt;connectionPool-&gt;getQueryBuilderForTable(&#039;tt_content&#039;);
$queryBuilder
    -&gt;update(&#039;tt_content&#039;, &#039;t&#039;)
    -&gt;where(
        $queryBuilder-&gt;expr()-&gt;eq(&#039;t.bodytext&#039;, $queryBuilder-&gt;createNamedParameter(&#039;lorem&#039;))
    )
    -&gt;set(&#039;t.bodytext&#039;, &#039;dolor&#039;)
    -&gt;executeStatement();</code></pre>
            <p>Read how to correctly instantiate
a query builder with the connection pool.</p>
            <p>-set() requires a field name as the first argument and automatically
quotes it internally. The second mandatory argument is the value to set a field
to. <strong>The value is automatically transformed to a named parameter of a prepared
statement</strong>. This way, -set() key/value pairs are <strong>automatically SQL
protected from injection by default</strong>.</p>
            <p>If a field should be set to the value of another field from the row, quoting
must be turned off and -quoteIdentifier() and false have to
be used:</p>
            <pre><code class="language-php">// UPDATE `tt_content` SET `bodytext` = `header` WHERE `bodytext` = &#039;lorem&#039;
$queryBuilder = $this-&gt;connectionPool-&gt;getQueryBuilderForTable(&#039;tt_content&#039;);
$queryBuilder
    -&gt;update(&#039;tt_content&#039;)
    -&gt;where(
        $queryBuilder-&gt;expr()-&gt;eq(&#039;bodytext&#039;, $queryBuilder-&gt;createNamedParameter(&#039;lorem&#039;))
    )
    -&gt;set(&#039;bodytext&#039;, $queryBuilder-&gt;quoteIdentifier(&#039;header&#039;), false)
    -&gt;executeStatement();</code></pre>
            <p>Read how to correctly instantiate
a query builder with the connection pool.</p>
            <p>Remarks:</p>
            

<ul>
    <li>For simple cases it is often easier to use the -update() method of
the Connection object.</li>
    <li>-set() can be called multiple times if multiple fields should be
updated.</li>
    <li>-set() requires a field name as the first argument and automatically
quotes it internally.</li>
    <li>-set() requires the value to which a field is to be set as the
second parameter.</li>
    <li>-update() ignores -join() and -setMaxResults().</li>
    <li>The API does not magically add deleted = 0 or other restrictions, as is
currently the case with select, for example.
(See also RestrictionBuilder).</li>
</ul>
    </div>
<div class="section" id="insert-and-values">
    <h1>insert() and values()</h1>
            <p>Create an INSERT query. Typical usage:</p>
            <pre><code class="language-php">// INSERT INTO `tt_content` (`bodytext`, `header`) VALUES(`lorem`, `dolor`)
$queryBuilder = $this-&gt;connectionPool-&gt;getQueryBuilderForTable(&#039;tt_content&#039;);
$affectedRows = $queryBuilder
    -&gt;insert(&#039;tt_content&#039;)
    -&gt;values([
        &#039;bodytext&#039; =&gt; &#039;lorem&#039;,
        &#039;header&#039; =&gt; &#039;dolor&#039;,
    ])
    -&gt;executeStatement();</code></pre>
            <p>Read how to correctly instantiate
a query builder with the connection pool.</p>
            <p>Remarks:</p>
            

<ul>
    <li>Often it is often to use -insert() or -bulkInsert() of the
Connection object.</li>
    <li>-values() expects an array of key/value pairs. Both keys (field
names / identifiers) and values are automatically quoted. In rare cases,
quoting of values can be turned off by setting the second argument to
false. In those cases, quoting has must done manually, typically
by using -createNamedParameter() on the values, use with care ...</li>
    <li>-executeStatement() after -insert() returns the number of
inserted rows, which is typically 1.</li>
    <li>The query builder does not contain a method for inserting multiple rows at
once, use -bulkInsert() of the Connection object instead to achieve that.</li>
</ul>
    </div>
<div class="section" id="from">
    <h1>from()</h1>
            <p>-from() is essential for -select() and -count() query
types. -from() requires a table name and an optional alias name. The
method is usually called once per query creation and the table name is usually
the same as the one passed to -getQueryBuilderForTable(). If the query
joins multiple tables, the argument should be the name of the first table within
the -join() chain:</p>
            <pre><code class="language-php">// FROM `myTable`
$queryBuilder-&gt;from(&#039;myTable&#039;);

// FROM `myTable` AS `anAlias`
$queryBuilder-&gt;from(&#039;myTable&#039;, &#039;anAlias&#039;);</code></pre>
            <p>-from() can be called multiple times and will create the Cartesian
product of tables if not constrained by a respective -where() or
-andWhere() expression. In general, it is a good idea to use
-from() only once per query and instead model the selection of multiple
tables with an explicit -join().</p>
    </div>
<div class="section" id="where-andwhere-and-orwhere">
    <h1>where(), andWhere() and orWhere()</h1>
            <p>The three methods are used to create WHERE restrictions for SELECT,
COUNT, UPDATE and DELETE query types. Each argument is
usually an ExpressionBuilder object that
is converted to a string on -executeQuery() or
-executeStatement():</p>
            <pre><code class="language-php">// use TYPO3\CMS\Core\Database\Connection;
// SELECT `uid`, `header`, `bodytext`
// FROM `tt_content`
// WHERE
//    (
//       ((`bodytext` = &#039;lorem&#039;) AND (`header` = &#039;a name&#039;))
//       OR (`bodytext` = &#039;dolor&#039;) OR (`bodytext` = &#039;hans&#039;)
//    )
//    AND (`pid` = 42)
//    AND ... RestrictionBuilder TCA restrictions ...
$queryBuilder = $this-&gt;connectionPool-&gt;getQueryBuilderForTable(&#039;tt_content&#039;);
$result = $queryBuilder
    -&gt;select(&#039;uid&#039;, &#039;header&#039;, &#039;bodytext&#039;)
    -&gt;from(&#039;tt_content&#039;)
    -&gt;where(
        $queryBuilder-&gt;expr()-&gt;eq(&#039;bodytext&#039;, $queryBuilder-&gt;createNamedParameter(&#039;lorem&#039;)),
        $queryBuilder-&gt;expr()-&gt;eq(&#039;header&#039;, $queryBuilder-&gt;createNamedParameter(&#039;a name&#039;))
    )
    -&gt;orWhere(
        $queryBuilder-&gt;expr()-&gt;eq(&#039;bodytext&#039;, $queryBuilder-&gt;createNamedParameter(&#039;dolor&#039;)),
        $queryBuilder-&gt;expr()-&gt;eq(&#039;bodytext&#039;, $queryBuilder-&gt;createNamedParameter(&#039;hans&#039;))
    )
    -&gt;andWhere(
        $queryBuilder-&gt;expr()-&gt;eq(&#039;pid&#039;, $queryBuilder-&gt;createNamedParameter(42, Connection::PARAM_INT))
    )
    -&gt;executeQuery();</code></pre>
            <p>Read how to correctly instantiate
a query builder with the connection pool.</p>
            <p>Note the parenthesis of the above example-andWhere() encapsulates both
-where() and -orWhere() with an additional restriction.</p>
            <p>Argument unpacking can become handy with these methods:</p>
            <pre><code class="language-php">$whereExpressions = [
    $queryBuilder-&gt;expr()-&gt;eq(&#039;bodytext&#039;, $queryBuilder-&gt;createNamedParameter(&#039;lorem&#039;)),
    $queryBuilder-&gt;expr()-&gt;eq(&#039;header&#039;, $queryBuilder-&gt;createNamedParameter(&#039;a name&#039;))
];
if ($needsAdditionalExpression) {
    $whereExpressions[] = $someAdditionalExpression;
}
$queryBuilder-&gt;where(...$whereExpressions);</code></pre>
            <p>Remarks:</p>
            

<ul>
    <li>The three methods are <a href="https://en.wikipedia.org/wiki/Variadic_function">variadic</a>.
They can handle any number of arguments. For instance, if -where()
receives four arguments, they are handled as single expressions, all
combined with AND.</li>
    <li>createNamedParameter
is used to create a placeholder for a field value of a prepared statement.
<strong>Always</strong> use this when dealing with user input in expressions to protect
the statement from SQL injections.</li>
    <li>-where() should be called only once per query and resets all
previously set -where(), -andWhere() and -orWhere()
expressions. A -where() call after a previous -where(),
-andWhere() or -orWhere() usually indicates a bug or a
rather weird code flow. Doing so is discouraged.</li>
    <li>When creating complex WHERE restrictions, -getSQL() and
-getParameters() are helpful debugging tools to verify parenthesis
and single query parts.</li>
    <li>If only -eq() expressions are used, it is often easier to switch to
the according method of the Connection object
to simplify quoting and improve readability.</li>
    <li>It is possible to feed the methods directly with strings, but this is
discouraged and usually used only in rare cases where expression strings
are created in a different place that can not be easily resolved.</li>
</ul>
    </div>
<div class="section" id="join-innerjoin-rightjoin-and-leftjoin">
    <h1>join(), innerJoin(), rightJoin() and leftJoin()</h1>
            <p>Joining multiple tables in a -select() or -count() query is done
with one of these methods. Multiple joins are supported by calling the methods
more than once. All methods require four arguments: The name of the table on the
left (or its alias), the name of the table on the right, an alias for the name
of the table on the right, and the join restriction as fourth argument:</p>
            <pre><code class="language-php">// SELECT `sys_language`.`uid`, `sys_language`.`title`
// FROM `sys_language`
// INNER JOIN `pages` `p`
//     ON `p`.`sys_language_uid` = `sys_language`.`uid`
// WHERE
//     (`p`.`uid` = 42)
//     AND (
//          (`p`.`deleted` = 0)
//          AND (
//              (`sys_language`.`hidden` = 0) AND (`overlay`.`hidden` = 0)
//          )
//          AND (`p`.`starttime` &lt;= 1475591280)
//          AND ((`p`.`endtime` = 0) OR (`overlay`.`endtime` &gt; 1475591280))
//     )
$queryBuilder = $this-&gt;connectionPool-&gt;getQueryBuilderForTable(&#039;sys_language&#039;)
$result = $queryBuilder
   -&gt;select(&#039;sys_language.uid&#039;, &#039;sys_language.title&#039;)
   -&gt;from(&#039;sys_language&#039;)
   -&gt;join(
       &#039;sys_language&#039;,
       &#039;pages&#039;,
       &#039;p&#039;,
       $queryBuilder-&gt;expr()-&gt;eq(&#039;p.sys_language_uid&#039;, $queryBuilder-&gt;quoteIdentifier(&#039;sys_language.uid&#039;))
   )
   -&gt;where(
       $queryBuilder-&gt;expr()-&gt;eq(&#039;p.uid&#039;, $queryBuilder-&gt;createNamedParameter(42, \PDO::PARAM_INT))
   )
   -&gt;executeQuery();</code></pre>
            <p>Read how to correctly instantiate
a query builder with the connection pool.</p>
            <p>Notes to the example above:</p>
            

<ul>
    <li>The query operates with the sys_language table as the main table,
this table name is given to getQueryBuilderForTable().</li>
    <li>The query joins the pages table as INNER JOIN and gives it the
alias p.</li>
    <li>The join condition is <code>`p`.`sys_language_uid` = `sys_language`.`uid`</code>. It
would have been identical to swap the expression arguments of the fourth
-join() argument
-eq('sys_language.uid', $queryBuilder-quoteIdentifier('p.sys_language_uid')).</li>
    <li>The second argument of the join expression instructs the
ExpressionBuilder to quote the value as
a field identifier (a field name, here a combination of table and field
name). Using createNamedParameter
would lead in quoting as value (' instead of <code>`</code> in MySQL) and the query
would fail.</li>
    <li>The alias p - the third argument of the -join() call - does
not necessarily have to be set to a different name than the table name
itself here. It is sufficient to use pages as third argument and not
to specify any other name. Aliases are mostly useful when a join to the same
table is needed:
<code>SELECT `something` FROM `tt_content` JOIN `tt_content` `content2` ON ...</code>.
Aliases are also useful to increase the readability of ->where()
expressions.</li>
    <li>The RestrictionBuilder has added
additional WHERE conditions for both tables involved! The
sys_language table obviously only specifies a
'disabled' = 'hidden' as enableColumns in its
TCA ctrl section, while the pages table
specifies the fields deleted, hidden, starttime and
stoptime.</li>
</ul>
            <p>A more complex example with two joins. The first join points to the first table,
again using an alias to resolve a language overlay scenario. The second join
uses the alias of the first join target as left side:</p>
            <pre><code class="language-php">// SELECT `tt_content_orig`.`sys_language_uid`
// FROM `tt_content`
// INNER JOIN `tt_content` `tt_content_orig` ON `tt_content`.`t3_origuid` = `tt_content_orig`.`uid`
// INNER JOIN `sys_language` `sys_language` ON `tt_content_orig`.`sys_language_uid` = `sys_language`.`uid`
// WHERE
//     (`tt_content`.`colPos` = 1)
//     AND (`tt_content`.`pid` = 42)
//     AND (`tt_content`.`sys_language_uid` = 2)
//     AND ... RestrictionBuilder TCA restrictions for tables tt_content and sys_language ...
// GROUP BY `tt_content_orig`.`sys_language_uid`
$queryBuilder = $this-&gt;connectionPool-&gt;getQueryBuilderForTable(&#039;sys_language&#039;)
$constraints = [
    $queryBuilder-&gt;expr()-&gt;eq(&#039;tt_content.colPos&#039;, $queryBuilder-&gt;createNamedParameter(1, \PDO::PARAM_INT)),
    $queryBuilder-&gt;expr()-&gt;eq(&#039;tt_content.pid&#039;, $queryBuilder-&gt;createNamedParameter(42, \PDO::PARAM_INT)),
    $queryBuilder-&gt;expr()-&gt;eq(&#039;tt_content.sys_language_uid&#039;, $queryBuilder-&gt;createNamedParameter(2, \PDO::PARAM_INT)),
];
$queryBuilder
    -&gt;select(&#039;tt_content_orig.sys_language_uid&#039;)
    -&gt;from(&#039;tt_content&#039;)
    -&gt;join(
        &#039;tt_content&#039;,
        &#039;tt_content&#039;,
        &#039;tt_content_orig&#039;,
        $queryBuilder-&gt;expr()-&gt;eq(
            &#039;tt_content.t3_origuid&#039;,
            $queryBuilder-&gt;quoteIdentifier(&#039;tt_content_orig.uid&#039;)
        )
    )
    -&gt;join(
        &#039;tt_content_orig&#039;,
        &#039;sys_language&#039;,
        &#039;sys_language&#039;,
        $queryBuilder-&gt;expr()-&gt;eq(
            &#039;tt_content_orig.sys_language_uid&#039;,
            $queryBuilder-&gt;quoteIdentifier(&#039;sys_language.uid&#039;)
        )
    )
    -&gt;where(...$constraints)
    -&gt;groupBy(&#039;tt_content_orig.sys_language_uid&#039;)
    -&gt;executeQuery();</code></pre>
            <p>Read how to correctly instantiate
a query builder with the connection pool.</p>
            <p>Further remarks:</p>
            

<ul>
    <li>-join() and innerJoin are identical. They create an
INNER JOIN query, this is identical to a JOIN query.</li>
    <li>-leftJoin() creates a LEFT JOIN query, this is identical to
a LEFT OUTER JOIN query.</li>
    <li>-rightJoin() creates a RIGHT JOIN query, this is identical to
a RIGHT OUTER JOIN query.</li>
    <li>Calls to join() methods are only considered for -select() and
-count() type queries. -delete(), -insert()
and update() do not support joins, these query parts are ignored and
do not end up in the final statement.</li>
    <li>The argument of -getQueryBuilderForTable() should be the leftmost
main table.</li>
    <li>Joining two tables that are configured to different connections will throw
an exception. This restricts the tables that can be configured for different
database endpoints. It is possible to test the connection objects of the
involved tables for equality and implement a fallback logic in PHP if they
are different.</li>
    <li>Doctrine DBAL does not support the use of join methods in combination with
-update(), -insert() and -delete() methods, because
such a statement is not cross-platform compatible.</li>
</ul>
    </div>
<div class="section" id="orderby-and-addorderby">
    <h1>orderBy() and addOrderBy()</h1>
            <p>Add ORDER BY to a -select() statement. Both -orderBy() and
-addOrderBy() require a field name as first argument:</p>
            <pre><code class="language-php">// SELECT * FROM `sys_language` ORDER BY `sorting` ASC
$queryBuilder = $this-&gt;connectionPool-&gt;getQueryBuilderForTable(&#039;sys_language&#039;);
$queryBuilder-&gt;getRestrictions()-&gt;removeAll();
$languageRecords = $queryBuilder
    -&gt;select(&#039;*&#039;)
    -&gt;from(&#039;sys_language&#039;)
    -&gt;orderBy(&#039;sorting&#039;)
    -&gt;executeQuery()
    -&gt;fetchAllAssociative();</code></pre>
            <p>Read how to correctly instantiate
a query builder with the connection pool.</p>
            <p>Remarks:</p>
            

<ul>
    <li>-orderBy() resets all previously specified orders. It makes no sense
to call this function again after a previous -orderBy() or
-addOrderBy().</li>
    <li>Both methods need a field name or a table.fieldName or a
tableAlias.fieldName as first argument. In the example above the call
to -orderBy('sys_language.sorting') would have been identical. All
identifiers are quoted automatically.</li>
    <li>The second, optional argument of both methods specifies the sort order. The
two allowed values are 'ASC' and 'DESC', where 'ASC'
is default and can be omitted.</li>
    <li>To create a chain of orders, use -orderBy() and then multiple
-addOrderBy() calls. The call to
-orderBy('header')-addOrderBy('bodytext')-addOrderBy('uid', 'DESC')
creates <code>ORDER BY `header` ASC, `bodytext` ASC, `uid` DESC</code></li>
    <li>To add more complex sorting you can use
-add('orderBy', 'FIELD(eventtype, 0, 4, 1, 2, 3)', true),
remember to quote properly!</li>
</ul>
    </div>
<div class="section" id="groupby-and-addgroupby">
    <h1>groupBy() and addGroupBy()</h1>
            <p>Add GROUP BY to a -select() statement. Each argument of the
methods is a single identifier:</p>
            <pre><code class="language-php">// GROUP BY `pages`.`sys_language_uid`, `sys_language`.`uid`
-&gt;groupBy(&#039;pages.sys_language_uid&#039;, &#039;sys_language.uid&#039;);</code></pre>
            <p>Remarks:</p>
            

<ul>
    <li>Similar to -select() and -where(), both methods are variadic
and take any number of arguments, argument unpacking is supported-groupBy(...$myGroupArray)</li>
    <li>Each argument is either a direct field name <code>GROUP BY `bodytext`</code>,
a table.fieldName or a tableAlias.fieldName and is properly
quoted.</li>
    <li>-groupBy() resets all previously defined group specification and
should only be called once per statement.</li>
    <li>For more complex statements you can use
-add('groupBy', $sql, $append), remember to quote properly!</li>
</ul>
    </div>
<div class="section" id="setmaxresults-and-setfirstresult">
    <h1>setMaxResults() and setFirstResult()</h1>
            <p>Add LIMIT to restrict the number of records and OFFSET for
pagination of query parts. Both methods should be called only once per
statement:</p>
            <pre><code class="language-php">// SELECT * FROM `sys_language` LIMIT 2 OFFSET 4
$queryBuilder = $this-&gt;connectionPool-&gt;getQueryBuilderForTable(&#039;sys_language&#039;);
$queryBuilder
    -&gt;select(&#039;*&#039;)
    -&gt;from(&#039;sys_language&#039;)
    -&gt;setMaxResults(2)
    -&gt;setFirstResult(4)
    -&gt;executeQuery();</code></pre>
            <p>Read how to correctly instantiate
a query builder with the connection pool.</p>
            <p>Remarks:</p>
            

<ul>
    <li>It is allowed to call -setMaxResults() without calling
-setFirstResult().</li>
    <li>It is possible to call -setFirstResult() without calling
setMaxResults()LIMIT will be added by
Doctrine DBAL and set to a very high value.</li>
</ul>
            <a id="database-query-builder-add"></a>
    </div>
<div class="section" id="add">
    <h1>add()</h1>
            <p>The -add() method appends or replaces a single, generic query part. It
can be used as a low level call when more specific calls do not provide enough
freedom to express parts of statements:</p>
            <pre><code class="language-php">$queryBuilder = $this-&gt;connectionPool-&gt;getQueryBuilderForTable(&#039;sys_language&#039;);
$queryBuilder
    -&gt;select(&#039;*&#039;)
    -&gt;from(&#039;sys_language&#039;)
    -&gt;add(&#039;orderBy&#039;, &#039;FIELD(eventtype, 0, 4, 1, 2, 3)&#039;);</code></pre>
            <p>Read how to correctly instantiate
a query builder with the connection pool.</p>
            <p>Remarks:</p>
            

<ul>
    <li>The first argument is the SQL part. One ofselect, from,
set, where, groupBy, having or orderBy.</li>
    <li>The second argument is the (properly quoted!) SQL segment of this part.</li>
    <li>The optional third boolean argument specifies whether the SQL fragment
should be appended (true) or replace a possibly existing SQL part of
this name (false, default).</li>
</ul>
            <a id="database-query-builder-get-sql"></a>
    </div>
<div class="section" id="getsql">
    <h1>getSQL()</h1>
            <p>The -getSQL() method returns the created query statement as string. It
is incredibly useful during development to verify that the final statement is
executed exactly as a developer expects:</p>
            <pre><code class="language-php">$queryBuilder = $this-&gt;connectionPool-&gt;getQueryBuilderForTable(&#039;sys_language&#039;);
$queryBuilder
    -&gt;select(&#039;*&#039;)
    -&gt;from(&#039;sys_language&#039;);
debug($queryBuilder-&gt;getSQL());
$result = $queryBuilder-&gt;executeQuery();</code></pre>
            <p>Read how to correctly instantiate
a query builder with the connection pool.</p>
            <p>Remarks:</p>
            

<ul>
    <li>This is debugging code. Take proper actions to ensure that these calls do
not end up in production!</li>
    <li>The method is usually called directly before -executeQuery() or
-executeStatement() to output the final statement.</li>
    <li>Casting a query builder object to (string) has the same effect as
calling -getSQL(), but the explicit call using the method should be
preferred to simplify a search operation for this kind of debugging
statements.</li>
    <li>The method is a simple way to see what restrictions the
RestrictionBuilder has added.</li>
    <li>Doctrine DBAL always creates prepared statementscreateNamedParameter
creates a placeholder that is later replaced when the real query is
triggered via -executeQuery() or -executeStatement().
-getSQL() does not show these values, instead it displays the
placeholder names, usually with a string like :dcValue1. There is no
simple solution to show the fully replaced query within the framework, but
you can use getParameters to
see the array of parameters used to replace these placeholders within the
query. On the frontend, the queries and parameters are available in the
admin panel.</li>
</ul>
    </div>
<div class="section" id="getparameters">
    <h1>getParameters()</h1>
            <p>The -getParameters() method returns the values for the placeholders of
the prepared statement in an array. This is incredibly useful during development
to verify that the final statement is executed as a developer expects:</p>
            <pre><code class="language-php">$queryBuilder = $this-&gt;connectionPool-&gt;getQueryBuilderForTable(&#039;sys_language&#039;);
$queryBuilder
    -&gt;select(&#039;*&#039;)
    -&gt;from(&#039;sys_language&#039;);
debug($queryBuilder-&gt;getParameters());
$statement = $queryBuilder-&gt;executeQuery();</code></pre>
            <p>Read how to correctly instantiate
a query builder with the connection pool.</p>
            <p>Remarks:</p>
            

<ul>
    <li>This is debugging code. Take proper actions to ensure that these calls do
not end up in production!</li>
    <li>The method is usually called directly before -executeQuery() or
-executeStatement() to output the final statement.</li>
    <li>Doctrine DBAL always creates prepared statementscreateNamedParameter
creates a placeholder that is later replaced when the real query is
triggered via -executeQuery() or -executeStatement().
-getParameters() does not show the statement or the placeholders,
instead the values are displayed, usually an array using keys like
:dcValue1. There is no simple solution to show the fully replaced query
within the framework, but you can use getSql to see the string with placeholders, which
is used as a prepared statement.</li>
</ul>
    </div>
<div class="section" id="execute-executequery-and-executestatement">
    <h1>execute(), executeQuery() and executeStatement()</h1>
            <dl>
                        <dt>The widely used -execute() method has been split into</dt>
        
        <dd><p>executeQuery() and executeStatement(). executeQuery()
returns a \Doctrine\DBAL\Result instead of a
\Doctrine\DBAL\Statement. executeStatement() returns the
number of affected rows.</p><p>Although -execute() still works for backwards compatibility, you
should prefer to use -executeQuery() for SELECT and
COUNT statements and -executeStatement() for INSERT,
UPDATE and DELETE queries.</p></dd>    </dl>
            <div class="section" id="executequery">
    <h2>executeQuery()</h2>
            <p>This method compiles and fires the final query statement. This is usually the
last call on a query builder object. It can be called for SELECT and
COUNT queries.</p>
            <p>On success, it returns a result object of type \Doctrine\DBAL\Result
representing the result set. The Result object can then be used by
fetchAssociative(), fetchAllAssociative() and fetchOne().
executeQuery() returns a \Doctrine\DBAL\Result and not a
\Doctrine\DBAL\Statement anymore.</p>
            <div class="phpdocumentor-admonition -note">
            <svg class="phpdocumentor-admonition__icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"></path></svg>
                    <article>
        <p>It is not possible to rebind placeholder values on the result and execute
another query, as was sometimes done with the Statement returned by
execute().</p>

    </article>
</div>
            <p>If the query fails for some reason (for instance, if the database connection
was lost or if the query contains a syntax error), an
\Doctrine\DBAL\Exception is thrown. It is usually bad habit to catch and
suppress this exception, as it indicates a runtime error a program error. Both
should bubble up. For more information on proper exception handling, see the
coding guidelines.</p>
    </div>
            <div class="section" id="executestatement">
    <h2>executeStatement()</h2>
            <p>The executeStatement() method can be used for INSERT,
UPDATE and DELETE statements. It returns the number of affected
rows as an integer.</p>
    </div>
    </div>
<div class="section" id="expr">
    <h1>expr()</h1>
            <p>This method returns an instance of the ExpressionBuilder. It is used to create complex WHERE query
parts and JOIN expressions:</p>
            <pre><code class="language-php">// use TYPO3\CMS\Core\Database\Connection;
// SELECT `uid` FROM `tt_content` WHERE (`uid` &gt; 42)
$queryBuilder = $this-&gt;connectionPool-&gt;getQueryBuilderForTable(&#039;tt_content&#039;);
$queryBuilder
    -&gt;select(&#039;uid&#039;)
    -&gt;from(&#039;tt_content&#039;)
    -&gt;where(
        $queryBuilder-&gt;expr()-&gt;gt(
            &#039;uid&#039;,
            $queryBuilder-&gt;createNamedParameter(42, Connection::PARAM_INT)
        )
    )
    -&gt;executeQuery();</code></pre>
            <p>Read how to correctly instantiate
a query builder with the connection pool.</p>
            <p>Remarks:</p>
            

<ul>
    <li>This object is stateless and can be called and worked on as often as needed.
However, it is bound to the specific connection for which a statement is
created and therefore only available through the query builder, which is
specific to a connection.</li>
    <li>Never reuse the ExpressionBuilder,
especially not between multiple query builder objects, but always get an
instance of the expression builder by calling -expr().</li>
</ul>
            <a id="database-query-builder-create-named-parameter"></a>
    </div>
<div class="section" id="createnamedparameter">
    <h1>createNamedParameter()</h1>
            <p>This method creates a placeholder for a field value of a prepared statement.
<strong>Always</strong> use this when dealing with user input in expressions to protect the
statement from SQL injections:</p>
            <pre><code class="language-php">// SELECT * FROM `tt_content` WHERE (`bodytext` = &#039;kl\&#039;aus&#039;)
$searchWord = &quot;kl&#039;aus&quot;; // $searchWord = GeneralUtility::_GP(&#039;searchword&#039;);
$queryBuilder = $this-&gt;connectionPool-&gt;getQueryBuilderForTable(&#039;tt_content&#039;);
$queryBuilder-&gt;getRestrictions()-&gt;removeAll();
$queryBuilder
    -&gt;select(&#039;uid&#039;)
    -&gt;from(&#039;tt_content&#039;)
    -&gt;where(
        $queryBuilder-&gt;expr()-&gt;eq(
            &#039;bodytext&#039;,
            $queryBuilder-&gt;createNamedParameter($searchWord)
        )
    )
    -&gt;executeQuery();</code></pre>
            <p>Read how to correctly instantiate
a query builder with the connection pool.</p>
            <p>The above example shows the importance of using -createNamedParameter()-createNamedParameter(), which quotes the backtick and
makes the value SQL injection-safe.</p>
            <p>Not convinced? Suppose the code would look like this:</p>
            <pre><code class="language-php">// NEVER EVER DO THIS!
$_POST[&#039;searchword&#039;] = &quot;&#039;foo&#039; UNION SELECT username FROM be_users&quot;;
$searchWord = GeneralUtility::_GP(&#039;searchword&#039;);
$queryBuilder = $this-&gt;connectionPool-&gt;getQueryBuilderForTable(&#039;tt_content&#039;);
$queryBuilder-&gt;getRestrictions()-&gt;removeAll();
 this fails with syntax error to prevent copy and paste
$queryBuilder
    -&gt;select(&#039;uid&#039;)
    -&gt;from(&#039;tt_content&#039;)
    -&gt;where(
        // MASSIVE SECURITY ISSUE DEMONSTRATED HERE
        // USE -&gt;createNamedParameter() ON $searchWord!
        $queryBuilder-&gt;expr()-&gt;eq(&#039;bodytext&#039;, $searchWord)
    );</code></pre>
            <p>Read how to correctly instantiate
a query builder with the connection pool.</p>
            <p>Mind the missing -createNamedParameter() method call in the
-eq() expression for a given value! This code would happily execute
the statement
<code>SELECT uid FROM `tt_content` WHERE `bodytext` = &#039;foo&#039; UNION SELECT username FROM be_users;</code>
returning a list of backend user names!</p>
            <div class="phpdocumentor-admonition -note">
            <svg class="phpdocumentor-admonition__icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"></path></svg>
                    <article>
        <p>-set() automatically converts the second mandatory parameter into
a named parameter of a prepared statement. If the second parameter is
wrapped in a -createNamedParameter() call, this will result in an
error during execution. This behaviour can be disabled by passing
false as third parameter to -set().</p>

    </article>
</div>
            <div class="section" id="more-examples">
    <h2>More examples</h2>
            <p>Use integer, integer array:</p>
            <pre><code class="language-php">// use TYPO3\CMS\Core\Database\Connection;
// SELECT * FROM `tt_content`
//     WHERE `bodytext` = &#039;kl\&#039;aus&#039;
//     AND   sys_language_uid = 0
//     AND   pid in (2, 42,13333)
$searchWord = &quot;kl&#039;aus&quot;; // $searchWord = GeneralUtility::_GP(&#039;searchword&#039;);
$queryBuilder = $this-&gt;connectionPool-&gt;getQueryBuilderForTable(&#039;tt_content&#039;);
$queryBuilder-&gt;getRestrictions()-&gt;removeAll();
$queryBuilder
    -&gt;select(&#039;uid&#039;)
    -&gt;from(&#039;tt_content&#039;)
    -&gt;where(
        $queryBuilder-&gt;expr()-&gt;eq(
            &#039;bodytext&#039;,
            $queryBuilder-&gt;createNamedParameter($searchWord)
        ),
        $queryBuilder-&gt;expr()-&gt;eq(
            &#039;sys_language_uid&#039;,
            $queryBuilder-&gt;createNamedParameter($language, Connection::PARAM_INT)
        ),
        $queryBuilder-&gt;expr()-&gt;in(
            &#039;pid&#039;,
            $queryBuilder-&gt;createNamedParameter($pageIds, Connection::PARAM_INT_ARRAY)
        )
    )
    -&gt;executeQuery();</code></pre>
            <p>Read how to correctly instantiate
a query builder with the connection pool.</p>
    </div>
            <div class="section" id="rules">
    <h2>Rules</h2>
            

<ul>
    <li><strong>Always</strong> use -createNamedParameter() for <strong>any</strong> input, no matter
where it comes from.</li>
    <li>The second argument of -expr() is <strong>always</strong> either a call to
-createNamedParameter() or -quoteIdentifier().</li>
    <li>The second argument of -createNamedParameter() specifies the type of
input. For string, this can be omitted, but it is good practice to add
\TYPO3\CMS\Core\Database\Connection::PARAM_INT for integers or similar for
other field types. This is not strict rule currently, but if you follow it
you will have fewer headaches in the future, especially with DBMSes
(Database management systems) that are not as relaxed as MySQL when it
comes to field types. The Connection constants can be used for simple
types like bool, string, null, lob and integer. Additionally, the
two constants Connection::PARAM_INT_ARRAY and Connection::PARAM_STR_ARRAY
can be used when handling an array of strings or integers, for instance in
an IN() expression.</li>
    <li>Keep the -createNamedParameter() method as close to the expression
as possible. Do not structure your code in a way that it quotes something
first and only later stuffs the already prepared names into the expression.
Having -createNamedParameter() directly within the created
expression, is much less error-prone and easier to review. This is a general
rulehtmlspecialchars()
or GeneralUtility::quoteJSvalue(). Sanitization should be obvious
directly at the very place where it is important:</li>
</ul>
            <pre><code class="language-php">// DO
$queryBuilder = $this-&gt;connectionPool-&gt;getQueryBuilderForTable(&#039;tt_content&#039;);
$queryBuilder-&gt;getRestrictions()-&gt;removeAll();
$queryBuilder
    -&gt;select(&#039;uid&#039;)
    -&gt;from(&#039;tt_content&#039;)
    -&gt;where(
        $queryBuilder-&gt;expr()-&gt;eq(
            &#039;bodytext&#039;,
            $queryBuilder-&gt;createNamedParameter($searchWord)
        )
    )

// DON&#039;T DO, this is much harder to track:
$queryBuilder = $this-&gt;connectionPool-&gt;getQueryBuilderForTable(&#039;tt_content&#039;);
$myValue = $queryBuilder-&gt;createNamedParameter($searchWord);
// Imagine much more code here
$queryBuilder-&gt;getRestrictions()-&gt;removeAll();
$queryBuilder
    -&gt;select(&#039;uid&#039;)
    -&gt;from(&#039;tt_content&#039;)
    -&gt;where(
        $queryBuilder-&gt;expr()-&gt;eq(&#039;bodytext&#039;, $myValue)
    )</code></pre>
            <p>Read how to correctly instantiate
a query builder with the connection pool.</p>
            <a id="database-query-builder-quote-identifier"></a>
    </div>
    </div>
<div class="section" id="quoteidentifier-and-quoteidentifiers">
    <h1>quoteIdentifier() and quoteIdentifiers()</h1>
            <p>-quoteIdentifier() must be used when not a value but a field name is
handled. The quoting is different in those cases and typically ends up with
backticks <code>`</code> instead of ticks <code>&#039;</code>:</p>
            <pre><code class="language-php">// SELECT `uid` FROM `tt_content` WHERE (`header` = `bodytext`)
// Return list of rows where header and bodytext values are identical
$queryBuilder = $this-&gt;connectionPool-&gt;getQueryBuilderForTable(&#039;tt_content&#039;);
$queryBuilder
    -&gt;select(&#039;uid&#039;)
    -&gt;from(&#039;tt_content&#039;)
    -&gt;where(
        $queryBuilder-&gt;expr()-&gt;eq(
            &#039;header&#039;,
            $queryBuilder-&gt;quoteIdentifier(&#039;bodytext&#039;)
        )
    );</code></pre>
            <p>Read how to correctly instantiate
a query builder with the connection pool.</p>
            <p>The method quotes single field names or combinations of table names or table
aliases with field names:</p>
            <pre><code class="language-none">// Single field name: `bodytext`
-&gt;quoteIdentifier(&#039;bodytext&#039;);

// Table name and field name: `tt_content`.`bodytext`
-&gt;quoteIdentifier(&#039;tt_content.bodytext&#039;)

// Table alias and field name: `foo`.`bodytext`
-&gt;from(&#039;tt_content&#039;, &#039;foo&#039;)-&gt;quoteIdentifier(&#039;foo.bodytext&#039;)</code></pre>
            <p>Remarks:</p>
            

<ul>
    <li>Similar to -createNamedParameter() this method is crucial to
prevent SQL injections. The same rules apply here.</li>
    <li>The -set() method for
UPDATE statements expects its second argument to be a field value by
default, and quotes it internally using -createNamedParameter(). If
a field should be set to the value of another field, this quoting can be
turned off and an explicit call to -quoteIdentifier() must be added.</li>
    <li>Internally, -quoteIdentifier() is automatically called on all method
arguments that must be a field name. For instance, -quoteIdentifier()
is called for all arguments of -select().</li>
    <li>-quoteIdentifiers() (mind the plural) can be used to quote multiple
field names at once. While that method is &quot;public&quot; and thus exposed as an
API method, this is mostly useful internally only.</li>
</ul>
            <a id="database-query-builder-escape-like-wildcards"></a>
    </div>
<div class="section" id="escapelikewildcards">
    <h1>escapeLikeWildcards()</h1>
            <p>Helper method to quote % characters within a search string. This is helpful in
-like() and -notLike() expressions:</p>
            <pre><code class="language-php">// SELECT `uid` FROM `tt_content` WHERE (`bodytext` LIKE &#039;%kl\\%aus%&#039;)
$searchWord = &#039;kl%aus&#039;;
$queryBuilder = $this-&gt;connectionPool-&gt;getQueryBuilderForTable(&#039;tt_content&#039;);
$queryBuilder
    -&gt;select(&#039;uid&#039;)
    -&gt;from(&#039;tt_content&#039;)
    -&gt;where(
        $queryBuilder-&gt;expr()-&gt;like(
            &#039;bodytext&#039;,
            $queryBuilder-&gt;createNamedParameter(&#039;%&#039; . $queryBuilder-&gt;escapeLikeWildcards($searchWord) . &#039;%&#039;)
        )
    );</code></pre>
            <p>Read how to correctly instantiate
a query builder with the connection pool.</p>
            <div class="phpdocumentor-admonition -warning">
                <svg class="phpdocumentor-admonition__icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg>
                <article>
        <p>Even when using -escapeLikeWildcards() the value must be
encapsulated again in a -createNamedParameter() call. Only calling
-escapeLikeWildcards() does <strong>not</strong> make the value SQL injection
safe!</p>

    </article>
</div>
    </div>
<div class="section" id="getrestrictions-setrestrictions-resetrestrictions">
    <h1>getRestrictions(), setRestrictions(), resetRestrictions()</h1>
            <p>API methods to deal with the RestrictionBuilder.</p>
    </div>

    </section>
                            </div>
            <section data-search-results class="phpdocumentor-search-results phpdocumentor-search-results--hidden">
    <section class="phpdocumentor-search-results__dialog">
        <header class="phpdocumentor-search-results__header">
            <h2 class="phpdocumentor-search-results__title">Search results</h2>
            <button class="phpdocumentor-search-results__close"><i class="fas fa-times"></i></button>
        </header>
        <section class="phpdocumentor-search-results__body">
            <ul class="phpdocumentor-search-results__entries"></ul>
        </section>
    </section>
</section>
        </div>
        <a href="guide/ApiOverview/Database/QueryBuilder/Index.html#top" class="phpdocumentor-back-to-top"><i class="fas fa-chevron-circle-up"></i></a>

    </main>

    <script>
        cssVars({});
    </script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/prism.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/plugins/line-numbers/prism-line-numbers.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/plugins/line-highlight/prism-line-highlight.min.js"></script>
</body>
</html>