<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
                    <title>phpDocumentor</title>
    

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <base href="../../../../">
    <link rel="icon" href="images/favicon.ico"/>
    <link rel="stylesheet" href="css/normalize.css">
    <link rel="stylesheet" href="css/base.css">
            <link rel="preconnect" href="https://fonts.gstatic.com">
        <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@100;200;300;400;600;700&display=swap" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:wght@400;600;700&display=swap" rel="stylesheet">
        <link rel="stylesheet" href="css/template.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0/css/all.min.css" integrity="sha256-ybRkN9dBjhcS2qrW1z+hfCxq+1aBdwyQM5wlQoQVt/0=" crossorigin="anonymous" />
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/themes/prism-okaidia.css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/plugins/line-numbers/prism-line-numbers.css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/plugins/line-highlight/prism-line-highlight.css">
                <script src="https://cdn.jsdelivr.net/npm/fuse.js@3.4.6"></script>
        <script src="https://cdn.jsdelivr.net/npm/css-vars-ponyfill@2"></script>
        <script src="js/template.js"></script>
        <script src="js/search.js"></script>
        <script defer src="js/searchIndex.js"></script>
    </head>
<body id="top">
    <header class="phpdocumentor-header phpdocumentor-section">
    <h1 class="phpdocumentor-title"><a href="" class="phpdocumentor-title__link">phpDocumentor</a></h1>
    <input class="phpdocumentor-header__menu-button" type="checkbox" id="menu-button" name="menu-button" />
    <label class="phpdocumentor-header__menu-icon" for="menu-button">
        <i class="fas fa-bars"></i>
    </label>
    <section data-search-form class="phpdocumentor-search">
    <label>
        <span class="visually-hidden">Search for</span>
        <svg class="phpdocumentor-search__icon" width="21" height="20" viewBox="0 0 21 20" fill="none" xmlns="http://www.w3.org/2000/svg">
            <circle cx="7.5" cy="7.5" r="6.5" stroke="currentColor" stroke-width="2"/>
            <line x1="12.4892" y1="12.2727" x2="19.1559" y2="18.9393" stroke="currentColor" stroke-width="3"/>
        </svg>
        <input type="search" class="phpdocumentor-field phpdocumentor-search__field" placeholder="Loading .." disabled />
    </label>
</section>

    <nav class="phpdocumentor-topnav">
    <ul class="phpdocumentor-topnav__menu">
        </ul>
</nav>
</header>

    <main class="phpdocumentor">
        <div class="phpdocumentor-section">
            <input class="phpdocumentor-sidebar__menu-button" type="checkbox" id="sidebar-button" name="sidebar-button" />
<label class="phpdocumentor-sidebar__menu-icon" for="sidebar-button">
    Menu
</label>
<aside class="phpdocumentor-column -three phpdocumentor-sidebar">
                    <section class="phpdocumentor-sidebar__category">
            <h2 class="phpdocumentor-sidebar__category-header">typo3-explained</h2>
                                    <h4 class="phpdocumentor-sidebar__root-namespace">
    <a href="guide/Introduction/Index.html#introduction" class="">Introduction</a>
</h4>
    <ul class="phpdocumentor-list">
                    <li>
                <a href="guide/Introduction/Index.html#system-overview-1" class="">System Overview</a>
                
            </li>
                    <li>
                <a href="guide/Introduction/Index.html#a-basic-installation" class="">A basic installation</a>
                
            </li>
            </ul>

                                    <h4 class="phpdocumentor-sidebar__root-namespace">
    <a href="guide/ApiOverview/Index.html#api-a-z" class="">API A-Z</a>
</h4>

                                    <h4 class="phpdocumentor-sidebar__root-namespace">
    <a href="guide/CodingGuidelines/Index.html#cgl" class="">Coding Guidelines</a>
</h4>
    <ul class="phpdocumentor-list">
                    <li>
                <a href="guide/CodingGuidelines/Introduction.html#cgl-introduction" class="">Introduction</a>
                
            </li>
                    <li>
                <a href="guide/CodingGuidelines/CglPhp/Index.html#cgl-php" class="">PHP Coding Guidelines</a>
                
            </li>
                    <li>
                <a href="guide/CodingGuidelines/CglJavaScript/Index.html#cgl-javascript" class="">JavaScript Coding Guidelines</a>
                
            </li>
                    <li>
                <a href="guide/CodingGuidelines/CglTypeScript/Index.html#cgl-typescript" class="">TypeScript Coding Guidelines</a>
                
            </li>
                    <li>
                <a href="guide/CodingGuidelines/CglTypoScript/Index.html#cgl-typoscript" class="">TypoScript Coding Guidelines</a>
                
            </li>
                    <li>
                <a href="guide/CodingGuidelines/CglTsConfig.html#cgl-tsconfig" class="">TSconfig Coding Guidelines</a>
                
            </li>
                    <li>
                <a href="guide/CodingGuidelines/CglXliff/Index.html#cgl-xliff" class="">Xliff Coding Guidelines</a>
                
            </li>
                    <li>
                <a href="guide/CodingGuidelines/CglYaml.html#cgl-yaml" class="">Yaml Coding Guidelines</a>
                
            </li>
                    <li>
                <a href="guide/CodingGuidelines/CglRest/Index.html#cgl-rest" class="">reStructuredText (reST)</a>
                
            </li>
            </ul>

                                    <h4 class="phpdocumentor-sidebar__root-namespace">
    <a href="guide/Configuration/Index.html#configuration" class="">Configuration</a>
</h4>
    <ul class="phpdocumentor-list">
                    <li>
                <a href="guide/Configuration/ConfigurationOverview.html#config-overview" class="">Configuration overview</a>
                
            </li>
                    <li>
                <a href="guide/Configuration/Glossary.html#configuration-classification" class="">Glossary</a>
                
            </li>
                    <li>
                <a href="guide/Configuration/ConfigurationFiles.html#configuration-files" class="">Configuration files</a>
                
            </li>
                    <li>
                <a href="guide/Configuration/ConfigurationModule/Index.html#configuration-module" class="">Configuration module</a>
                
            </li>
                    <li>
                <a href="guide/Configuration/FeatureToggles.html#feature-toggles" class="">Feature toggles</a>
                
            </li>
                    <li>
                <a href="guide/Configuration/GlobalVariables.html#globals-variables" class="">$GLOBALS</a>
                
            </li>
                    <li>
                <a href="guide/Configuration/Typo3ConfVars/Index.html#typo3-conf-vars" class="">TYPO3_CONF_VARS</a>
                
            </li>
                    <li>
                <a href="guide/Configuration/Typo3Information.html#typo3Information" class="">Global meta information about TYPO3</a>
                
            </li>
                    <li>
                <a href="guide/Configuration/Tsconfig.html#tsconfig" class="">TSconfig</a>
                
            </li>
                    <li>
                <a href="guide/Configuration/TypoScriptSyntax/Index.html#typoscript-syntax-about" class="">TypoScript syntax</a>
                
            </li>
                    <li>
                <a href="guide/Configuration/UserSettingsConfiguration/Index.html#user-settings" class="">User settings configuration</a>
                
            </li>
                    <li>
                <a href="guide/Configuration/Yaml/Index.html#yaml" class="">YAML</a>
                
            </li>
            </ul>

                                    <h4 class="phpdocumentor-sidebar__root-namespace">
    <a href="guide/ExtensionArchitecture/Index.html#extension-development" class="">Extension development</a>
</h4>
    <ul class="phpdocumentor-list">
                    <li>
                <a href="guide/ExtensionArchitecture/Concepts/Index.html#extension-concepts" class="">Concepts</a>
                
            </li>
                    <li>
                <a href="guide/ExtensionArchitecture/FileStructure/Index.html#extension-reserved-folders-legacy" class="">File structure</a>
                
            </li>
                    <li>
                <a href="guide/ExtensionArchitecture/HowTo/Index.html#extension-howto" class="">Howto</a>
                
            </li>
                    <li>
                <a href="guide/ExtensionArchitecture/Extbase/Index.html#extbase" class="">Extbase</a>
                
            </li>
                    <li>
                <a href="guide/ExtensionArchitecture/BestPractises/Index.html#extension-Best-practises" class="">Best practises and conventions</a>
                
            </li>
                    <li>
                <a href="guide/ExtensionArchitecture/Tutorials/Index.html#extension-tutorials" class="">Tutorials</a>
                
            </li>
            </ul>

                                    <h4 class="phpdocumentor-sidebar__root-namespace">
    <a href="guide/Security/Index.html#security" class="">Security guidelines</a>
</h4>
    <ul class="phpdocumentor-list">
                    <li>
                <a href="guide/Security/Introduction/Index.html#security-introduction" class="">Introduction</a>
                
            </li>
                    <li>
                <a href="guide/Security/SecurityTeam/Index.html#security-team" class="">The TYPO3 Security Team</a>
                
            </li>
                    <li>
                <a href="guide/Security/GeneralInformation/Index.html#security-general-information" class="">General Information</a>
                
            </li>
                    <li>
                <a href="guide/Security/TypesOfThreats/Index.html#security-threats" class="">Types of Security Threats</a>
                
            </li>
                    <li>
                <a href="guide/Security/GeneralGuidelines/Index.html#security-general-guidelines" class="">General guidelines</a>
                
            </li>
                    <li>
                <a href="guide/Security/GuidelinesAdministrators/Index.html#security-administrators" class="">Guidelines for System Administrators</a>
                
            </li>
                    <li>
                <a href="guide/Security/GuidelinesExtensionDevelopment/Index.html#security-extension-development" class="">Guidelines for extension development</a>
                
            </li>
                    <li>
                <a href="guide/Security/GuidelinesIntegrators/Index.html#security-integrators" class="">Guidelines for TYPO3 integrators</a>
                
            </li>
                    <li>
                <a href="guide/Security/GuidelinesEditors/Index.html#security-editors" class="">Guidelines for editors</a>
                
            </li>
                    <li>
                <a href="guide/Security/Backups/Index.html#security-backups" class="">Backup strategy</a>
                
            </li>
                    <li>
                <a href="guide/Security/HackedSite/Index.html#security-detect-analyze-repair" class="">Detect, analyze and repair a hacked site</a>
                
            </li>
            </ul>

                                    <h4 class="phpdocumentor-sidebar__root-namespace">
    <a href="guide/Testing/Index.html#testing" class="">Testing</a>
</h4>
    <ul class="phpdocumentor-list">
                    <li>
                <a href="guide/Testing/History.html#testing-history" class="">History</a>
                
            </li>
                    <li>
                <a href="guide/Testing/CoreTesting.html#testing-core" class="">Core testing</a>
                
            </li>
                    <li>
                <a href="guide/Testing/ExtensionTesting.html#testing-extensions" class="">Extension testing</a>
                
            </li>
                    <li>
                <a href="guide/Testing/ProjectTesting.html#testing-projects" class="">Project testing</a>
                
            </li>
                    <li>
                <a href="guide/Testing/WritingUnit.html#testing-writing-unit" class="">Writing unit tests</a>
                
            </li>
                    <li>
                <a href="guide/Testing/WritingFunctional.html#testing-writing-functional" class="">Writing functional tests</a>
                
            </li>
                    <li>
                <a href="guide/Testing/WritingAcceptance.html#testing-writing-acceptance" class="">Writing acceptance tests</a>
                
            </li>
                    <li>
                <a href="guide/Testing/Faq.html#testing-faq" class="">FAQ</a>
                
            </li>
            </ul>

                                    <h4 class="phpdocumentor-sidebar__root-namespace">
    <a href="guide/About.html#about" class="">About This Manual</a>
</h4>
    <ul class="phpdocumentor-list">
                    <li>
                <a href="guide/About.html#intended-audience" class="">Intended Audience</a>
                
            </li>
                    <li>
                <a href="guide/About.html#code-examples-1" class="">Code examples</a>
                
            </li>
                    <li>
                <a href="guide/About.html#feedback-and-contribute" class="">Feedback and Contribute</a>
                
            </li>
                    <li>
                <a href="guide/About.html#credits-1" class="">Credits</a>
                
            </li>
                    <li>
                <a href="guide/About.html#dedication-1" class="">Dedication</a>
                
            </li>
            </ul>

                                    <h4 class="phpdocumentor-sidebar__root-namespace">
    <a href="guide/Sitemap.html#sitemap" class="">Sitemap</a>
</h4>

                                    <h4 class="phpdocumentor-sidebar__root-namespace">
    <a href="guide/genindex.html#index" class="">Index</a>
</h4>

                        </section>
            
    <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Reports</h2>
                <h3 class="phpdocumentor-sidebar__root-package"><a href="reports/deprecated.html">Deprecated</a></h3>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="reports/errors.html">Errors</a></h3>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="reports/markers.html">Markers</a></h3>
    </section>

    <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Indices</h2>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="indices/files.html">Files</a></h3>
    </section>
</aside>

            <div class="phpdocumentor-column -nine phpdocumentor-content">
                                        <section>
        
<div class="section" id="database-restriction-builder">
    <h1>Restriction builder</h1>
            <dl>
                        <dt>:depth: 1</dt>
        
        <dd>:local:</dd>    </dl>
            <p>Database tables in TYPO3 that can be managed in the backend have TCA definitions that specify how single fields and rows of the table
should be handled and displayed by the framework.</p>
            <p>The ctrl section of a table&#039;s TCA array specifies optional framework-internal
handling of soft deletes and language overlays: For instance, when a row is
deleted in the backend using the page or list module, many tables are configured
to not drop that row entirely from the table, but to set a field (often
deleted) for that row from 0 to 1. Similar mechanisms apply for start and
end times, and to language and workspace overlays as well. See the
t3tca:ctrl chapter in the TCA reference for details on this topic.</p>
            <p>However, these mechanisms come at a price: developers of extensions dealing with
low-level queries must take care that overlaid or deleted rows are not included
in the result set of a simple query.</p>
            <p>This is where this &quot;automatic restriction&quot; enters the pictureDoctrine DBAL as a
TYPO3-specific extension. It automatically adds WHERE expressions that
suppress rows which are marked as deleted or have exceeded their &quot;active&quot;
lifecycle. All this is based on the TCA configuration of the affected table.</p>
    </div>
<div class="section" id="rationale">
    <h1>Rationale</h1>
            <p>A developer might ask why they need to do all this to themselves, and why this
extra material is added on top of a low-level query layer when &quot;just a simple
query&quot; should be fired. The construct implements some important design goals:</p>
            

<ul>
    <li><strong>Simple:</strong>
Query creation should be easy to handle without a developer having to deal too
much with the tedious TCA details..</li>
    <li><strong>Cope with developer laziness:</strong>
If the framework would force a developer to always add casual restrictions
for every single query, this is easy to forget. We are all lazy, aren&#039;t we?</li>
    <li><strong>Security:</strong>
When in doubt, it is better to show a little too little than too much. It is
much better to deal with a customer complaining that some records are <em>not</em>
displayed than to show too many records. The former is &quot;just a bug&quot;, while
the latter can easily lead to a serious privilege escalation security issue.</li>
    <li>**Automatic query upgradesdeleted = 0 restriction will
be added.</li>
    <li><strong>Handing over restriction details to the framework:</strong>
Having the restriction expressions handled by the framework gives it the
ability to change details without breaking the extension code. This may well
happen in the future, and a happy little upgrade path for such cases may
prove very useful later.</li>
    <li><strong>Flexibility:</strong>
The class construct is designed in a way so that developers can extend or
or substitute it with their own restrictions if that makes sense for
modeling the domain in question.</li>
</ul>
    </div>
<div class="section" id="main-construct">
    <h1>Main construct</h1>
            <p>The restriction builder is called whenever a SELECT or COUNT
query is executed using either \TYPO3\CMS\Core\Database\Query\QueryBuilder
or \TYPO3\CMS\Core\Database\Connection. The QueryBuilder allows manipulation of those restrictions, while the
simplified Connection class does not. When a query
deals with multiple tables in a join, restrictions are added for all affected
tables.</p>
            <p>Each single restriction such as a
\TYPO3\CMS\Core\Database\Query\Restriction\DeletedRestriction or a
TYPO3\CMS\Core\Database\Query\Restriction\StartTimeRestriction is modeled
as a single class that implements the
\TYPO3\CMS\Core\Database\Query\Restriction\QueryRestrictionInterface. Each
restriction looks up in TCA whether it should be applied. If so, the
according expressions are added to the WHERE clause when compiling the
final statement.</p>
            <p>Multiple restrictions can be grouped into containers which implement the
\TYPO3\CMS\Core\Database\Query\Restriction\QueryRestrictionContainerInterface.</p>
            <p>The \TYPO3\CMS\Core\Database\Query\Restriction\DefaultRestrictionContainer
is always added by default: It adds the</p>
            

<ul>
    <li>\TYPO3\CMS\Core\Database\Query\Restriction\DeletedRestriction</li>
    <li>\TYPO3\CMS\Core\Database\Query\Restriction\HiddenRestriction,</li>
    <li>\TYPO3\CMS\Core\Database\Query\Restriction\StartTimeRestriction and the</li>
    <li>\TYPO3\CMS\Core\Database\Query\Restriction\EndTimeRestriction.</li>
</ul>
            <p>Note that this applies to all contexts in which a query is executedCLI call, they all add the
DefaultRestrictionContainer unless explicitly stated otherwise by an
extension developer.</p>
            <div class="phpdocumentor-admonition -note">
            <svg class="phpdocumentor-admonition__icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"></path></svg>
                    <article>
        <p>Having this DefaultRestrictionContainer used everywhere is the second
iteration of this code construct:</p>
<p>The first variant automatically added contextual restrictions. For instance,
a query triggered by a call in the backend did not add the hidden flag,
while a query triggered in the frontend did. We quickly figured out that
this leads to a huge messadmin panel.</p>
<p>The currently active variant is much easier: It always adds sane defaults
everywhere, a developer only has to deal with details if they do not fit.
The Core Team hopes that this approach is a good balance between hidden
magic, security, transparency, and convenience.</p>

    </article>
</div>
    </div>
<div class="section" id="restrictions">
    <h1>Restrictions</h1>
            <dl>
                        <dt>\TYPO3\CMS\Core\Database\Query\Restriction\DeletedRestriction (default)</dt>
        
        <dd>Evaluates ['ctrl']['delete'], adds for instance
AND deleted = 0 if TCA['aTable']['ctrl']['delete'] = 'deleted'
is specified.</dd>                        <dt>\TYPO3\CMS\Core\Database\Query\Restriction\HiddenRestriction (default)</dt>
        
        <dd>Evaluates ['ctrl']['enablecolumns']['disabled'], adds
AND hidden = 0 if hidden is specified as field name.</dd>                        <dt>\TYPO3\CMS\Core\Database\Query\Restriction\StartTimeRestriction (default)</dt>
        
        <dd>Evaluates ['ctrl']['enablecolumns']['starttime'], typically adds
something like AND (tt_content.starttime<= 1475580240).</dd>                        <dt>\TYPO3\CMS\Core\Database\Query\Restriction\EndTimeRestriction (default)</dt>
        
        <dd>Evaluates ['ctrl']['enablecolumns']['endtime'].</dd>                        <dt>\TYPO3\CMS\Core\Database\Query\Restriction\FrontendGroupRestriction</dt>
        
        <dd>Evaluates ['enablecolumns']['fe_group'].</dd>                        <dt>\TYPO3\CMS\Core\Database\Query\Restriction\RootlevelRestriction</dt>
        
        <dd>Match records on root level, adds AND (pid= 0)</dd>                        <dt>\TYPO3\CMS\Core\Database\Query\Restriction\BackendWorkspaceRestriction</dt>
        
        <dd><p>Use \TYPO3\CMS\Core\Database\Query\Restriction\WorkspaceRestriction instead.</p><p>Determines the current workspace a backend user is working in and adds
a couple of restrictions to select only records of that workspace if the
table supports workspace-enabled records.</p></dd>                        <dt>\TYPO3\CMS\Core\Database\Query\Restriction\FrontendWorkspaceRestriction</dt>
        
        <dd><p>Use \TYPO3\CMS\Core\Database\Query\Restriction\WorkspaceRestriction instead.</p><p>Restriction to filter records for frontend workspaces preview.</p></dd>                        <dt>\TYPO3\CMS\Core\Database\Query\Restriction\WorkspaceRestriction</dt>
        
        <dd>WorkspaceRestriction has been added to overcome downsides of
FrontendWorkspaceRestriction and BackendWorkspaceRestriction.
The workspace restriction limits an SQL query to only select records which
are &quot;online&quot; and in live or current workspace.</dd>                        <dt>..  note::</dt>
        
        <dd>As an important note and limitation of any workspace-related restrictions,
fetching the exact records need to be handled after the SQL results are
fetched, by overlaying the records with
\TYPO3\CMS\Backend\Utility\BackendUtility::getRecordWSOL(),
\TYPO3\CMS\Core\Domain\Repository\PageRepository-versionOL() or
\TYPO3\CMS\Core\DataHandling\PlainDataResolver.</dd>    </dl>
            <p>When a restriction needs to be enforced, a restriction could implement the
interface \TYPO3\CMS\Core\Database\Query\Restriction\EnforceableQueryRestrictionInterface.
If a restriction implements EnforceableQueryRestrictionInterface, the
following applies:</p>
            

<ul>
    <li>-removeAll() will remove all restrictions except the ones that
implement the interface EnforceableQueryRestrictionInterface.</li>
    <li>-removeByType() will remove a restriction completely, also
restrictions that implement the interface
EnforceableQueryRestrictionInterface.</li>
</ul>
    </div>
<div class="section" id="queryrestrictioncontainer">
    <h1>QueryRestrictionContainer</h1>
            <dl>
                        <dt>\TYPO3\CMS\Core\Database\Query\Restriction\DefaultRestrictionContainer</dt>
        
        <dd><p>Adds</p>

<ul>
    <li class="dash">\TYPO3\CMS\Core\Database\Query\Restriction\DeletedRestriction</li>
    <li class="dash">\TYPO3\CMS\Core\Database\Query\Restriction\HiddenRestriction</li>
    <li class="dash">\TYPO3\CMS\Core\Database\Query\Restriction\StartTimeRestriction</li>
    <li class="dash">\TYPO3\CMS\Core\Database\Query\Restriction\EndTimeRestriction</li>
</ul><p>This container is always added if not told otherwise.</p></dd>                        <dt>\TYPO3\CMS\Core\Database\Query\Restriction\FrontendRestrictionContainer</dt>
        
        <dd><p>Adds</p>

<ul>
    <li class="dash">\TYPO3\CMS\Core\Database\Query\Restriction\DeletedRestriction</li>
    <li class="dash">\TYPO3\CMS\Core\Database\Query\Restriction\HiddenRestriction</li>
    <li class="dash">\TYPO3\CMS\Core\Database\Query\Restriction\StartTimeRestriction</li>
    <li class="dash">\TYPO3\CMS\Core\Database\Query\Restriction\EndTimeRestriction</li>
    <li class="dash">\TYPO3\CMS\Core\Database\Query\Restriction\WorkspaceRestriction</li>
    <li class="dash">\TYPO3\CMS\Core\Database\Query\Restriction\FrontendGroupRestriction</li>
</ul><p>This container should be added by a developer to a query when creating
query statements in frontend context or when handling frontend stuff from
within CLI calls.</p></dd>                        <dt>\TYPO3\CMS\Core\Database\Query\Restriction\LimitToTablesRestrictionContainer</dt>
        
        <dd>This restriction container applies added restrictions only to the given
table aliases. See database-limit-restrictions-to-tables for more
information. Enforced restrictions are treated equally to all other
restrictions.</dd>    </dl>
    </div>
<div class="section" id="limit-restrictions-to-tables">
    <h1>Limit restrictions to tables</h1>
            <p>With \TYPO3\CMS\Core\Database\Query\Restriction\LimitToTablesRestrictionContainer
it is possible to apply restrictions to a query only for a given set of tables,
or - to be precise - table aliases. Since it is a restriction container, it can
be added to the restrictions of the query builder and can hold restrictions
itself.</p>
            <div class="section" id="examples">
    <h2>Examples</h2>
            <p>If you want to apply one or more restrictions to only one table, that is
possible as follows. Let us say you have content in the tt_content table
with a relation to categories. Now you want to get all records with their
categories except those that are hidden. In this case, the hidden restriction
should apply only to the tt_content table, not to the sys_category
or sys_category_*_mm table.</p>
            <pre><code class="language-php">// use TYPO3\CMS\Core\Database\Connection;

$queryBuilder = $this-&gt;connectionPool-&gt;getQueryBuilderForTable(&#039;tt_content&#039;);
$queryBuilder-&gt;getRestrictions()
    -&gt;removeByType(HiddenRestriction::class)
    -&gt;add(
        GeneralUtility::makeInstance(LimitToTablesRestrictionContainer::class)
            -&gt;addForTables(GeneralUtility::makeInstance(HiddenRestriction::class), [&#039;tt&#039;])
    );
$queryBuilder-&gt;select(&#039;tt.uid&#039;, &#039;tt.header&#039;, &#039;sc.title&#039;)
    -&gt;from(&#039;tt_content&#039;, &#039;tt&#039;)
    -&gt;from(&#039;sys_category&#039;, &#039;sc&#039;)
    -&gt;from(&#039;sys_category_record_mm&#039;, &#039;scmm&#039;)
    -&gt;where(
        $queryBuilder-&gt;expr()-&gt;eq(
            &#039;scmm.uid_foreign&#039;,
            $queryBuilder-&gt;quoteIdentifier(&#039;tt.uid&#039;)
        ),
        $queryBuilder-&gt;expr()-&gt;eq(
            &#039;scmm.uid_local&#039;,
            $queryBuilder-&gt;quoteIdentifier(&#039;sc.uid&#039;)
        ),
        $queryBuilder-&gt;expr()-&gt;eq(
            &#039;tt.uid&#039;,
            $queryBuilder-&gt;createNamedParameter($id, Connection::PARAM_INT)
        )
    );</code></pre>
            <p>Read how to correctly instantiate
a query builder with the connection pool.</p>
            <p>In addition, it is possible to restrict the complete set of restrictions of a
query builder to a given set of table aliases:</p>
            <pre><code class="language-php">// use TYPO3\CMS\Core\Database\Connection;

$queryBuilder = $this-&gt;connectionPool-&gt;getQueryBuilderForTable(&#039;tt_content&#039;);
$queryBuilder-&gt;getRestrictions()
    -&gt;removeAll()
    -&gt;add(GeneralUtility::makeInstance(HiddenRestriction::class));
$queryBuilder-&gt;getRestrictions()-&gt;limitRestrictionsToTables([&#039;c2&#039;]);
$queryBuilder
    -&gt;select(&#039;c1.*&#039;)
    -&gt;from(&#039;tt_content&#039;, &#039;c1&#039;)
    -&gt;leftJoin(&#039;c1&#039;, &#039;tt_content&#039;, &#039;c2&#039;, &#039;c1.parent_field = c2.uid&#039;)
    -&gt;orWhere(
        $queryBuilder-&gt;expr()-&gt;isNull(&#039;c2.uid&#039;),
        $queryBuilder-&gt;expr()-&gt;eq(
            &#039;c2.pid&#039;,
            $queryBuilder-&gt;createNamedParameter(1, Connection::PARAM_INT)
        )
    );</code></pre>
            <p>Read how to correctly instantiate
a query builder with the connection pool.</p>
            <p>Which results in:</p>
            <pre><code class="language-sql">SELECT &quot;c1&quot;.*
  FROM &quot;tt_content&quot; &quot;c1&quot;
  LEFT JOIN &quot;tt_content&quot; &quot;c2&quot; ON c1.parent_field = c2.uid
  WHERE ((&quot;c2&quot;.&quot;uid&quot; IS NULL) OR (&quot;c2&quot;.&quot;pid&quot; = 1))
    AND (&quot;c2&quot;.&quot;hidden&quot; = 0))</code></pre>
            <a id="database-custom-restrictions"></a>
    </div>
    </div>
<div class="section" id="custom-restrictions">
    <h1>Custom restrictions</h1>
            <p>It is possible to add additional query restrictions by adding class names as key
to $GLOBALS['TYPO3_CONF_VARS']['DB']['additionalQueryRestrictions'].
These restriction objects will be added to any select query executed using the
QueryBuilder.</p>
            <p>If these added restriction objects additionally implement
\TYPO3\CMS\Core\Database\Query\Restriction\EnforceableQueryRestrictionInterface
and return true in the to be implemented method isEnforced(),
calling $queryBuilder-getRestrictions()-removeAll() such restrictions
will <strong>still</strong> be applied to the query.</p>
            <p>If an enforced restriction must be removed, it can still be removed with
$queryBuilder--getRestrictions()-removeByType(SomeClass::class).</p>
            <p>Implementers of custom restrictions can therefore have their restrictions always
enforced, or even not applied at all, by returning an empty expression in certain cases.</p>
            <p>To add a custom restriction class, use the following snippet:</p>
            <pre><code class="language-php">use MyVendor\MyExtension\Database\Query\Restriction\CustomRestriction;

if (!isset($GLOBALS[&#039;TYPO3_CONF_VARS&#039;][&#039;DB&#039;][&#039;additionalQueryRestrictions&#039;][CustomRestriction::class])) {
    $GLOBALS[&#039;TYPO3_CONF_VARS&#039;][&#039;DB&#039;][&#039;additionalQueryRestrictions&#039;][CustomRestriction::class] = [];
}</code></pre>
            <div class="phpdocumentor-admonition -note">
            <svg class="phpdocumentor-admonition__icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"></path></svg>
                    <article>
        <p>The class name must be the array key and the value must always be an array,
which is reserved for options given to the restriction objects.</p>

    </article>
</div>
            <dl>
                        <dt>Restrictions added by third-party extensions will impact the whole system.</dt>
        
        <dd>Therefore this API does not allow removing restrictions added by the system
and adding restrictions should be handled with care.</dd>    </dl>
            <p>Removing third party restrictions is possible, by setting the option
disabled for a restriction to true in global TYPO3 configuration
or ext_localconf.php of an extension:</p>
            <pre><code class="language-php">use MyVendor\MyExtension\Database\Query\Restriction\CustomRestriction;

$GLOBALS[&#039;TYPO3_CONF_VARS&#039;][&#039;DB&#039;][&#039;additionalQueryRestrictions&#039;][CustomRestriction::class][&#039;disabled&#039;] = true;</code></pre>
    </div>
<div class="section" id="examples">
    <h1>Examples</h1>
            <p>Often the default restrictions are sufficient. Nothing needs to be done in those
cases.</p>
            <p>However, many backend modules still want to show disabled records and remove the
start time and end time restrictions to allow administration of those records
for an editor. A typical setup from within a backend module:</p>
            <pre><code class="language-php">// use TYPO3\CMS\Core\Utility\GeneralUtility;
// use TYPO3\CMS\Core\Database\Connection;
// use TYPO3\CMS\Core\Database\ConnectionPool;
// use TYPO3\CMS\Core\Database\Query\Restriction\DeletedRestriction
// SELECT `uid`, `bodytext` FROM `tt_content` WHERE (`pid` = 42) AND (`tt_content`.`deleted` = 0)
$queryBuilder = $this-&gt;connectionPool-&gt;getQueryBuilderForTable(&#039;tt_content&#039;);
// Remove all restrictions but add DeletedRestriction again
$queryBuilder
    -&gt;getRestrictions()
    -&gt;removeAll()
    -&gt;add(GeneralUtility::makeInstance(DeletedRestriction::class));
$result = $queryBuilder
    -&gt;select(&#039;uid&#039;, &#039;bodytext&#039;)
    -&gt;from(&#039;tt_content&#039;)
    -&gt;where($queryBuilder-&gt;expr()-&gt;eq(
        &#039;pid&#039;,
        $queryBuilder-&gt;createNamedParameter($pid, Connection::PARAM_INT)
    ))
    -&gt;executeQuery()
    -&gt;fetchAllAssociative(();</code></pre>
            <p>Read how to correctly instantiate
a query builder with the connection pool.</p>
            <p>The DeletedRestriction should be kept in almost all cases. Usually, the
only extension that dismisses that flag is the recycler module to list and
resurrect deleted records. Any object implementing the
QueryRestrictionInterface can be given to -add(). This allows
extensions to deliver own restrictions.</p>
            <p>An alternative to the recommended way of first removing all restrictions and
then adding needed ones again (using -removeAll(), then -add())
is to kick specific restrictions with a call to -removeByType():</p>
            <pre><code class="language-php">// use TYPO3\CMS\Core\Utility\GeneralUtility;
// use TYPO3\CMS\Core\Database\ConnectionPool;
// use TYPO3\CMS\Core\Database\Query\Restriction\StartTimeRestriction
// use TYPO3\CMS\Core\Database\Query\Restriction\EndTimeRestriction
// Remove starttime and endtime, but keep hidden and deleted
$queryBuilder = $this-&gt;connectionPool-&gt;getQueryBuilderForTable(&#039;tt_content&#039;);
$queryBuilder
    -&gt;getRestrictions()
    -&gt;removeByType(StartTimeRestriction::class)
    -&gt;removeByType(EndTimeRestriction::class);</code></pre>
            <p>Read how to correctly instantiate
a query builder with the connection pool.</p>
            <p>In the frontend it is often needed to swap the DefaultRestrictionContainer
with the FrontendRestrictionContainer:</p>
            <pre><code class="language-php">// use TYPO3\CMS\Core\Database\Query\Restriction\FrontendRestrictionContainer
// Remove default restrictions and add list of default frontend restrictions
$queryBuilder-&gt;setRestrictions(GeneralUtility::makeInstance(FrontendRestrictionContainer::class));</code></pre>
            <p>Note that -setRestrictions() resets any previously specified
restrictions. Any class instance implementing
QueryRestrictionContainerInterface can be given to
-setRestrictions(). This allows extensions to deliver and use an custom
set of restrictions for own query statements if needed.</p>
            <div class="phpdocumentor-admonition -tip">
                    <svg class="phpdocumentor-admonition__icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18.364 5.636l-3.536 3.536m0 5.656l3.536 3.536M9.172 9.172L5.636 5.636m3.536 9.192l-3.536 3.536M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-5 0a4 4 0 11-8 0 4 4 0 018 0z"></path></svg>
            <article>
        <p>It can be very helpful to debug the final statements created by the
RestrictionBuilder using debug($queryBuilder-getSQL()) right
before the final call to $queryBuilder-executeQuery(). Just take
care these calls <strong>do not</strong>
end up in production code.</p>

    </article>
</div>
    </div>

    </section>
                            </div>
            <section data-search-results class="phpdocumentor-search-results phpdocumentor-search-results--hidden">
    <section class="phpdocumentor-search-results__dialog">
        <header class="phpdocumentor-search-results__header">
            <h2 class="phpdocumentor-search-results__title">Search results</h2>
            <button class="phpdocumentor-search-results__close"><i class="fas fa-times"></i></button>
        </header>
        <section class="phpdocumentor-search-results__body">
            <ul class="phpdocumentor-search-results__entries"></ul>
        </section>
    </section>
</section>
        </div>
        <a href="guide/ApiOverview/Database/RestrictionBuilder/Index.html#top" class="phpdocumentor-back-to-top"><i class="fas fa-chevron-circle-up"></i></a>

    </main>

    <script>
        cssVars({});
    </script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/prism.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/plugins/line-numbers/prism-line-numbers.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/plugins/line-highlight/prism-line-highlight.min.js"></script>
</body>
</html>