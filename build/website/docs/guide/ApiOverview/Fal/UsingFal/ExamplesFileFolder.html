<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
                    <title>phpDocumentor</title>
    

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <base href="../../../../">
    <link rel="icon" href="images/favicon.ico"/>
    <link rel="stylesheet" href="css/normalize.css">
    <link rel="stylesheet" href="css/base.css">
            <link rel="preconnect" href="https://fonts.gstatic.com">
        <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@100;200;300;400;600;700&display=swap" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:wght@400;600;700&display=swap" rel="stylesheet">
        <link rel="stylesheet" href="css/template.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0/css/all.min.css" integrity="sha256-ybRkN9dBjhcS2qrW1z+hfCxq+1aBdwyQM5wlQoQVt/0=" crossorigin="anonymous" />
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/themes/prism-okaidia.css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/plugins/line-numbers/prism-line-numbers.css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/plugins/line-highlight/prism-line-highlight.css">
                <script src="https://cdn.jsdelivr.net/npm/fuse.js@3.4.6"></script>
        <script src="https://cdn.jsdelivr.net/npm/css-vars-ponyfill@2"></script>
        <script src="js/template.js"></script>
        <script src="js/search.js"></script>
        <script defer src="js/searchIndex.js"></script>
    </head>
<body id="top">
    <header class="phpdocumentor-header phpdocumentor-section">
    <h1 class="phpdocumentor-title"><a href="" class="phpdocumentor-title__link">phpDocumentor</a></h1>
    <input class="phpdocumentor-header__menu-button" type="checkbox" id="menu-button" name="menu-button" />
    <label class="phpdocumentor-header__menu-icon" for="menu-button">
        <i class="fas fa-bars"></i>
    </label>
    <section data-search-form class="phpdocumentor-search">
    <label>
        <span class="visually-hidden">Search for</span>
        <svg class="phpdocumentor-search__icon" width="21" height="20" viewBox="0 0 21 20" fill="none" xmlns="http://www.w3.org/2000/svg">
            <circle cx="7.5" cy="7.5" r="6.5" stroke="currentColor" stroke-width="2"/>
            <line x1="12.4892" y1="12.2727" x2="19.1559" y2="18.9393" stroke="currentColor" stroke-width="3"/>
        </svg>
        <input type="search" class="phpdocumentor-field phpdocumentor-search__field" placeholder="Loading .." disabled />
    </label>
</section>

    <nav class="phpdocumentor-topnav">
    <ul class="phpdocumentor-topnav__menu">
        </ul>
</nav>
</header>

    <main class="phpdocumentor">
        <div class="phpdocumentor-section">
            <input class="phpdocumentor-sidebar__menu-button" type="checkbox" id="sidebar-button" name="sidebar-button" />
<label class="phpdocumentor-sidebar__menu-icon" for="sidebar-button">
    Menu
</label>
<aside class="phpdocumentor-column -three phpdocumentor-sidebar">
                    <section class="phpdocumentor-sidebar__category">
            <h2 class="phpdocumentor-sidebar__category-header">typo3-explained</h2>
                                    <h4 class="phpdocumentor-sidebar__root-namespace">
    <a href="guide/Introduction/Index.html#introduction" class="">Introduction</a>
</h4>
    <ul class="phpdocumentor-list">
                    <li>
                <a href="guide/Introduction/Index.html#system-overview-1" class="">System Overview</a>
                
            </li>
                    <li>
                <a href="guide/Introduction/Index.html#a-basic-installation" class="">A basic installation</a>
                
            </li>
            </ul>

                                    <h4 class="phpdocumentor-sidebar__root-namespace">
    <a href="guide/ApiOverview/Index.html#api-a-z" class="">API A-Z</a>
</h4>

                                    <h4 class="phpdocumentor-sidebar__root-namespace">
    <a href="guide/CodingGuidelines/Index.html#cgl" class="">Coding Guidelines</a>
</h4>
    <ul class="phpdocumentor-list">
                    <li>
                <a href="guide/CodingGuidelines/Introduction.html#cgl-introduction" class="">Introduction</a>
                
            </li>
                    <li>
                <a href="guide/CodingGuidelines/CglPhp/Index.html#cgl-php" class="">PHP Coding Guidelines</a>
                
            </li>
                    <li>
                <a href="guide/CodingGuidelines/CglJavaScript/Index.html#cgl-javascript" class="">JavaScript Coding Guidelines</a>
                
            </li>
                    <li>
                <a href="guide/CodingGuidelines/CglTypeScript/Index.html#cgl-typescript" class="">TypeScript Coding Guidelines</a>
                
            </li>
                    <li>
                <a href="guide/CodingGuidelines/CglTypoScript/Index.html#cgl-typoscript" class="">TypoScript Coding Guidelines</a>
                
            </li>
                    <li>
                <a href="guide/CodingGuidelines/CglTsConfig.html#cgl-tsconfig" class="">TSconfig Coding Guidelines</a>
                
            </li>
                    <li>
                <a href="guide/CodingGuidelines/CglXliff/Index.html#cgl-xliff" class="">Xliff Coding Guidelines</a>
                
            </li>
                    <li>
                <a href="guide/CodingGuidelines/CglYaml.html#cgl-yaml" class="">Yaml Coding Guidelines</a>
                
            </li>
                    <li>
                <a href="guide/CodingGuidelines/CglRest/Index.html#cgl-rest" class="">reStructuredText (reST)</a>
                
            </li>
            </ul>

                                    <h4 class="phpdocumentor-sidebar__root-namespace">
    <a href="guide/Configuration/Index.html#configuration" class="">Configuration</a>
</h4>
    <ul class="phpdocumentor-list">
                    <li>
                <a href="guide/Configuration/ConfigurationOverview.html#config-overview" class="">Configuration overview</a>
                
            </li>
                    <li>
                <a href="guide/Configuration/Glossary.html#configuration-classification" class="">Glossary</a>
                
            </li>
                    <li>
                <a href="guide/Configuration/ConfigurationFiles.html#configuration-files" class="">Configuration files</a>
                
            </li>
                    <li>
                <a href="guide/Configuration/ConfigurationModule/Index.html#configuration-module" class="">Configuration module</a>
                
            </li>
                    <li>
                <a href="guide/Configuration/FeatureToggles.html#feature-toggles" class="">Feature toggles</a>
                
            </li>
                    <li>
                <a href="guide/Configuration/GlobalVariables.html#globals-variables" class="">$GLOBALS</a>
                
            </li>
                    <li>
                <a href="guide/Configuration/Typo3ConfVars/Index.html#typo3-conf-vars" class="">TYPO3_CONF_VARS</a>
                
            </li>
                    <li>
                <a href="guide/Configuration/Typo3Information.html#typo3Information" class="">Global meta information about TYPO3</a>
                
            </li>
                    <li>
                <a href="guide/Configuration/Tsconfig.html#tsconfig" class="">TSconfig</a>
                
            </li>
                    <li>
                <a href="guide/Configuration/TypoScriptSyntax/Index.html#typoscript-syntax-about" class="">TypoScript syntax</a>
                
            </li>
                    <li>
                <a href="guide/Configuration/UserSettingsConfiguration/Index.html#user-settings" class="">User settings configuration</a>
                
            </li>
                    <li>
                <a href="guide/Configuration/Yaml/Index.html#yaml" class="">YAML</a>
                
            </li>
            </ul>

                                    <h4 class="phpdocumentor-sidebar__root-namespace">
    <a href="guide/ExtensionArchitecture/Index.html#extension-development" class="">Extension development</a>
</h4>
    <ul class="phpdocumentor-list">
                    <li>
                <a href="guide/ExtensionArchitecture/Concepts/Index.html#extension-concepts" class="">Concepts</a>
                
            </li>
                    <li>
                <a href="guide/ExtensionArchitecture/FileStructure/Index.html#extension-reserved-folders-legacy" class="">File structure</a>
                
            </li>
                    <li>
                <a href="guide/ExtensionArchitecture/HowTo/Index.html#extension-howto" class="">Howto</a>
                
            </li>
                    <li>
                <a href="guide/ExtensionArchitecture/Extbase/Index.html#extbase" class="">Extbase</a>
                
            </li>
                    <li>
                <a href="guide/ExtensionArchitecture/BestPractises/Index.html#extension-Best-practises" class="">Best practises and conventions</a>
                
            </li>
                    <li>
                <a href="guide/ExtensionArchitecture/Tutorials/Index.html#extension-tutorials" class="">Tutorials</a>
                
            </li>
            </ul>

                                    <h4 class="phpdocumentor-sidebar__root-namespace">
    <a href="guide/Security/Index.html#security" class="">Security guidelines</a>
</h4>
    <ul class="phpdocumentor-list">
                    <li>
                <a href="guide/Security/Introduction/Index.html#security-introduction" class="">Introduction</a>
                
            </li>
                    <li>
                <a href="guide/Security/SecurityTeam/Index.html#security-team" class="">The TYPO3 Security Team</a>
                
            </li>
                    <li>
                <a href="guide/Security/GeneralInformation/Index.html#security-general-information" class="">General Information</a>
                
            </li>
                    <li>
                <a href="guide/Security/TypesOfThreats/Index.html#security-threats" class="">Types of Security Threats</a>
                
            </li>
                    <li>
                <a href="guide/Security/GeneralGuidelines/Index.html#security-general-guidelines" class="">General guidelines</a>
                
            </li>
                    <li>
                <a href="guide/Security/GuidelinesAdministrators/Index.html#security-administrators" class="">Guidelines for System Administrators</a>
                
            </li>
                    <li>
                <a href="guide/Security/GuidelinesExtensionDevelopment/Index.html#security-extension-development" class="">Guidelines for extension development</a>
                
            </li>
                    <li>
                <a href="guide/Security/GuidelinesIntegrators/Index.html#security-integrators" class="">Guidelines for TYPO3 integrators</a>
                
            </li>
                    <li>
                <a href="guide/Security/GuidelinesEditors/Index.html#security-editors" class="">Guidelines for editors</a>
                
            </li>
                    <li>
                <a href="guide/Security/Backups/Index.html#security-backups" class="">Backup strategy</a>
                
            </li>
                    <li>
                <a href="guide/Security/HackedSite/Index.html#security-detect-analyze-repair" class="">Detect, analyze and repair a hacked site</a>
                
            </li>
            </ul>

                                    <h4 class="phpdocumentor-sidebar__root-namespace">
    <a href="guide/Testing/Index.html#testing" class="">Testing</a>
</h4>
    <ul class="phpdocumentor-list">
                    <li>
                <a href="guide/Testing/History.html#testing-history" class="">History</a>
                
            </li>
                    <li>
                <a href="guide/Testing/CoreTesting.html#testing-core" class="">Core testing</a>
                
            </li>
                    <li>
                <a href="guide/Testing/ExtensionTesting.html#testing-extensions" class="">Extension testing</a>
                
            </li>
                    <li>
                <a href="guide/Testing/ProjectTesting.html#testing-projects" class="">Project testing</a>
                
            </li>
                    <li>
                <a href="guide/Testing/WritingUnit.html#testing-writing-unit" class="">Writing unit tests</a>
                
            </li>
                    <li>
                <a href="guide/Testing/WritingFunctional.html#testing-writing-functional" class="">Writing functional tests</a>
                
            </li>
                    <li>
                <a href="guide/Testing/WritingAcceptance.html#testing-writing-acceptance" class="">Writing acceptance tests</a>
                
            </li>
                    <li>
                <a href="guide/Testing/Faq.html#testing-faq" class="">FAQ</a>
                
            </li>
            </ul>

                                    <h4 class="phpdocumentor-sidebar__root-namespace">
    <a href="guide/About.html#about" class="">About This Manual</a>
</h4>
    <ul class="phpdocumentor-list">
                    <li>
                <a href="guide/About.html#intended-audience" class="">Intended Audience</a>
                
            </li>
                    <li>
                <a href="guide/About.html#code-examples-1" class="">Code examples</a>
                
            </li>
                    <li>
                <a href="guide/About.html#feedback-and-contribute" class="">Feedback and Contribute</a>
                
            </li>
                    <li>
                <a href="guide/About.html#credits-1" class="">Credits</a>
                
            </li>
                    <li>
                <a href="guide/About.html#dedication-1" class="">Dedication</a>
                
            </li>
            </ul>

                                    <h4 class="phpdocumentor-sidebar__root-namespace">
    <a href="guide/Sitemap.html#sitemap" class="">Sitemap</a>
</h4>

                                    <h4 class="phpdocumentor-sidebar__root-namespace">
    <a href="guide/genindex.html#index" class="">Index</a>
</h4>

                        </section>
            
    <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Reports</h2>
                <h3 class="phpdocumentor-sidebar__root-package"><a href="reports/deprecated.html">Deprecated</a></h3>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="reports/errors.html">Errors</a></h3>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="reports/markers.html">Markers</a></h3>
    </section>

    <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Indices</h2>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="indices/files.html">Files</a></h3>
    </section>
</aside>

            <div class="phpdocumentor-column -nine phpdocumentor-content">
                                        <section>
        
<div class="section" id="fal-using-fal-examples-file-folder">
    <h1>Working With files, folders and file references</h1>
            <p>This chapter provides some examples about interacting
with file, folder and FileReference objects.</p>
            <a id="fal-using-fal-examples-file-folder-get-file"></a>
    </div>
<div class="section" id="getting-a-file">
    <h1>Getting a file</h1>
            <p>A file can be retrieved using its uid:</p>
            <pre><code class="language-php">use TYPO3\CMS\Core\Utility\GeneralUtility;
use TYPO3\CMS\Core\Resource\ResourceFactory;

$resourceFactory = GeneralUtility::makeInstance(ResourceFactory::class);
$file = $resourceFactory-&gt;getFileObject(4);</code></pre>
            <p>or its combined identifier:</p>
            <pre><code class="language-php">$resourceFactory = GeneralUtility::makeInstance(ResourceFactory::class);
$file = $resourceFactory-&gt;getFileObjectFromCombinedIdentifier(&#039;1:/foo.txt&#039;);</code></pre>
            <p>or by filename from its folder:</p>
            <pre><code class="language-php">$storageRepository = GeneralUtility::makeInstance(StorageRepository::class);
$defaultStorage = $storageRepository-&gt;getDefaultStorage();
$folder = $defaultStorage-&gt;getFolder(&#039;/some/path/in/storage/&#039;);
$file = $folder-&gt;getStorage()-&gt;getFileInFolder(&quot;example.ext&quot;, $folder);</code></pre>
            <p>or directly by its filename from the folder:</p>
            <pre><code class="language-php">$file = $folder-&gt;getFile(&quot;filename.ext&quot;);</code></pre>
            <p>The syntax of argument 1 for getFileObjectFromCombinedIdentifier is</p>
            <pre><code class="language-none">[[storage uid]:]&lt;file identifier&gt;</code></pre>
            <p>The return value is</p>
            <pre><code class="language-none">File|ProcessedFile|null</code></pre>
            <p>The storage uid is optional. If it is not specified, the default storage 0 will be assumed initially.
The default storage is virtual with $uid === 0 in its class \TYPO3\CMS\Core\Resource\ResourceStorage. In this case the local filesystem is checked for the given file.
The file identifier is the local path and filename relative to the TYPO3 fileadmin/ folder.
Example: /templates/stylesheets/fonts.css, if the file /absolute/path/to/fileadmin/templates/stylesheets/fonts.css exists on the file system.</p>
            <p>The file can be accessed from the default storage, if it exists under the given local path in fileadmin/.
In case the file is not found, a search for another storage best fitting to this local path will be started. Afterwards the file identifier is adapted accordingly inside of TYPO3 to match the new storage&#039;s base path.</p>
            <a id="fal-using-fal-examples-file-folder-copy-file"></a>
    </div>
<div class="section" id="copying-a-file">
    <h1>Copying a file</h1>
            <pre><code class="language-php">use TYPO3\CMS\Core\Utility\GeneralUtility;
use TYPO3\CMS\Core\Resource\StorageRepository;

$storageUid = 17;
$someFileIdentifier = &#039;templates/images/banner.jpg&#039;;
$someFolderIdentifier = &#039;website/images/&#039;;

$storageRepository = GeneralUtility::makeInstance(StorageRepository::class);
$storage = $storageRepository-&gt;getStorageObject($storageUid);

// $file returns a TYPO3\CMS\Core\Resource\File object
$file = $storage-&gt;getFile($someFileIdentifier);
// $folder returns a TYPO3\CMS\Core\Resource\Folder object
$folder = $storage-&gt;getFolder($someFolderIdentifier);

// returns the TYPO3\CMS\Core\Resource\File object of the new, copied file
$copiedFile = $file-&gt;copyTo($folder);</code></pre>
            <a id="fal-using-fal-examples-file-folder-delete-file"></a>
    </div>
<div class="section" id="deleting-a-file">
    <h1>Deleting a file</h1>
            <pre><code class="language-php">$file-&gt;delete();</code></pre>
            <a id="fal-using-fal-examples-file-folder-add-file"></a>
    </div>
<div class="section" id="adding-a-file">
    <h1>Adding a file</h1>
            <p>This example adds a new file in the root folder of the default
storage:</p>
            <pre><code class="language-php">use TYPO3\CMS\Core\Utility\GeneralUtility;
use TYPO3\CMS\Core\Resource\StorageRepository;

$storageRepository = GeneralUtility::makeInstance(StorageRepository::class);
$storage = $storageRepository-&gt;getDefaultStorage();
$newFile = $storage-&gt;addFile(
      &#039;/tmp/temporary_file_name.ext&#039;,
      $storage-&gt;getRootLevelFolder(),
      &#039;final_file_name.ext&#039;
);</code></pre>
            <p>The default storage uses fileadmin unless this was configured
differently, as explained in fal-concepts-storages-drivers.</p>
            <p>So, for this example, the resulting file path would typically be
</p>
            <p>To store the file in a sub folder use $storage-getFolder():</p>
            <pre><code class="language-php">$newFile = $storage-&gt;addFile(
      &#039;/tmp/temporary_file_name.ext&#039;,
      $storage-&gt;getFolder(&#039;some/nested/folder&#039;),
      &#039;final_file_name.ext&#039;
);</code></pre>
            <p>In this example, the file path would likely be
</p>
            <a id="fal-using-fal-examples-file-folder-create-reference"></a>
    </div>
<div class="section" id="creating-a-file-reference">
    <h1>Creating a file reference</h1>
            <a id="fal-using-fal-examples-file-folder-create-reference-backend"></a>
            <div class="section" id="in-the-backend-context">
    <h2>In the backend context</h2>
            <p>In the backend or command-line context, it is possible to create
file references using the DataHandler
processes (\TYPO3\CMS\Core\DataHandling\DataHandler).</p>
            <p>Assuming you have the &quot;uid&quot; of both the File and whatever other item
you want to create a relation to, the following code will create
the &quot;sys_file_reference&quot; entry and the relation to the other item
(in this case a &quot;tt_content&quot; record):</p>
            <pre><code class="language-php">use TYPO3\CMS\Core\Utility\GeneralUtility;
use TYPO3\CMS\Core\Resource\ResourceFactory;
use TYPO3\CMS\Backend\Utility\BackendUtility;
use TYPO3\CMS\Core\DataHandling\DataHandler;

$resourceFactory = GeneralUtility::makeInstance(ResourceFactory::class);
$fileObject = $resourceFactory-&gt;getFileObject((int)$file);
$contentElement = BackendUtility::getRecord(
        &#039;tt_content&#039;,
        (int)$element
);
// Assemble DataHandler data
$newId = &#039;NEW1234&#039;;
$data = [];
$data[&#039;sys_file_reference&#039;][$newId] = [
        &#039;table_local&#039; =&gt; &#039;sys_file&#039;,
        &#039;uid_local&#039; =&gt; $fileObject-&gt;getUid(),
        &#039;tablenames&#039; =&gt; &#039;tt_content&#039;,
        &#039;uid_foreign&#039; =&gt; $contentElement[&#039;uid&#039;],
        &#039;fieldname&#039; =&gt; &#039;assets&#039;,
        &#039;pid&#039; =&gt; $contentElement[&#039;pid&#039;]
];
$data[&#039;tt_content&#039;][$contentElement[&#039;uid&#039;]] = [
        &#039;assets&#039; =&gt; $newId
];
// Get an instance of the DataHandler and process the data
/** @var DataHandler $dataHandler */
$dataHandler = GeneralUtility::makeInstance(DataHandler::class);
$dataHandler-&gt;start($data, []);
$dataHandler-&gt;process_datamap();
// Error or success reporting
if (count($dataHandler-&gt;errorLog) === 0) {
    // Handle success
} else {
    // Handle errors
}</code></pre>
            <p>The above example comes from the &quot;examples&quot; extension
(reference: <a href="https://github.com/TYPO3-Documentation/t3docs-examples/blob/main/Classes/Controller/ModuleController.php">https://github.com/TYPO3-Documentation/t3docs-examples/blob/main/Classes/Controller/ModuleController.php</a>).</p>
            <p>Here, the 'fieldname' 'assets' is used instead of
image. Content elements of ctype &#039;textmedia&#039; use the field &#039;assets&#039;.</p>
            <p>For another table than &quot;tt_content&quot;, you need to define
the &quot;pid&quot; explicitly when creating the relation:</p>
            <pre><code class="language-php">$data[&#039;tt_address&#039;][$address[&#039;uid&#039;]] = [
    &#039;pid&#039; =&gt; $address[&#039;pid&#039;],
    &#039;image&#039; =&gt; &#039;NEW1234&#039; // changed automatically
];</code></pre>
            <a id="fal-using-fal-examples-file-folder-create-reference-frontend"></a>
    </div>
            <div class="section" id="in-the-frontend-context">
    <h2>In the Frontend Context</h2>
            <p>In a frontend context, the \TYPO3\CMS\Core\DataHandling\DataHandler
class cannot be used and there is no specific API to create a file reference.
You are on your own.</p>
            <p>The simplest solution is to create a database entry into
table &quot;sys_file_reference&quot; by using the database connection
class provided by TYPO3.</p>
            <p>A cleaner solution using Extbase requires far more work. An example
can be found here: <a href="https://github.com/helhum/upload_example">https://github.com/helhum/upload_example</a></p>
            <a id="fal-using-fal-examples-file-folder-get-references"></a>
    </div>
    </div>
<div class="section" id="getting-referenced-files">
    <h1>Getting Referenced files</h1>
            <p>This snippet shows how to retrieve FAL items that have been attached
to some other element, in this case the &quot;media&quot; field of the &quot;pages&quot;
table:</p>
            <pre><code class="language-php">use TYPO3\CMS\Core\Utility\GeneralUtility;
use TYPO3\CMS\Core\Resource\FileRepository;

$fileRepository = GeneralUtility::makeInstance(FileRepository::class);
$fileObjects = $fileRepository-&gt;findByRelation(&#039;pages&#039;, &#039;media&#039;, $uid);</code></pre>
            <p>where $uid is the id of some page. The return value is an array
of \TYPO3\CMS\Core\Resource\FileReference objects.</p>
            <a id="fal-using-fal-examples-file-folder-list-files"></a>
    </div>
<div class="section" id="listing-files-in-a-folder">
    <h1>Listing files in a folder</h1>
            <p>These would be the shortest steps to get the list of files in a given
folder: get the storage, get a folder object for some path in that
storage (path relative to storage root), finally retrieve the files:</p>
            <pre><code class="language-php">use TYPO3\CMS\Core\Utility\GeneralUtility;
use TYPO3\CMS\Core\Resource\StorageRepository;

$storageRepository = GeneralUtility::makeInstance(StorageRepository::class);
$defaultStorage = $storageRepository-&gt;getDefaultStorage();
$folder = $defaultStorage-&gt;getFolder(&#039;/some/path/in/storage/&#039;);
$files = $defaultStorage-&gt;getFilesInFolder($folder);</code></pre>
    </div>
<div class="section" id="dumping-a-file-via-eid-script">
    <h1>Dumping a file via eID Script</h1>
            <p>TYPO3 registers an eID script that allows dumping / downloading / referencing files via their FAL ids. Non-public storages use this script
to make their files available to view or download. File retrieval is done via PHP and delivered through the eID script.</p>
            <p>An example URL looks like thisindex.php?eID=dumpFile&t=f&f=1230&token=135b17c52f5e718b7cc94e44186eb432e0cc6d2f.</p>
            <p>Following URI-Parameters are available:</p>
            

<ul>
    <li>t (<em>Type</em>)f (sys_file), r (sys_file_reference) or p (sys_file_processedfile)</li>
    <li>f (<em>File</em>)sys_file</li>
    <li>r (<em>Reference</em>)sys_file_reference</li>
    <li>p (<em>Processed</em>)sys_file_processedfile</li>
    <li>s (<em>Size</em>): Size (width and height) of the file</li>
    <li>cv (<em>CropVariant</em>)sys_file_reference, you can assign a cropping variant</li>
</ul>
            <p>You have to choose one of these parametersf, r or p. It is not possible
to combine them in one request.</p>
            <p>The Parameter s has following syntax: width:height:minW:minH:maxW:maxH. You
can leave this parameter empty to load the file in its original size. Parameter width
and height can feature the trailing c or m indicator, as known from TypoScript.</p>
            <p>The PHP class responsible for handling the file dumping is the FileDumpController, which you
may also use in your code.</p>
            <p>See the following example on how to create a URI using the FileDumpController for
a sys_file record with a fixed image size:</p>
            <pre><code class="language-php">$queryParameterArray = [&#039;eID&#039; =&gt; &#039;dumpFile&#039;, &#039;t&#039; =&gt; &#039;f&#039;];
$queryParameterArray[&#039;f&#039;] = $resourceObject-&gt;getUid();
$queryParameterArray[&#039;s&#039;] = &#039;320c:280c&#039;;
$queryParameterArray[&#039;token&#039;] = GeneralUtility::hmac(implode(&#039;|&#039;, $queryParameterArray), &#039;resourceStorageDumpFile&#039;);
$publicUrl = GeneralUtility::locationHeaderUrl(PathUtility::getAbsoluteWebPath(Environment::getPublicPath() . &#039;/index.php&#039;));
$publicUrl .= &#039;?&#039; . http_build_query($queryParameterArray, &#039;&#039;, &#039;&amp;&#039;, PHP_QUERY_RFC3986);</code></pre>
            <p>In this example crop variant default and an image size of 320:280 will be
applied to a sys_file_reference record:</p>
            <pre><code class="language-php">$queryParameterArray = [&#039;eID&#039; =&gt; &#039;dumpFile&#039;, &#039;t&#039; =&gt; &#039;r&#039;];
$queryParameterArray[&#039;f&#039;] = $resourceObject-&gt;getUid();
$queryParameterArray[&#039;s&#039;] = &#039;320c:280c:320:280:320:280&#039;;
$queryParameterArray[&#039;cv&#039;] = &#039;default&#039;;
$queryParameterArray[&#039;token&#039;] = GeneralUtility::hmac(implode(&#039;|&#039;, $queryParameterArray), &#039;resourceStorageDumpFile&#039;);
$publicUrl = GeneralUtility::locationHeaderUrl(PathUtility::getAbsoluteWebPath(Environment::getPublicPath() . &#039;/index.php&#039;));
$publicUrl .= &#039;?&#039; . http_build_query($queryParameterArray, &#039;&#039;, &#039;&amp;&#039;, PHP_QUERY_RFC3986);</code></pre>
            <p>This example shows how to create a URI to load an image of
sys_file_processedfile:</p>
            <pre><code class="language-php">$queryParameterArray = [&#039;eID&#039; =&gt; &#039;dumpFile&#039;, &#039;t&#039; =&gt; &#039;p&#039;];
$queryParameterArray[&#039;p&#039;] = $resourceObject-&gt;getUid();
$queryParameterArray[&#039;token&#039;] = GeneralUtility::hmac(implode(&#039;|&#039;, $queryParameterArray), &#039;resourceStorageDumpFile&#039;);
$publicUrl = GeneralUtility::locationHeaderUrl(PathUtility::getAbsoluteWebPath(Environment::getPublicPath() . &#039;/index.php&#039;));
$publicUrl .= &#039;?&#039; . http_build_query($queryParameterArray, &#039;&#039;, &#039;&amp;&#039;, PHP_QUERY_RFC3986);</code></pre>
            <p>The following restrictions apply:</p>
            

<ul>
    <li>You can&#039;t assign any size parameter to processed files, as they are already resized.</li>
    <li>You can&#039;t apply CropVariants to sys_file and sys_file_processedfile records, only to sys_file_reference</li>
</ul>
    </div>

    </section>
                            </div>
            <section data-search-results class="phpdocumentor-search-results phpdocumentor-search-results--hidden">
    <section class="phpdocumentor-search-results__dialog">
        <header class="phpdocumentor-search-results__header">
            <h2 class="phpdocumentor-search-results__title">Search results</h2>
            <button class="phpdocumentor-search-results__close"><i class="fas fa-times"></i></button>
        </header>
        <section class="phpdocumentor-search-results__body">
            <ul class="phpdocumentor-search-results__entries"></ul>
        </section>
    </section>
</section>
        </div>
        <a href="guide/ApiOverview/Fal/UsingFal/ExamplesFileFolder.html#top" class="phpdocumentor-back-to-top"><i class="fas fa-chevron-circle-up"></i></a>

    </main>

    <script>
        cssVars({});
    </script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/prism.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/plugins/line-numbers/prism-line-numbers.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/plugins/line-highlight/prism-line-highlight.min.js"></script>
</body>
</html>