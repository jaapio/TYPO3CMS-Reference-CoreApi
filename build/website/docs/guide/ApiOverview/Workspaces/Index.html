<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
                    <title>phpDocumentor</title>
    

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <base href="../../../">
    <link rel="icon" href="images/favicon.ico"/>
    <link rel="stylesheet" href="css/normalize.css">
    <link rel="stylesheet" href="css/base.css">
            <link rel="preconnect" href="https://fonts.gstatic.com">
        <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@100;200;300;400;600;700&display=swap" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:wght@400;600;700&display=swap" rel="stylesheet">
        <link rel="stylesheet" href="css/template.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0/css/all.min.css" integrity="sha256-ybRkN9dBjhcS2qrW1z+hfCxq+1aBdwyQM5wlQoQVt/0=" crossorigin="anonymous" />
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/themes/prism-okaidia.css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/plugins/line-numbers/prism-line-numbers.css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/plugins/line-highlight/prism-line-highlight.css">
                <script src="https://cdn.jsdelivr.net/npm/fuse.js@3.4.6"></script>
        <script src="https://cdn.jsdelivr.net/npm/css-vars-ponyfill@2"></script>
        <script src="js/template.js"></script>
        <script src="js/search.js"></script>
        <script defer src="js/searchIndex.js"></script>
    </head>
<body id="top">
    <header class="phpdocumentor-header phpdocumentor-section">
    <h1 class="phpdocumentor-title"><a href="" class="phpdocumentor-title__link">phpDocumentor</a></h1>
    <input class="phpdocumentor-header__menu-button" type="checkbox" id="menu-button" name="menu-button" />
    <label class="phpdocumentor-header__menu-icon" for="menu-button">
        <i class="fas fa-bars"></i>
    </label>
    <section data-search-form class="phpdocumentor-search">
    <label>
        <span class="visually-hidden">Search for</span>
        <svg class="phpdocumentor-search__icon" width="21" height="20" viewBox="0 0 21 20" fill="none" xmlns="http://www.w3.org/2000/svg">
            <circle cx="7.5" cy="7.5" r="6.5" stroke="currentColor" stroke-width="2"/>
            <line x1="12.4892" y1="12.2727" x2="19.1559" y2="18.9393" stroke="currentColor" stroke-width="3"/>
        </svg>
        <input type="search" class="phpdocumentor-field phpdocumentor-search__field" placeholder="Loading .." disabled />
    </label>
</section>

    <nav class="phpdocumentor-topnav">
    <ul class="phpdocumentor-topnav__menu">
        </ul>
</nav>
</header>

    <main class="phpdocumentor">
        <div class="phpdocumentor-section">
            <input class="phpdocumentor-sidebar__menu-button" type="checkbox" id="sidebar-button" name="sidebar-button" />
<label class="phpdocumentor-sidebar__menu-icon" for="sidebar-button">
    Menu
</label>
<aside class="phpdocumentor-column -three phpdocumentor-sidebar">
                    <section class="phpdocumentor-sidebar__category">
            <h2 class="phpdocumentor-sidebar__category-header">typo3-explained</h2>
                                    <h4 class="phpdocumentor-sidebar__root-namespace">
    <a href="guide/Introduction/Index.html#introduction" class="">Introduction</a>
</h4>
    <ul class="phpdocumentor-list">
                    <li>
                <a href="guide/Introduction/Index.html#system-overview-1" class="">System Overview</a>
                
            </li>
                    <li>
                <a href="guide/Introduction/Index.html#a-basic-installation" class="">A basic installation</a>
                
            </li>
            </ul>

                                    <h4 class="phpdocumentor-sidebar__root-namespace">
    <a href="guide/ApiOverview/Index.html#api-a-z" class="">API A-Z</a>
</h4>

                                    <h4 class="phpdocumentor-sidebar__root-namespace">
    <a href="guide/CodingGuidelines/Index.html#cgl" class="">Coding Guidelines</a>
</h4>
    <ul class="phpdocumentor-list">
                    <li>
                <a href="guide/CodingGuidelines/Introduction.html#cgl-introduction" class="">Introduction</a>
                
            </li>
                    <li>
                <a href="guide/CodingGuidelines/CglPhp/Index.html#cgl-php" class="">PHP Coding Guidelines</a>
                
            </li>
                    <li>
                <a href="guide/CodingGuidelines/CglJavaScript/Index.html#cgl-javascript" class="">JavaScript Coding Guidelines</a>
                
            </li>
                    <li>
                <a href="guide/CodingGuidelines/CglTypeScript/Index.html#cgl-typescript" class="">TypeScript Coding Guidelines</a>
                
            </li>
                    <li>
                <a href="guide/CodingGuidelines/CglTypoScript/Index.html#cgl-typoscript" class="">TypoScript Coding Guidelines</a>
                
            </li>
                    <li>
                <a href="guide/CodingGuidelines/CglTsConfig.html#cgl-tsconfig" class="">TSconfig Coding Guidelines</a>
                
            </li>
                    <li>
                <a href="guide/CodingGuidelines/CglXliff/Index.html#cgl-xliff" class="">Xliff Coding Guidelines</a>
                
            </li>
                    <li>
                <a href="guide/CodingGuidelines/CglYaml.html#cgl-yaml" class="">Yaml Coding Guidelines</a>
                
            </li>
                    <li>
                <a href="guide/CodingGuidelines/CglRest/Index.html#cgl-rest" class="">reStructuredText (reST)</a>
                
            </li>
            </ul>

                                    <h4 class="phpdocumentor-sidebar__root-namespace">
    <a href="guide/Configuration/Index.html#configuration" class="">Configuration</a>
</h4>
    <ul class="phpdocumentor-list">
                    <li>
                <a href="guide/Configuration/ConfigurationOverview.html#config-overview" class="">Configuration overview</a>
                
            </li>
                    <li>
                <a href="guide/Configuration/Glossary.html#configuration-classification" class="">Glossary</a>
                
            </li>
                    <li>
                <a href="guide/Configuration/ConfigurationFiles.html#configuration-files" class="">Configuration files</a>
                
            </li>
                    <li>
                <a href="guide/Configuration/ConfigurationModule/Index.html#configuration-module" class="">Configuration module</a>
                
            </li>
                    <li>
                <a href="guide/Configuration/FeatureToggles.html#feature-toggles" class="">Feature toggles</a>
                
            </li>
                    <li>
                <a href="guide/Configuration/GlobalVariables.html#globals-variables" class="">$GLOBALS</a>
                
            </li>
                    <li>
                <a href="guide/Configuration/Typo3ConfVars/Index.html#typo3-conf-vars" class="">TYPO3_CONF_VARS</a>
                
            </li>
                    <li>
                <a href="guide/Configuration/Typo3Information.html#typo3Information" class="">Global meta information about TYPO3</a>
                
            </li>
                    <li>
                <a href="guide/Configuration/Tsconfig.html#tsconfig" class="">TSconfig</a>
                
            </li>
                    <li>
                <a href="guide/Configuration/TypoScriptSyntax/Index.html#typoscript-syntax-about" class="">TypoScript syntax</a>
                
            </li>
                    <li>
                <a href="guide/Configuration/UserSettingsConfiguration/Index.html#user-settings" class="">User settings configuration</a>
                
            </li>
                    <li>
                <a href="guide/Configuration/Yaml/Index.html#yaml" class="">YAML</a>
                
            </li>
            </ul>

                                    <h4 class="phpdocumentor-sidebar__root-namespace">
    <a href="guide/ExtensionArchitecture/Index.html#extension-development" class="">Extension development</a>
</h4>
    <ul class="phpdocumentor-list">
                    <li>
                <a href="guide/ExtensionArchitecture/Concepts/Index.html#extension-concepts" class="">Concepts</a>
                
            </li>
                    <li>
                <a href="guide/ExtensionArchitecture/FileStructure/Index.html#extension-reserved-folders-legacy" class="">File structure</a>
                
            </li>
                    <li>
                <a href="guide/ExtensionArchitecture/HowTo/Index.html#extension-howto" class="">Howto</a>
                
            </li>
                    <li>
                <a href="guide/ExtensionArchitecture/Extbase/Index.html#extbase" class="">Extbase</a>
                
            </li>
                    <li>
                <a href="guide/ExtensionArchitecture/BestPractises/Index.html#extension-Best-practises" class="">Best practises and conventions</a>
                
            </li>
                    <li>
                <a href="guide/ExtensionArchitecture/Tutorials/Index.html#extension-tutorials" class="">Tutorials</a>
                
            </li>
            </ul>

                                    <h4 class="phpdocumentor-sidebar__root-namespace">
    <a href="guide/Security/Index.html#security" class="">Security guidelines</a>
</h4>
    <ul class="phpdocumentor-list">
                    <li>
                <a href="guide/Security/Introduction/Index.html#security-introduction" class="">Introduction</a>
                
            </li>
                    <li>
                <a href="guide/Security/SecurityTeam/Index.html#security-team" class="">The TYPO3 Security Team</a>
                
            </li>
                    <li>
                <a href="guide/Security/GeneralInformation/Index.html#security-general-information" class="">General Information</a>
                
            </li>
                    <li>
                <a href="guide/Security/TypesOfThreats/Index.html#security-threats" class="">Types of Security Threats</a>
                
            </li>
                    <li>
                <a href="guide/Security/GeneralGuidelines/Index.html#security-general-guidelines" class="">General guidelines</a>
                
            </li>
                    <li>
                <a href="guide/Security/GuidelinesAdministrators/Index.html#security-administrators" class="">Guidelines for System Administrators</a>
                
            </li>
                    <li>
                <a href="guide/Security/GuidelinesExtensionDevelopment/Index.html#security-extension-development" class="">Guidelines for extension development</a>
                
            </li>
                    <li>
                <a href="guide/Security/GuidelinesIntegrators/Index.html#security-integrators" class="">Guidelines for TYPO3 integrators</a>
                
            </li>
                    <li>
                <a href="guide/Security/GuidelinesEditors/Index.html#security-editors" class="">Guidelines for editors</a>
                
            </li>
                    <li>
                <a href="guide/Security/Backups/Index.html#security-backups" class="">Backup strategy</a>
                
            </li>
                    <li>
                <a href="guide/Security/HackedSite/Index.html#security-detect-analyze-repair" class="">Detect, analyze and repair a hacked site</a>
                
            </li>
            </ul>

                                    <h4 class="phpdocumentor-sidebar__root-namespace">
    <a href="guide/Testing/Index.html#testing" class="">Testing</a>
</h4>
    <ul class="phpdocumentor-list">
                    <li>
                <a href="guide/Testing/History.html#testing-history" class="">History</a>
                
            </li>
                    <li>
                <a href="guide/Testing/CoreTesting.html#testing-core" class="">Core testing</a>
                
            </li>
                    <li>
                <a href="guide/Testing/ExtensionTesting.html#testing-extensions" class="">Extension testing</a>
                
            </li>
                    <li>
                <a href="guide/Testing/ProjectTesting.html#testing-projects" class="">Project testing</a>
                
            </li>
                    <li>
                <a href="guide/Testing/WritingUnit.html#testing-writing-unit" class="">Writing unit tests</a>
                
            </li>
                    <li>
                <a href="guide/Testing/WritingFunctional.html#testing-writing-functional" class="">Writing functional tests</a>
                
            </li>
                    <li>
                <a href="guide/Testing/WritingAcceptance.html#testing-writing-acceptance" class="">Writing acceptance tests</a>
                
            </li>
                    <li>
                <a href="guide/Testing/Faq.html#testing-faq" class="">FAQ</a>
                
            </li>
            </ul>

                                    <h4 class="phpdocumentor-sidebar__root-namespace">
    <a href="guide/About.html#about" class="">About This Manual</a>
</h4>
    <ul class="phpdocumentor-list">
                    <li>
                <a href="guide/About.html#intended-audience" class="">Intended Audience</a>
                
            </li>
                    <li>
                <a href="guide/About.html#code-examples-1" class="">Code examples</a>
                
            </li>
                    <li>
                <a href="guide/About.html#feedback-and-contribute" class="">Feedback and Contribute</a>
                
            </li>
                    <li>
                <a href="guide/About.html#credits-1" class="">Credits</a>
                
            </li>
                    <li>
                <a href="guide/About.html#dedication-1" class="">Dedication</a>
                
            </li>
            </ul>

                                    <h4 class="phpdocumentor-sidebar__root-namespace">
    <a href="guide/Sitemap.html#sitemap" class="">Sitemap</a>
</h4>

                                    <h4 class="phpdocumentor-sidebar__root-namespace">
    <a href="guide/genindex.html#index" class="">Index</a>
</h4>

                        </section>
            
    <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Reports</h2>
                <h3 class="phpdocumentor-sidebar__root-package"><a href="reports/deprecated.html">Deprecated</a></h3>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="reports/errors.html">Errors</a></h3>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="reports/markers.html">Markers</a></h3>
    </section>

    <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Indices</h2>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="indices/files.html">Files</a></h3>
    </section>
</aside>

            <div class="phpdocumentor-column -nine phpdocumentor-content">
                                        <section>
        
<div class="section" id="workspaces">
    <h1>Versioning and Workspaces</h1>
            <p>TYPO3 provides a feature called &quot;workspaces&quot;, whereby changes
can be made to the content of the web site without affecting the
currently visible (live) version. Changes can be previewed and
go through an approval process before publishing.</p>
            <p>The technical background and a practical user guide to this feature
are provided in the "workspaces" system extension manual.</p>
            <p>All the information necessary for making any database table
compatible with workspaces is described in the
TCA reference (in the description of the "ctrl" section
and in the description of the "versioningWS" property).</p>
            <p>You might want to turn the workspace off for certain tables.
The only way to do so is with a Configuration/TCA/Overrides/example_table.php:</p>
            <pre><code class="language-php">$GLOBALS[&#039;TCA&#039;][&#039;example_table&#039;][&#039;ctrl&#039;][&#039;versioningWS&#039;] = false;</code></pre>
            <p>See t3sitepackage:start and storing-changes-extension-overrides .</p>
            <div class="phpdocumentor-admonition -note">
            <svg class="phpdocumentor-admonition__icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"></path></svg>
                    <article>
        <p>This will lead to all t3ver_* fields of the example table to be marked as obsolete,
if they have not be defined explicitly in an extension. A subsequent DB schema update will then drop these fields.</p>

    </article>
</div>
            <p>The concept of workspaces needs attention from extension programmers.
The implementation of workspaces is however made, so that no critical
problems can appear with old extensions;</p>
            

<ul>
    <li class="dash">First of all the &quot;Live workspace&quot; is no different from how TYPO3 has
been working for years so that will be supported out of the box
(except placeholder records must be filtered out in the frontend with
t3ver_state != , see below).</li>
    <li class="dash">Secondly, all permission related issues are implemented in DataHandler so
the worst your users can experience is an error message.</li>
</ul>
            <p>However, you probably want to update your extension so that in the
backend the current workspace is reflected in the records shown and
the preview of content in the frontend works as well. Therefore this
chapter has been written with instructions and insight into the issues
you are facing.</p>
            <a id="workspaces-frontend"></a>
    </div>
<div class="section" id="frontend-challenges-in-general">
    <h1>Frontend challenges in general</h1>
            <p>For the frontend the challenges are mostly related to creating correct
previews of content in workspaces. For most extensions this will work
transparently as long as they use the API functions in TYPO3 to
request records from the system.</p>
            <p>The most basic form of a preview is when a live record is selected and
you lookup a future version of that record belonging to the current
workspace of the logged in backend user. This is very easy as long as
a record is selected based on its &quot;uid&quot; or &quot;pid&quot; fields which are not
subject to versioningsys_page-versionOL() after
record selection.</p>
            <p>However, when other fields are involved in the where clause it gets
dirty. This happens all the time! For instance, all records displayed
in the frontend must be selected with respect to &quot;enableFields&quot;
configuration! What if the future version is hidden and the live
version is not? Since the live version is selected first (not hidden)
and then overlaid with the content of the future version (hidden) the
effect of the hidden field we wanted to preview is lost unless we also
check the overlaid record for its hidden field (-versionOL() actually
does this). But what about the opposite; if the live record was hidden
and the future version not? Since the live version is never selected
the future version will never have a chance to display itself! So we
must first select the live records with no regard to the hidden state,
then overlay the future version and eventually check if it is hidden
and if so exclude it. The same problem applies to all other
&quot;enableFields&quot;, future versions with &quot;delete&quot; flags and current
versions which are invisible placeholders for future records. Anyway,
all that is handled by the
\TYPO3\CMS\Core\Domain\Repository\PageRepository class which includes
functions for &quot;enableFields&quot; and &quot;deleted&quot; so it will work out of the
box for you. But as soon as you do selection based on other fields
like email, username, alias etc. it will fail.</p>
            <a id="workspaces-frontend-summary"></a>
            <div class="section" id="summary">
    <h2>Summary</h2>
            <p>**Challenget3ver_state
set to 1 (placeholder for new elements) but only when not previewed.</p>
            <p>**SolutionenableFields/where_del_hidden on
live records and check for them in versionOL on input record.</p>
            <a id="workspaces-frontend-guidelines"></a>
    </div>
    </div>
<div class="section" id="frontend-implementation-guidelines">
    <h1>Frontend implementation guidelines</h1>
            <p>Any place where enableFields() are not used for selecting in the
frontend you must at least check that t3ver_state != 1 so
placeholders for new records are not displayed.</p>
            <p>If you need to detect preview mode for versioning and workspaces you
can use the Context object.
GeneralUtility::makeInstance(Context::class)-getPropertyFromAspect('workspace', 'id', 0);
gives you the id of the workspace of the current backend user. Used
for preview of workspaces.</p>
            <p>Use the following API function for support of version previews in the
frontend:</p>
            <dl>
                        <dt>$GLOBALS[&#039;TSFE&#039;]-&gt;sys_page-&gt;versionOL($table, &amp;$row, $unsetMovePointers=FALSE)</dt>
        
        <dd><p>Versioning Preview Overlay.</p><p>Generally ALWAYS used when records are selected based on uid or pid.
If records are selected on other fields than uid or pid (e.g. &quot;email =
....&quot;) then usage might produce undesired results and that should be
evaluated on individual basis.</p><p>Principle: Record online! =&gt; Find offline?</p><p><strong>Example:</strong></p><p>This is how simple it is to use this record in your frontend plugins
when you do queries directly (not using API functions already using
them):</p><pre><code class="language-php">$result = $queryBuilder-&gt;executeQuery();
while ($row = $result-&gt;fetchAssociative()) {
    $GLOBALS[&#039;TSFE&#039;]-&gt;sys_page-&gt;versionOL($table,$row);
    if (is_array($row)) {
        // ...
    }
    // ...
}</code></pre><p>When the live record is selected, call -versionOL() and make
sure to check if the input row (passed by reference) is still an array.</p><p>The third argument, $unsetMovePointers = FALSE, can be set to
TRUE when selecting records for display ordered by their position in
the page tree. Difficult to explain easily, so only use this option if you
don&#039;t get a correct preview of records that has been moved in a
workspace (only for &quot;element&quot; type versioning)</p></dd><dd></dd>    </dl>
            <a id="workspaces-frontend-problems"></a>
    </div>
<div class="section" id="frontend-scenarios-impossible-to-preview">
    <h1>Frontend scenarios impossible to preview</h1>
            <p>These issues are not planned to be supported for preview:</p>
            

<ul>
    <li class="dash"><p>Lookups and searching for records based on other fields than
uid, pid or &quot;enableFields&quot; will never reflect workspace content since
overlays happen to online records <em>after</em> they are selected.</p>

<ul>
    <li class="dash"><p>This problem can largely be avoided for  <em>versions of new records</em>
because versions of a &quot;New&quot;-placeholder can mirror certain fields down
onto the placeholder record. For the tt_content table this is
configured as:</p><p>shadowColumnsForNewPlaceholders'= 'sys_language_uid,l18n_parent,colPos,header'</p><p>so that these fields used for column position, language and header title are also updated
in the placeholder thus creating a correct preview in the frontend.</p></li>
    <li class="dash">For <em>versions of existing records</em> the problem is in reality reduced
a lot because normally you don&#039;t change the column or language fields
after the record is first created anyway! But in theory the preview
can fail.</li>
    <li class="dash"><p>When changing the type of a page (e.g. from &quot;Standard&quot; to &quot;External
URL&quot;) the preview might fail in cases where a look up is done on the
doktype field of the live record.</p>

<ul>
    <li class="dash">Page shortcuts might not work properly in preview.</li>
    <li class="dash">Mount Points might not work properly in preview.</li>
</ul></li>
</ul></li>
    <li class="dash">It is impossible to preview the value of count(*) selections since
we would have to traverse all records and pass them through
-versionOL() before we would have a reliable result!</li>
    <li class="dash">In \TYPO3\CMS\Core\Domain\Repository\PageRepository::getPageShortcut(),
PageRepository-getMenu() is called with an
additional WHERE clause which will ignore changes made in workspaces.
This could also be the case in other places where PageRepository-getMenu()
is used (but a search shows it is not a big problem).
In this case we will for now accept that a wrong shortcut destination
can be experienced during previews.</li>
</ul>
            <a id="workspaces-backend"></a>
    </div>
<div class="section" id="backend-challenges">
    <h1>Backend challenges</h1>
            <p>The main challenge in the backend is to reflect how the system will
look when the workspace gets published. To create a transparent
experience for backend users we have to overlay almost every selected
record with any possible new version it might have. Also when we are
tracking records back to the page tree root point we will have to
correct pid-values. All issues related to selecting on fields other
than pid and uid also relates to the backend as they did for the
frontend.</p>
            <a id="workspaces-backend-api"></a>
            <div class="section" id="workspace-related-api-for-backend-modules">
    <h2>Workspace-related API for backend modules</h2>
            <dl>
                        <dt>BackendUtility::workspaceOL()</dt>
        
        <dd><p>Overlaying record with workspace version if any. Works like
-sys_page-versionOL() does, but for the backend. Input record must
have fields only from the table (no pseudo fields) and the record is
passed by reference.</p><p><strong>Example:</strong></p><pre><code class="language-php">// use \TYPO3\CMS\Backend\Utility\BackendUtility
$result = $queryBuilder
   -&gt;select(&#039;*&#039;)
   -&gt;from(&#039;pages&#039;)
   -&gt;where(
      $queryBuilder-&gt;expr()-&gt;eq(&#039;uid&#039;,
         $queryBuilder-&gt;createNamedParameter($id, \PDO::PARAM_INT)
      )
   )
   -&gt;executeQuery();
$row = $result-&gt;fetchAssociative();
BackendUtility::workspaceOL(&#039;pages&#039;, $row);</code></pre></dd>                        <dt>BackendUtility::getRecordWSOL()</dt>
        
        <dd><p>Gets record from table and overlays the record with workspace version
if any.</p><p><strong>Example:</strong></p><pre><code class="language-php">// use \TYPO3\CMS\Backend\Utility\BackendUtility
$row = BackendUtility::getRecordWSOL($table, $uid);
// This is the same as:
$row = BackendUtility::getRecord($table, $uid);
BackendUtility::workspaceOL($table, $row);</code></pre></dd>                        <dt>BackendUtility::isPidInVersionizedBranch()</dt>
        
        <dd>Will fetch the rootline for the pid, then check if anywhere in the
rootline there is a branch point. Returns either &quot;branchpoint&quot; (if
branch) or &quot;first&quot; (if page) or false if nothing. Alternatively, it
returns the value of t3ver_stage for the branchpoint (if any).</dd><dd></dd>                        <dt>BackendUtility::getWorkspaceVersionOfRecord()</dt>
        
        <dd>Returns offline workspace version of a record, if found.</dd><dd></dd>                        <dt>BackendUtility::getLiveVersionOfRecord()</dt>
        
        <dd>Returns live version of workspace version.</dd><dd></dd>                        <dt>BackendWorkspaceRestriction</dt>
        
        <dd><dl>
                        <dt>Use \TYPO3\CMS\Core\Database\Query\Restriction\WorkspaceRestriction</dt>
        
        <dd>instead.</dd>    </dl><p>Adds a WHERE-clause to the QueryBuilder which will deselect placeholder
records from other workspaces. This should be implemented almost everywhere
records are selected in the backend based on other fields than uid and where
a DeletedRestriction is used.</p><p><strong>Example:</strong></p><pre><code class="language-php">// use TYPO3\CMS\Core\Database\Query\Restriction\BackendWorkspaceRestriction;
// use TYPO3\CMS\Core\Database\Query\Restriction\DeletedRestriction;

$queryBuilder = GeneralUtility::makeInstance(ConnectionPool::class)
    -&gt;getQueryBuilderForTable(&#039;pages&#039;);
$queryBuilder-&gt;getRestrictions()
    -&gt;removeAll()
    -&gt;add(GeneralUtility::makeInstance(DeletedRestriction::class))
    -&gt;add(GeneralUtility::makeInstance(BackendWorkspaceRestriction::class));</code></pre></dd>                        <dt>FrontendWorkspaceRestriction</dt>
        
        <dd><dl>
                        <dt>Use \TYPO3\CMS\Core\Database\Query\Restriction\WorkspaceRestriction</dt>
        
        <dd>instead.</dd>    </dl><p>Restriction for filtering records for frontend workspaces preview:</p><pre><code class="language-php">// use TYPO3\CMS\Core\Database\Query\Restriction\FrontendWorkspaceRestriction;</code></pre></dd><dd></dd>                        <dt>WorkspaceRestriction</dt>
        
        <dd><p>This WorkspaceRestriction has been added to overcome certain downsides of the BackendWorkspaceRestriction
and FrontendWorkspaceRestriction. It limits a SQL query to only select records which are &quot;online&quot; (pid != -1)
and in live or current workspace:</p><pre><code class="language-php">// use TYPO3\CMS\Core\Database\Query\Restriction\WorkspaceRestriction</code></pre></dd><dd></dd>                        <dt>$BE_USER-workspaceCannotEditRecord()</dt>
        
        <dd>Checking if editing of an existing record is allowed in current
workspace if that is offline.</dd>                        <dt>$BE_USER-workspaceCreateNewRecord()</dt>
        
        <dd>Checks if new records can be created in a certain page (according to
workspace restrictions).</dd>                        <dt>$BE_USER-checkWorkspace()</dt>
        
        <dd>Checks how the users access is for a specific workspace.</dd>                        <dt>$BE_USER-checkWorkspaceCurrent()</dt>
        
        <dd>Like -&gt;checkWorkspace() but returns status for the current workspace.</dd>                        <dt>$BE_USER-setWorkspace()</dt>
        
        <dd>Setting another workspace for backend user.</dd>                        <dt>$BE_USER-setWorkspacePreview()</dt>
        
        <dd>Setting frontend preview state.</dd><dd></dd>    </dl>
            <a id="workspaces-backend-acess"></a>
    </div>
    </div>
<div class="section" id="backend-module-access">
    <h1>Backend module access</h1>
            <p>You can restrict access to backend modules by using
$MCONF['workspaces'] in the conf.php files. The variable is a list of
keywords defining where the module is available:</p>
            <pre><code class="language-php">$MCONF[&#039;workspaces&#039;] = online,offline,custom</code></pre>
            <p>You can also restrict function menu items to certain workspaces if you
like. This is done by an argument sent to the function
\TYPO3\CMS\Core\Utility\ExtensionManagementUtility::insertModuleFunction(). See that file for more details.</p>
            <a id="workspaces-detection"></a>
    </div>
<div class="section" id="detecting-current-workspace">
    <h1>Detecting current workspace</h1>
            <p>You can always check what the current workspace of the backend user is
by reading WorkspaceAspect-getWorkspaceId(). If the workspace is a
custom workspace you will find its record loaded in
$GLOBALS['BE_USER']-workspaceRec.</p>
            <p>The values for workspaces is either 0 (online/live) or the uid of the
corresponding entry in the sys_workspace table.</p>
            <a id="workspaces-tcemain"></a>
    </div>
<div class="section" id="using-datahandler-with-workspaces">
    <h1>Using DataHandler with workspaces</h1>
            <p>Since admin users are also restricted by the workspace it is not
possible to save any live records when in a workspace. However for
very special occasions you might need to bypass this and to do so, you
can set the instance variable
\TYPO3\CMS\Core\DataHandling\DataHandler::bypassWorkspaceRestrictions to TRUE. An example of
this is when users are updating their user profile using the &quot;User Tool &gt;
User Settings&quot; module; that actually allows them to save to a live record
(their user record) while in a draft workspace.</p>
            <a id="workspaces-moving"></a>
    </div>
<div class="section" id="moving-in-workspaces">
    <h1>Moving in workspaces</h1>
            <p>TYPO3 v4.2 and beyond supports moving for &quot;Element&quot; type versions in
workspaces. A new version of the
source record is made and has t3ver_state = 4 (move-to pointer).
This version is necessary in order for the versioning system to
have something to publish for the move operation.</p>
            <p>When the version of the source is published a look up will be made to
see if a placeholder exists for a move operation and if so the record
will take over the pid / &quot;sortby&quot; value upon publishing.</p>
            <p>Preview of move operations is almost fully functional through the
\TYPO3\CMS\Core\Domain\Repository\PageRepository::versionOL() and
\TYPO3\CMS\Backend\Utility\BackendUtility::workspaceOL() functions.
When the online placeholder is selected it looks up the source
record, overlays any version on top and displays it. When the source
record is selected it should be discarded in case shown in
context where ordering or position matters (like in menus or column
based page content). This is done in the appropriate places.</p>
    </div>
<div class="section" id="persistence-in-depth-scenarios">
    <h1>Persistence in-depth scenarios</h1>
            <p>The following section represents how database records are actually persisted in a database
table for different scenarios and previously performed actions.</p>
            <div class="section" id="placeholders">
    <h2>Placeholders</h2>
            <p>Workspace placeholders are stored in field t3ver_state which can have the following values:</p>
            <dl>
                        <dt>-1</dt>
        
        <dd>

<ul>
    <li><strong>new placeholder version</strong></li>
    <li>the workspace pendant for a new placeholder (see value 1)</li>
</ul></dd>                        <dt>0</dt>
        
        <dd>

<ul>
    <li><strong>default state</strong></li>
    <li>representing a workspace modification of an existing record (when t3ver_wsid  0)</li>
</ul></dd>                        <dt>1</dt>
        
        <dd>

<ul>
    <li><strong>new placeholder</strong></li>
    <li>live pendant for a record that is new, used as insertion point concerning sorting</li>
</ul></dd>                        <dt>2</dt>
        
        <dd>

<ul>
    <li><strong>delete placeholder</strong></li>
    <li>representing a record that is deleted in workspace</li>
</ul></dd>                        <dt>4</dt>
        
        <dd>

<ul>
    <li><strong>move pointer</strong></li>
    <li>workspace pendant of a record that shall be moved</li>
</ul></dd>    </dl>
    </div>
            <div class="section" id="overview">
    <h2>Overview</h2>
            <dl>
                        <dt>:header-rows: 1</dt>
        
        <dd><p>:widths: 3, 3, 6, 6, 9, 8, 9, 11, 9, 13, 21</p><p>uid,pid,deleted,sorting,t3ver_wsid,t3ver_oid,t3ver_state,l10n_parent,sys_language_uid,title
10,0,0,128,0,0,0,0,0,example.org website
20,10,0,128,0,0,0,0,0,Current issues
21,10,0,256,0,0,0,20,1,Actualité
22,10,0,384,0,0,0,20,2,Neuigkeiten
30,10,0,512,0,0,0,0,0,Other topics
...,...,...,...,...,...,...,...,...,...,...
41,30,0,128,1,0,1,0,0,Topic #1 new
42,-1,0,128,1,41,-1,0,0,Topic #2 new</p></dd>                        <dt>.. csv-tableOverview of regular records (e.g. tx_record, tt_content, ... but not pages)</dt>
        
        <dd><p>:header-rows: 1
:widths: 3, 3, 6, 6, 9, 8, 9, 11, 9, 13, 21</p><p>uid,pid,deleted,sorting,t3ver_wsid,t3ver_oid,t3ver_state,l10n_parent,sys_language_uid,title
11,20,0,128,0,0,0,0,0,Article #1
12,20,0,256,0,0,0,0,0,Article #2
13,20,0,384,0,0,0,0,0,Article #3
...,...,...,...,...,...,...,...,...,...,...
21,-1,0,128,1,11,0,0,0,Article #1 modified
22,-1,0,256,1,12,2,0,0,Article #2 deleted
23,-1,0,384,1,13,4,0,0,Article #3 moved
25,20,0,512,1,0,1,0,0,Article #4 new
26,-1,0,512,1,25,-1,0,0,Article #4 new
27,20,1,640,0,0,1,0,0,Article #5 discarded
28,-1,1,640,0,27,-1,0,0,Article #5 discarded
29,41,0,128,1,0,1,0,0,Topic #1 Article new
30,-1,0,128,1,29,-1,0,0,Topic #1 Article new
...,...,...,...,...,...,...,...,...,...,...
31,20,0,192,1,0,1,11,1,Entrefilet #1 (fr)
32,-1,0,192,1,31,-1,11,1,Entrefilet #1 (fr)
33,20,0,224,1,0,1,11,2,Beitrag #1 (de)
34,-1,0,224,1,33,-1,11,2,Beitrag #1 (de)</p></dd>    </dl>
    </div>
            <div class="section" id="scenario-create-new-page">
    <h2>Scenario: Create new page</h2>
            <dl>
                        <dt>:header-rows: 1</dt>
        
        <dd><p>:widths: 3, 3, 6, 6, 9, 8, 9, 11, 9, 13, 21</p><p>uid,pid,deleted,sorting,t3ver_wsid,t3ver_oid,t3ver_state,l10n_parent,sys_language_uid,title
10,0,0,128,0,0,0,0,0,example.org website
...,...,...,...,...,...,...,...,...,...,...
30,10,0,512,0,0,0,0,0,Other topics
...,...,...,...,...,...,...,...,...,...,...
41,<strong>30</strong>,0,128,1,0,<strong>1</strong>,0,0,Topic #1 new
42,-1,0,128,1,<strong>41</strong>,<strong>-1</strong>,0,0,Topic #2 new</p></dd>    </dl>
            

<ul>
    <li>record uid = 41 defines sorting insertion point page pid = 30 in live workspace, t3ver_state = 1</li>
    <li>record uid = 42 contains actual version information, pointing back to new placeholder, t3ver_oid = 41,
indicating new version state t3ver_state = -1</li>
</ul>
    </div>
            <div class="section" id="scenario-modify-record">
    <h2>Scenario: Modify record</h2>
            <dl>
                        <dt>:header-rows: 1</dt>
        
        <dd><p>:widths: 3, 3, 6, 6, 9, 8, 9, 11, 9, 13, 21</p><p>uid,pid,deleted,sorting,t3ver_wsid,t3ver_oid,t3ver_state,l10n_parent,sys_language_uid,title
11,20,0,128,0,0,0,0,0,Article #1
...,...,...,...,...,...,...,...,...,...,...
21,-1,0,128,1,<strong>11</strong>,0,0,0,Article #1 modified</p></dd>                        <dt>* record uid = 21 contains actual version information, pointing back to live pendant, t3ver_oid = 11,</dt>
        
        <dd>using default version state t3ver_state = 0</dd>    </dl>
    </div>
            <div class="section" id="scenario-delete-record">
    <h2>Scenario: Delete record</h2>
            <dl>
                        <dt>:header-rows: 1</dt>
        
        <dd><p>:widths: 3, 3, 6, 6, 9, 8, 9, 11, 9, 13, 21</p><p>uid,pid,deleted,sorting,t3ver_wsid,t3ver_oid,t3ver_state,l10n_parent,sys_language_uid,title
12,20,0,256,0,0,0,0,0,Article #2
...,...,...,...,...,...,...,...,...,...,...
22,-1,0,256,1,<strong>12</strong>,<strong>2</strong>,0,0,Article #2 deleted</p></dd>    </dl>
            

<ul>
    <li>record uid = 22 represents delete placeholder t3ver_state = 2, pointing back to live pendant, t3ver_oid = 12</li>
</ul>
            <a id="scenario-create-new-record-on-existing-page"></a>
    </div>
            <div class="section" id="scenario-create-new-record-on-existing-page">
    <h2>Scenario: Create new record on existing page</h2>
            <dl>
                        <dt>:header-rows: 1</dt>
        
        <dd><p>:widths: 3, 3, 6, 6, 9, 8, 9, 11, 9, 13, 21</p><p>uid,pid,deleted,sorting,t3ver_wsid,t3ver_oid,t3ver_state,l10n_parent,sys_language_uid,title
...,...,...,...,...,...,...,...,...,...,...
25,<strong>20</strong>,0,512,1,0,<strong>1</strong>,0,0,Article #4 new
26,-1,0,512,1,<strong>25</strong>,<strong>-1</strong>,0,0,Article #4 new</p></dd>    </dl>
            

<ul>
    <li>record uid = 25 defines sorting insertion point on page pid = 20 in live workspace, t3ver_state = 1</li>
    <li>record uid = 26 contains actual version information, pointing back to new placeholder, t3ver_oid = 25,
indicating new version state t3ver_state = -1</li>
</ul>
    </div>
            <div class="section" id="scenario-create-new-record-on-page-that-is-new-in-workspace">
    <h2>Scenario: Create new record on page that is new in workspace</h2>
            <dl>
                        <dt>:header-rows: 1</dt>
        
        <dd><p>:widths: 3, 3, 6, 6, 9, 8, 9, 11, 9, 13, 21</p><p>uid,pid,deleted,sorting,t3ver_wsid,t3ver_oid,t3ver_state,l10n_parent,sys_language_uid,title
...,...,...,...,...,...,...,...,...,...,...
29,<strong>41</strong>,0,128,1,0,<strong>1</strong>,0,0,Topic #1 Article new
30,-1,0,128,1,<strong>29</strong>,<strong>-1</strong>,0,0,Topic #1 Article new</p></dd>    </dl>
            

<ul>
    <li>record uid = 29 defines sorting insertion point on page pid = 41 in live workspace, t3ver_state = 1</li>
    <li>record uid = 30 contains actual version information, pointing back to new placeholder, t3ver_oid = 29,
indicating new version state t3ver_state = -1</li>
    <li>side-notepid = 41 points to new placeholder of a page that has been created in workspace</li>
</ul>
            <a id="scenario-discard-record-workspace-modifications"></a>
    </div>
            <div class="section" id="scenario-discard-record-workspace-modifications">
    <h2>Scenario: Discard record workspace modifications</h2>
            <dl>
                        <dt>:header-rows: 1</dt>
        
        <dd><p>:widths: 3, 3, 6, 6, 9, 8, 9, 11, 9, 13, 21</p><p>uid,pid,deleted,sorting,t3ver_wsid,t3ver_oid,t3ver_state,l10n_parent,sys_language_uid,title
...,...,...,...,...,...,...,...,...,...,...
27,20,<strong>1</strong>,640,<strong>0</strong>,0,1,0,0,Article #5 discarded
28,-1,<strong>1</strong>,640,<strong>0</strong>,27,-1,0,0,Article #5 discarded</p></dd>                        <dt>* previously records uid = 27 and uid = 28 have been created in workspace</dt>
        
        <dd>(similar to scenario-create-new-record-on-existing-page)</dd>    </dl>
            

<ul>
    <li>both records represent the discarded state by having assigned deleted = 1 and t3ver_wsid = 0</li>
</ul>
    </div>
            <div class="section" id="scenario-create-new-record-localization">
    <h2>Scenario: Create new record localization</h2>
            <dl>
                        <dt>:header-rows: 1</dt>
        
        <dd><p>:widths: 3, 3, 6, 6, 9, 8, 9, 11, 9, 13, 21</p><p>uid,pid,deleted,sorting,t3ver_wsid,t3ver_oid,t3ver_state,l10n_parent,sys_language_uid,title
11,20,0,128,0,0,0,0,0,Article #1
...,...,...,...,...,...,...,...,...,...,...
31,20,0,192,1,1,0,<strong>11</strong>,<strong>1</strong>,Entrefilet #1 (fr)
32,-1,0,192,1,31,-1,<strong>11</strong>,<strong>1</strong>,Entrefilet #1 (fr)
33,20,0,224,1,0,1,<strong>11</strong>,<strong>2</strong>,Beitrag #1 (de)
34,-1,0,224,1,33,-1,<strong>11</strong>,<strong>2</strong>,Beitrag #1 (de)</p></dd>    </dl>
            

<ul>
    <li><em>principles of creating new records with according placeholders applies in this scenario</em></li>
    <li>records uid = 31 and uid = 32 represent localization to French sys_language_uid = 1,
pointing back to their localization origin l10n_parent = 11</li>
    <li>records uid = 33 and uid = 34 represent localization to German sys_language_uid = 2,
pointing back to their localization origin l10n_parent = 11</li>
</ul>
    </div>
            <div class="section" id="scenario-create-new-record-then-move-to-different-page">
    <h2>Scenario: Create new record, then move to different page</h2>
            <dl>
                        <dt>:header-rows: 1</dt>
        
        <dd><p>:widths: 3, 3, 6, 6, 9, 8, 9, 11, 9, 13, 21</p><p>uid,pid,deleted,sorting,t3ver_wsid,t3ver_oid,t3ver_state,l10n_parent,sys_language_uid,title
...,...,...,...,...,...,...,...,...,...,...
25,<strong>30</strong>,0,512,1,0,1,0,0,Article #4 new &amp; moved
26,-1,0,512,1,25,-1,0,0,Article #4 new &amp; moved</p></dd>                        <dt>* previously records uid = 25 and uid = 26 have been created in workspace</dt>
        
        <dd>(exactly like in scenario-create-new-record-on-existing-page), then record uid = 25
has been moved to target target page pid = 30</dd>    </dl>
            

<ul>
    <li>record uid = 25 directly uses target page pid = 30</li>
</ul>
    </div>
            <div class="section" id="scenario-create-new-record-then-delete">
    <h2>Scenario: Create new record, then delete</h2>
            <dl>
                        <dt>:header-rows: 1</dt>
        
        <dd><p>:widths: 3, 3, 6, 6, 9, 8, 9, 11, 9, 13, 21</p><p>uid,pid,deleted,sorting,t3ver_wsid,t3ver_oid,t3ver_state,l10n_parent,sys_language_uid,title
...,...,...,...,...,...,...,...,...,...,...
25,20,<strong>1</strong>,512,<strong>0</strong>,0,1,0,0,Article #4 new &amp; deleted
26,-1,<strong>1</strong>,512,<strong>0</strong>,25,-1,0,0,Article #4 new &amp; deleted</p></dd>                        <dt>* previously records uid = 25 and uid = 26 have been created in workspace</dt>
        
        <dd>(exactly like in scenario-create-new-record-on-existing-page), then record uid = 25
has been deleted</dd>                        <dt>* records uid = 25 and uid = 26 are directly discarded in workspace</dt>
        
        <dd>(similar to scenario-discard-record-workspace-modifications)</dd>    </dl>
    </div>
    </div>

    </section>
                            </div>
            <section data-search-results class="phpdocumentor-search-results phpdocumentor-search-results--hidden">
    <section class="phpdocumentor-search-results__dialog">
        <header class="phpdocumentor-search-results__header">
            <h2 class="phpdocumentor-search-results__title">Search results</h2>
            <button class="phpdocumentor-search-results__close"><i class="fas fa-times"></i></button>
        </header>
        <section class="phpdocumentor-search-results__body">
            <ul class="phpdocumentor-search-results__entries"></ul>
        </section>
    </section>
</section>
        </div>
        <a href="guide/ApiOverview/Workspaces/Index.html#top" class="phpdocumentor-back-to-top"><i class="fas fa-chevron-circle-up"></i></a>

    </main>

    <script>
        cssVars({});
    </script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/prism.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/plugins/line-numbers/prism-line-numbers.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/plugins/line-highlight/prism-line-highlight.min.js"></script>
</body>
</html>