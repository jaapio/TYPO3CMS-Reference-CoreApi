<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
                    <title>phpDocumentor</title>
    

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <base href="../../../../">
    <link rel="icon" href="images/favicon.ico"/>
    <link rel="stylesheet" href="css/normalize.css">
    <link rel="stylesheet" href="css/base.css">
            <link rel="preconnect" href="https://fonts.gstatic.com">
        <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@100;200;300;400;600;700&display=swap" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:wght@400;600;700&display=swap" rel="stylesheet">
        <link rel="stylesheet" href="css/template.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0/css/all.min.css" integrity="sha256-ybRkN9dBjhcS2qrW1z+hfCxq+1aBdwyQM5wlQoQVt/0=" crossorigin="anonymous" />
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/themes/prism-okaidia.css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/plugins/line-numbers/prism-line-numbers.css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/plugins/line-highlight/prism-line-highlight.css">
                <script src="https://cdn.jsdelivr.net/npm/fuse.js@3.4.6"></script>
        <script src="https://cdn.jsdelivr.net/npm/css-vars-ponyfill@2"></script>
        <script src="js/template.js"></script>
        <script src="js/search.js"></script>
        <script defer src="js/searchIndex.js"></script>
    </head>
<body id="top">
    <header class="phpdocumentor-header phpdocumentor-section">
    <h1 class="phpdocumentor-title"><a href="" class="phpdocumentor-title__link">phpDocumentor</a></h1>
    <input class="phpdocumentor-header__menu-button" type="checkbox" id="menu-button" name="menu-button" />
    <label class="phpdocumentor-header__menu-icon" for="menu-button">
        <i class="fas fa-bars"></i>
    </label>
    <section data-search-form class="phpdocumentor-search">
    <label>
        <span class="visually-hidden">Search for</span>
        <svg class="phpdocumentor-search__icon" width="21" height="20" viewBox="0 0 21 20" fill="none" xmlns="http://www.w3.org/2000/svg">
            <circle cx="7.5" cy="7.5" r="6.5" stroke="currentColor" stroke-width="2"/>
            <line x1="12.4892" y1="12.2727" x2="19.1559" y2="18.9393" stroke="currentColor" stroke-width="3"/>
        </svg>
        <input type="search" class="phpdocumentor-field phpdocumentor-search__field" placeholder="Loading .." disabled />
    </label>
</section>

    <nav class="phpdocumentor-topnav">
    <ul class="phpdocumentor-topnav__menu">
        </ul>
</nav>
</header>

    <main class="phpdocumentor">
        <div class="phpdocumentor-section">
            <input class="phpdocumentor-sidebar__menu-button" type="checkbox" id="sidebar-button" name="sidebar-button" />
<label class="phpdocumentor-sidebar__menu-icon" for="sidebar-button">
    Menu
</label>
<aside class="phpdocumentor-column -three phpdocumentor-sidebar">
                    <section class="phpdocumentor-sidebar__category">
            <h2 class="phpdocumentor-sidebar__category-header">typo3-explained</h2>
                                    <h4 class="phpdocumentor-sidebar__root-namespace">
    <a href="guide/Introduction/Index.html#introduction" class="">Introduction</a>
</h4>
    <ul class="phpdocumentor-list">
                    <li>
                <a href="guide/Introduction/Index.html#system-overview-1" class="">System Overview</a>
                
            </li>
                    <li>
                <a href="guide/Introduction/Index.html#a-basic-installation" class="">A basic installation</a>
                
            </li>
            </ul>

                                    <h4 class="phpdocumentor-sidebar__root-namespace">
    <a href="guide/ApiOverview/Index.html#api-a-z" class="">API A-Z</a>
</h4>

                                    <h4 class="phpdocumentor-sidebar__root-namespace">
    <a href="guide/CodingGuidelines/Index.html#cgl" class="">Coding Guidelines</a>
</h4>
    <ul class="phpdocumentor-list">
                    <li>
                <a href="guide/CodingGuidelines/Introduction.html#cgl-introduction" class="">Introduction</a>
                
            </li>
                    <li>
                <a href="guide/CodingGuidelines/CglPhp/Index.html#cgl-php" class="">PHP Coding Guidelines</a>
                
            </li>
                    <li>
                <a href="guide/CodingGuidelines/CglJavaScript/Index.html#cgl-javascript" class="">JavaScript Coding Guidelines</a>
                
            </li>
                    <li>
                <a href="guide/CodingGuidelines/CglTypeScript/Index.html#cgl-typescript" class="">TypeScript Coding Guidelines</a>
                
            </li>
                    <li>
                <a href="guide/CodingGuidelines/CglTypoScript/Index.html#cgl-typoscript" class="">TypoScript Coding Guidelines</a>
                
            </li>
                    <li>
                <a href="guide/CodingGuidelines/CglTsConfig.html#cgl-tsconfig" class="">TSconfig Coding Guidelines</a>
                
            </li>
                    <li>
                <a href="guide/CodingGuidelines/CglXliff/Index.html#cgl-xliff" class="">Xliff Coding Guidelines</a>
                
            </li>
                    <li>
                <a href="guide/CodingGuidelines/CglYaml.html#cgl-yaml" class="">Yaml Coding Guidelines</a>
                
            </li>
                    <li>
                <a href="guide/CodingGuidelines/CglRest/Index.html#cgl-rest" class="">reStructuredText (reST)</a>
                
            </li>
            </ul>

                                    <h4 class="phpdocumentor-sidebar__root-namespace">
    <a href="guide/Configuration/Index.html#configuration" class="">Configuration</a>
</h4>
    <ul class="phpdocumentor-list">
                    <li>
                <a href="guide/Configuration/ConfigurationOverview.html#config-overview" class="">Configuration overview</a>
                
            </li>
                    <li>
                <a href="guide/Configuration/Glossary.html#configuration-classification" class="">Glossary</a>
                
            </li>
                    <li>
                <a href="guide/Configuration/ConfigurationFiles.html#configuration-files" class="">Configuration files</a>
                
            </li>
                    <li>
                <a href="guide/Configuration/ConfigurationModule/Index.html#configuration-module" class="">Configuration module</a>
                
            </li>
                    <li>
                <a href="guide/Configuration/FeatureToggles.html#feature-toggles" class="">Feature toggles</a>
                
            </li>
                    <li>
                <a href="guide/Configuration/GlobalVariables.html#globals-variables" class="">$GLOBALS</a>
                
            </li>
                    <li>
                <a href="guide/Configuration/Typo3ConfVars/Index.html#typo3-conf-vars" class="">TYPO3_CONF_VARS</a>
                
            </li>
                    <li>
                <a href="guide/Configuration/Typo3Information.html#typo3Information" class="">Global meta information about TYPO3</a>
                
            </li>
                    <li>
                <a href="guide/Configuration/Tsconfig.html#tsconfig" class="">TSconfig</a>
                
            </li>
                    <li>
                <a href="guide/Configuration/TypoScriptSyntax/Index.html#typoscript-syntax-about" class="">TypoScript syntax</a>
                
            </li>
                    <li>
                <a href="guide/Configuration/UserSettingsConfiguration/Index.html#user-settings" class="">User settings configuration</a>
                
            </li>
                    <li>
                <a href="guide/Configuration/Yaml/Index.html#yaml" class="">YAML</a>
                
            </li>
            </ul>

                                    <h4 class="phpdocumentor-sidebar__root-namespace">
    <a href="guide/ExtensionArchitecture/Index.html#extension-development" class="">Extension development</a>
</h4>
    <ul class="phpdocumentor-list">
                    <li>
                <a href="guide/ExtensionArchitecture/Concepts/Index.html#extension-concepts" class="">Concepts</a>
                
            </li>
                    <li>
                <a href="guide/ExtensionArchitecture/FileStructure/Index.html#extension-reserved-folders-legacy" class="">File structure</a>
                
            </li>
                    <li>
                <a href="guide/ExtensionArchitecture/HowTo/Index.html#extension-howto" class="">Howto</a>
                
            </li>
                    <li>
                <a href="guide/ExtensionArchitecture/Extbase/Index.html#extbase" class="">Extbase</a>
                
            </li>
                    <li>
                <a href="guide/ExtensionArchitecture/BestPractises/Index.html#extension-Best-practises" class="">Best practises and conventions</a>
                
            </li>
                    <li>
                <a href="guide/ExtensionArchitecture/Tutorials/Index.html#extension-tutorials" class="">Tutorials</a>
                
            </li>
            </ul>

                                    <h4 class="phpdocumentor-sidebar__root-namespace">
    <a href="guide/Security/Index.html#security" class="">Security guidelines</a>
</h4>
    <ul class="phpdocumentor-list">
                    <li>
                <a href="guide/Security/Introduction/Index.html#security-introduction" class="">Introduction</a>
                
            </li>
                    <li>
                <a href="guide/Security/SecurityTeam/Index.html#security-team" class="">The TYPO3 Security Team</a>
                
            </li>
                    <li>
                <a href="guide/Security/GeneralInformation/Index.html#security-general-information" class="">General Information</a>
                
            </li>
                    <li>
                <a href="guide/Security/TypesOfThreats/Index.html#security-threats" class="">Types of Security Threats</a>
                
            </li>
                    <li>
                <a href="guide/Security/GeneralGuidelines/Index.html#security-general-guidelines" class="">General guidelines</a>
                
            </li>
                    <li>
                <a href="guide/Security/GuidelinesAdministrators/Index.html#security-administrators" class="">Guidelines for System Administrators</a>
                
            </li>
                    <li>
                <a href="guide/Security/GuidelinesExtensionDevelopment/Index.html#security-extension-development" class="">Guidelines for extension development</a>
                
            </li>
                    <li>
                <a href="guide/Security/GuidelinesIntegrators/Index.html#security-integrators" class="">Guidelines for TYPO3 integrators</a>
                
            </li>
                    <li>
                <a href="guide/Security/GuidelinesEditors/Index.html#security-editors" class="">Guidelines for editors</a>
                
            </li>
                    <li>
                <a href="guide/Security/Backups/Index.html#security-backups" class="">Backup strategy</a>
                
            </li>
                    <li>
                <a href="guide/Security/HackedSite/Index.html#security-detect-analyze-repair" class="">Detect, analyze and repair a hacked site</a>
                
            </li>
            </ul>

                                    <h4 class="phpdocumentor-sidebar__root-namespace">
    <a href="guide/Testing/Index.html#testing" class="">Testing</a>
</h4>
    <ul class="phpdocumentor-list">
                    <li>
                <a href="guide/Testing/History.html#testing-history" class="">History</a>
                
            </li>
                    <li>
                <a href="guide/Testing/CoreTesting.html#testing-core" class="">Core testing</a>
                
            </li>
                    <li>
                <a href="guide/Testing/ExtensionTesting.html#testing-extensions" class="">Extension testing</a>
                
            </li>
                    <li>
                <a href="guide/Testing/ProjectTesting.html#testing-projects" class="">Project testing</a>
                
            </li>
                    <li>
                <a href="guide/Testing/WritingUnit.html#testing-writing-unit" class="">Writing unit tests</a>
                
            </li>
                    <li>
                <a href="guide/Testing/WritingFunctional.html#testing-writing-functional" class="">Writing functional tests</a>
                
            </li>
                    <li>
                <a href="guide/Testing/WritingAcceptance.html#testing-writing-acceptance" class="">Writing acceptance tests</a>
                
            </li>
                    <li>
                <a href="guide/Testing/Faq.html#testing-faq" class="">FAQ</a>
                
            </li>
            </ul>

                                    <h4 class="phpdocumentor-sidebar__root-namespace">
    <a href="guide/About.html#about" class="">About This Manual</a>
</h4>
    <ul class="phpdocumentor-list">
                    <li>
                <a href="guide/About.html#intended-audience" class="">Intended Audience</a>
                
            </li>
                    <li>
                <a href="guide/About.html#code-examples-1" class="">Code examples</a>
                
            </li>
                    <li>
                <a href="guide/About.html#feedback-and-contribute" class="">Feedback and Contribute</a>
                
            </li>
                    <li>
                <a href="guide/About.html#credits-1" class="">Credits</a>
                
            </li>
                    <li>
                <a href="guide/About.html#dedication-1" class="">Dedication</a>
                
            </li>
            </ul>

                                    <h4 class="phpdocumentor-sidebar__root-namespace">
    <a href="guide/Sitemap.html#sitemap" class="">Sitemap</a>
</h4>

                                    <h4 class="phpdocumentor-sidebar__root-namespace">
    <a href="guide/genindex.html#index" class="">Index</a>
</h4>

                        </section>
            
    <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Reports</h2>
                <h3 class="phpdocumentor-sidebar__root-package"><a href="reports/deprecated.html">Deprecated</a></h3>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="reports/errors.html">Errors</a></h3>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="reports/markers.html">Markers</a></h3>
    </section>

    <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Indices</h2>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="indices/files.html">Files</a></h3>
    </section>
</aside>

            <div class="phpdocumentor-column -nine phpdocumentor-content">
                                        <section>
        
<div class="section" id="FormEngine-Rendering">
    <h1>Rendering</h1>
            <p>This is the second step of the processing chainFormDataCompiler and creates a result array containing HTML, CSS and JavaScript. This
is then post-processed by a controller to feed it to the PageRenderer or to create an Ajax
response.</p>
            <p>The rendering is a treecontainer as renderType
entry point within the data array, then hands over the full data array to the NodeFactory which looks
up a class responsible for this renderType, and calls render() on it. A container class creates only
a fraction of the full result, and delegates details to another container. The second one does another detail
and calls a third one. This continues to happen until a single field should be rendered, at which point an
element class is called taking care of one element.</p>
            <figure>
    <img
    src="./Images/Plantuml/FormEngine/FormEngineRenderTree.svg"
                alt="Render tree example"        />

            
            </figure>
            <p>Each container creates some &quot;outer&quot; part of the result, calls some sub-container or element, merges the
sub-result with its own content and returns the merged array up again. The data array is given to each sub class
along the way, and containers can add further render relevant data to it before giving it &quot;down&quot;. The data array
can <em>not</em> be given &quot;up&quot; in a changed way again. Inheritance of a data array is always top-bottom. Only HTML, CSS
or JavaScript created by a sub-class is returned by the sub-class &quot;up&quot; again in a &quot;result&quot; array of a specified
format.</p>
            <pre><code class="language-php">class SomeContainer extends AbstractContainer
{
    public function render()
    {
        $result = $this-&gt;initializeResultArray();
        $data = $this-&gt;data;
        $data[&#039;renderType&#039;] = &#039;subContainer&#039;;
        $childArray = $this-&gt;nodeFactory-&gt;create($data)-&gt;render();
        $resultArray = $this-&gt;mergeChildReturnIntoExistingResult($result, $childArray, false);
        $result[&#039;html&#039;] = &#039;&lt;h1&gt;A headline&lt;/h1&gt;&#039; . $childArray[&#039;html&#039;];
        return $result;
    }
}</code></pre>
            <p>Above example lets NodeFactory find and compile some data from &quot;subContainer&quot;, and merges the child result
with its own. The helper methods initializeResultArray() and mergeChildReturnIntoExistingResult()
help with combining CSS and JavaScript.</p>
            <p>An upper container does not directly create an instance of a sub node (element or container) and never calls it
directly. Instead, a node that wants to call a sub node only refers to it by a name, sets this name into the data
array as $data['renderType'] and then gives the data array to the NodeFactory which determines
an appropriate class name, instantiates and initializes the class, gives it the data array, and calls render()
on it.</p>
            <a id="FormEngine-Rendering-ClassInheritance"></a>
    </div>
<div class="section" id="class-inheritance">
    <h1>Class Inheritance</h1>
            <figure>
    <img
    src="./Images/Plantuml/FormEngine/FormEngineRenderClasses.svg"
                alt="Main render class inheritance"        />

            
            </figure>
            <p>All classes must implement NodeInterface to be routed through the NodeFactory. The AbstractNode
implements some basic helpers for nodes, the two classes AbstractContainer and AbstractFormElement
implement helpers for containers and elements respectively.</p>
            <p>The call concept is simple: A first container is called, which either calls a container below or a single element. A
single element never calls a container again.</p>
            <a id="FormEngine-Rendering-NodeFactory"></a>
    </div>
<div class="section" id="nodefactory">
    <h1>NodeFactory</h1>
            <p>The NodeFactory plays an important abstraction role within the render chainrenderType. This is supported by an API that allows registering <em>new</em>
renderTypes and overriding <em>existing</em> renderTypes with own implementations. This is true for <em>all</em> classes,
including containers, elements, fieldInformation, fieldWizards and fieldControls. This means the child routing
can be fully adapted and extended if needed. It is possible to transparently &quot;kick-out&quot; a Core container and to
substitute it with an own implementation.</p>
            <p>As example, the TemplaVoila implementation needs to add additional render capabilities of the flex form rendering
to add for instance an own multi-language rendering of flex fields. It does that by overriding the default
flex container with own implementation:</p>
            <pre><code class="language-php">// Default registration of &quot;flex&quot; in NodeFactory:
// &#039;flex&#039; =&gt; \TYPO3\CMS\Backend\Form\Container\FlexFormEntryContainer::class,

// Register language aware flex form handling in FormEngine
$GLOBALS[&#039;TYPO3_CONF_VARS&#039;][&#039;SYS&#039;][&#039;formEngine&#039;][&#039;nodeRegistry&#039;][1443361297] = [
    &#039;nodeName&#039; =&gt; &#039;flex&#039;,
    &#039;priority&#039; =&gt; 40,
    &#039;class&#039; =&gt; \TYPO3\CMS\Compatibility6\Form\Container\FlexFormEntryContainer::class,
];</code></pre>
            <p>This re-routes the renderType &quot;flex&quot; to an own class. If multiple registrations for a single renderType exist,
the one with highest priority wins.</p>
            <div class="phpdocumentor-admonition -note">
            <svg class="phpdocumentor-admonition__icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"></path></svg>
                    <article>
        <p>The NodeFactory uses $data['renderType'].
A couple of TCA fields actively use this renderType. However, it is important to understand the renderType is <em>only</em>
used within the FormEngine and type is still a must-have setting for columns fields in TCA. Additionally,
type can <em>not</em> be overridden in columnsOverrides. Basically, type specifies how the DataHandler
should put data into the database, while renderType specifies how a single field is rendered. This additionally
means there can exist multiple different renderTypes for a single type, and it means it is possible to invent a new
renderType to render a single field differently, but still let the DataHandler persist it the usual way.</p>

    </article>
</div>
            <p>Adding a new renderType in ext_localconf.php</p>
            <pre><code class="language-php">// Add new field type to NodeFactory
$GLOBALS[&#039;TYPO3_CONF_VARS&#039;][&#039;SYS&#039;][&#039;formEngine&#039;][&#039;nodeRegistry&#039;][1487112284] = [
    &#039;nodeName&#039; =&gt; &#039;selectTagCloud&#039;,
    &#039;priority&#039; =&gt; &#039;70&#039;,
    &#039;class&#039; =&gt; \MyVendor\CoolTagCloud\Form\Element\SelectTagCloudElement::class,
];</code></pre>
            <p>And use it in TCA for a specific field, keeping the full database functionality in DataHandler together with the
data preparation of FormDataCompiler, but just routing the rendering of that field to the new element:</p>
            <pre><code class="language-php">$GLOBALS[&#039;TCA&#039;][&#039;myTable&#039;][&#039;columns&#039;][&#039;myField&#039;] = [
    &#039;label&#039; =&gt; &#039;Cool Tag cloud&#039;,
    &#039;config&#039; =&gt; [
        &#039;type&#039; =&gt; &#039;select&#039;,
        &#039;renderType&#039; =&gt; &#039;selectTagCloud&#039;,
        &#039;foreign_table&#039; =&gt; &#039;tx_cooltagcloud_availableTags&#039;,
    ],
];</code></pre>
            <p>The above examples are a static list of nodes that can be changed by settings in ext_localconf.php. If that
is not enough, the NodeFactory can be extended with a resolver that is called dynamically for specific renderTypes.
This resolver gets the full current data array at runtime and can either return NULL saying &quot;not my job&quot;, or return
the name of a class that should handle this node.</p>
            <p>An example of this are the Core internal rich text editors. Both &quot;ckeditor&quot; and &quot;rtehtmlarea&quot; register a resolver class
that are called for node name &quot;text&quot;, and if the TCA config enables the editor, and if the user has enabled rich text
editing in his user settings, then the resolvers return their own RichTextElement class names to render a given text
field:</p>
            <pre><code class="language-php">// Register FormEngine node type resolver hook to render RTE in FormEngine if enabled
$GLOBALS[&#039;TYPO3_CONF_VARS&#039;][&#039;SYS&#039;][&#039;formEngine&#039;][&#039;nodeResolver&#039;][1480314091] = [
    &#039;nodeName&#039; =&gt; &#039;text&#039;,
    &#039;priority&#039; =&gt; 50,
    &#039;class&#039; =&gt; \TYPO3\CMS\RteCKEditor\Form\Resolver\RichTextNodeResolver::class,
];</code></pre>
            <p>The trick is here that &quot;ckeditor&quot; registers his resolver with ah higher priority (50) than &quot;rtehtmlarea&quot; (40), so the
&quot;ckeditor&quot; resolver is called first and wins if both extensions are loaded and if both return a valid class name.</p>
            <a id="FormEngine-Rendering-ResultArray"></a>
    </div>
<div class="section" id="result-array">
    <h1>Result Array</h1>
            <p>Each node, no matter if it is a container, an element, or a node expansion,
must return an array with specific data keys it wants to add. It is the job of the parent node that calls the sub node to
merge child node results into its own result. This typically happens by merging $childResult['html']
into an appropriate position of own HTML, and then calling $this-mergeChildReturnIntoExistingResult() to add
other array child demands like stylesheetFiles into its own result.</p>
            <p>Container and element nodes should use the helper method $this-initializeResultArray() to
have a result array initialized that is understood by a parent node.</p>
            <p>Only if extending existing element via node expansion, the result array
of a child can be slightly different. For instance, a FieldControl &quot;wizards&quot; must have a iconIdentifier
result key key. Using $this-initializeResultArray() is not appropriate in these cases but depends on the specific
expansion type. See below for more details on node expansion.</p>
            <p>The result array for container and element nodes looks like this.
$resultArray = $this-initializeResultArray() takes care of basic keys:</p>
            <pre><code class="language-php">[
    &#039;html&#039; =&gt; &#039;&#039;,
    &#039;additionalInlineLanguageLabelFiles&#039; =&gt; [],
    &#039;stylesheetFiles&#039; =&gt; [],
    &#039;javaScriptModules&#039; =&gt; $javaScriptModules,
    /** @deprecated requireJsModules will be removed in TYPO3 v13.0 */
    &#039;requireJsModules&#039; =&gt; [],
    &#039;inlineData&#039; =&gt; [],
    &#039;html&#039; =&gt; &#039;&#039;,
]</code></pre>
            <p>CSS and language labels (which can be used in JS) are added with their file
names in format EXT:my_extension/path/to/file.</p>
            <div class="phpdocumentor-admonition -note">
            <svg class="phpdocumentor-admonition__icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"></path></svg>
                    <article>
        <p>Nodes must never add assets like JavaScript or CSS using the
PageRenderer. This fails as soon as this container / element /
wizard is called via Ajax, for instance within inline. Instead,
those resources must be registered via the result array only,
using stylesheetFiles and javaScriptModules.</p>

    </article>
</div>
            <div class="section" id="adding-javascript-modules">
    <h2>Adding JavaScript modules</h2>
            <p>JavaScript is added as ES6 modules using the
function JavaScriptModuleInstruction::create().</p>
            <p>You can for example use it in a container:</p>
            <pre><code class="language-php">use TYPO3\CMS\Backend\Form\Container\AbstractContainer;
use TYPO3\CMS\Core\Page\JavaScriptModuleInstruction;

class SomeContainer extends AbstractContainer
{
    public function render()
    {
        $resultArray = $this-&gt;initializeResultArray();
        $resultArray[&#039;javaScriptModules&#039;][] =
            JavaScriptModuleInstruction::create(&#039;@myvendor/my_extension/my-javascript.js&#039;);
        // ...
        return $resultArray;
    }
}</code></pre>
            <p>Or a controller:</p>
            <pre><code class="language-php">use Psr\Http\Message\ResponseInterface;
use Psr\Http\Message\ServerRequestInterface;
use TYPO3\CMS\Core\Page\JavaScriptModuleInstruction;
use TYPO3\CMS\Core\Page\PageRenderer;

class SomeController
{
    public function mainAction(ServerRequestInterface $request): ResponseInterface
    {
        $javaScriptRenderer = $pageRenderer-&gt;getJavaScriptRenderer();
        $javaScriptRenderer-&gt;addJavaScriptModuleInstruction(
            JavaScriptModuleInstruction::create(&#039;@myvendor/my_extension/my-service.js&#039;)-&gt;invoke(&#039;someFunction&#039;)
        );
        // ...
        return $pageRenderer-&gt;renderResponse();
    }
}</code></pre>
    </div>
            <div class="section" id="adding-requirejs-modules">
    <h2>Adding RequireJS modules</h2>
            <dl>
                        <dt>The RequireJS project has been <a href="https://github.com/requirejs/requirejs/issues/1816">discontinued</a> and was therefore</dt>
        
        <dd>replaced by native ECMAScript v6/v11 modules in TYPO3 v12.0. The
infrastructure for configuration and loading of RequireJS
modules is deprecated with v12.0 and will be removed in TYPO3 v13. See
RequireJS to ES6 migration.</dd>    </dl>
            <p>If you want to support both TYPO3 v11 and v12 you can use a version switch:</p>
            <pre><code class="language-php">$typo3Version = new \TYPO3\CMS\Core\Information\Typo3Version();
if ($typo3Version-&gt;getMajorVersion() &lt; 12) {
    $resultArray[&#039;requireJsModules&#039;][] = JavaScriptModuleInstruction::forRequireJS(
        &#039;TYPO3/CMS/MyExtension/MyJavaScript&#039;
    )-&gt;instance($fieldId);
} else {
    $resultArray[&#039;javaScriptModules&#039;][] =
        JavaScriptModuleInstruction::create(&#039;@myvendor/my_extension/my-javascript.js&#039;);
}</code></pre>
            <p>Or stick to RequireJS and accept the deprecation warnings.</p>
            <a id="FormEngine-Rendering-NodeExpansion"></a>
    </div>
    </div>
<div class="section" id="node-expansion">
    <h1>Node Expansion</h1>
            <p>The &quot;node expansion&quot; classes FieldControl, FieldInformation and FieldWizard are called by containers
and elements and allow &quot;enriching&quot; containers and elements. Which enrichments are called can be configured via TCA.</p>
            <dl>
                        <dt>FieldInformation</dt>
        
        <dd>Additional information. In elements, their output is shown between the field label and the element itself. They can
not add functionality, but only simple and restricted HTML strings. No buttons, no images. An example usage could be
an extension that auto-translates a field content and outputs an information like &quot;Hey, this field was auto-filled
for you by an automatic translation wizard. Maybe you want to check the content&quot;.</dd>                        <dt>FieldWizard</dt>
        
        <dd>Wizards shown below the element. &quot;enrich&quot; an element with additional functionality. The localization wizard and
the file upload wizard of type=group fields are examples of that.</dd>                        <dt>FieldControl</dt>
        
        <dd>&quot;Buttons&quot;, usually shown next to the element. For type=group the &quot;list&quot; button and the &quot;element browser&quot; button
are examples. A field control <em>must</em> return an icon identifier.</dd>    </dl>
            <p>Currently, all elements usually implement all three of these, except in cases where it does not make sense. This API allows
adding functionality to single nodes, without overriding the whole node. Containers and elements can come with default
expansions (and usually do). TCA configuration can be used to add own stuff. On container side the implementation is still
basic, only OuterWrapContainer and InlineControlContainer currently implement FieldInformation and FieldWizard.</p>
            <p>See the TCA reference ctrl section for more information on how to configure these
for containers in TCA.</p>
            <p>Example. The InputTextElement (standard input element) defines a couple of default wizards and embeds them in its
main result HTML:</p>
            <pre><code class="language-php">class InputTextElement extends AbstractFormElement
{
    protected $defaultFieldWizard = [
        &#039;localizationStateSelector&#039; =&gt; [
            &#039;renderType&#039; =&gt; &#039;localizationStateSelector&#039;,
        ],
        &#039;otherLanguageContent&#039; =&gt; [
            &#039;renderType&#039; =&gt; &#039;otherLanguageContent&#039;,
            &#039;after&#039; =&gt; [
                &#039;localizationStateSelector&#039;
            ],
        ],
        &#039;defaultLanguageDifferences&#039; =&gt; [
            &#039;renderType&#039; =&gt; &#039;defaultLanguageDifferences&#039;,
            &#039;after&#039; =&gt; [
                &#039;otherLanguageContent&#039;,
            ],
        ],
    ];

    public function render()
    {
        $resultArray = $this-&gt;initializeResultArray();

        $fieldWizardResult = $this-&gt;renderFieldWizard();
        $fieldWizardHtml = $fieldWizardResult[&#039;html&#039;];
        $resultArray = $this-&gt;mergeChildReturnIntoExistingResult($resultArray, $fieldWizardResult, false);

        $mainFieldHtml = [];
        $mainFieldHtml[] = &#039;&lt;div class=&quot;form-control-wrap&quot;&gt;&#039;;
        $mainFieldHtml[] =  &#039;&lt;div class=&quot;form-wizards-wrap&quot;&gt;&#039;;
        $mainFieldHtml[] =      &#039;&lt;div class=&quot;form-wizards-element&quot;&gt;&#039;;
        // Main HTML of element done here ...
        $mainFieldHtml[] =      &#039;&lt;/div&gt;&#039;;
        $mainFieldHtml[] =      &#039;&lt;div class=&quot;form-wizards-items-bottom&quot;&gt;&#039;;
        $mainFieldHtml[] =          $fieldWizardHtml;
        $mainFieldHtml[] =      &#039;&lt;/div&gt;&#039;;
        $mainFieldHtml[] =  &#039;&lt;/div&gt;&#039;;
        $mainFieldHtml[] = &#039;&lt;/div&gt;&#039;;

        $resultArray[&#039;html&#039;] = implode(LF, $mainFieldHtml);
        return $resultArray;
    }
}</code></pre>
            <p>This element defines three wizards to be called by default. The renderType concept is re-used, the
values localizationStateSelector are registered within the NodeFactory and resolve to class names. They
can be overridden and extended like all other nodes. The $defaultFieldWizards are merged with TCA settings
by the helper method renderFieldWizards(), which uses the DependencyOrderingService again.</p>
            <p>It is possible to:</p>
            

<ul>
    <li>Override existing expansion nodes with own ones from extensions, even using the resolver mechanics is possible.</li>
    <li>It is possible to disable single wizards via TCA</li>
    <li>It is possible to add own expansion nodes at any position relative to the other nodes by specifying &quot;before&quot; and
&quot;after&quot; in TCA.</li>
</ul>
    </div>
<div class="section" id="add-fieldcontrol-example">
    <h1>Add fieldControl Example</h1>
            <p>To illustrate the principals discussed in this chapter see the following
example which registers a fieldControl (button) next to a field in the pages
table to trigger a data import via Ajax.</p>
            <p>Add a new renderType in ext_localconf.php:</p>
            <pre><code class="language-php">$GLOBALS[&#039;TYPO3_CONF_VARS&#039;][&#039;SYS&#039;][&#039;formEngine&#039;][&#039;nodeRegistry&#039;][1485351217] = [
   &#039;nodeName&#039; =&gt; &#039;importDataControl&#039;,
   &#039;priority&#039; =&gt; 30,
   &#039;class&#039; =&gt; \T3G\Something\FormEngine\FieldControl\ImportDataControl::class
];</code></pre>
            <p>Register the control in Configuration/TCA/Overrides/pages.php:</p>
            <pre><code class="language-php">&#039;somefield&#039; =&gt; [
   &#039;label&#039;   =&gt; $langFile . &#039;:pages.somefield&#039;,
   &#039;config&#039;  =&gt; [
      &#039;type&#039; =&gt; &#039;input&#039;,
      &#039;eval&#039; =&gt; &#039;int, unique&#039;,
      &#039;fieldControl&#039; =&gt; [
         &#039;importControl&#039; =&gt; [
            &#039;renderType&#039; =&gt; &#039;importDataControl&#039;
         ]
      ]
   ]
],</code></pre>
            <p>Add the php class for rendering the control in
Classes/FormEngine/FieldControl/ImportDataControl.php:</p>
            <pre><code class="language-php">declare(strict_types=1);

namespace Vendor\SomeExtension\FormEngine\FieldControl;

use TYPO3\CMS\Backend\Form\AbstractNode;

class ImportDataControl extends AbstractNode
{
   public function render()
   {
      $result = [
         &#039;iconIdentifier&#039; =&gt; &#039;import-data&#039;,
         &#039;title&#039; =&gt; $GLOBALS[&#039;LANG&#039;]-&gt;sL(&#039;LLL:EXT:something/Resources/Private/Language/locallang_db.xlf:pages.importData&#039;),
         &#039;linkAttributes&#039; =&gt; [
            &#039;class&#039; =&gt; &#039;importData &#039;,
            &#039;data-id&#039; =&gt; $this-&gt;data[&#039;databaseRow&#039;][&#039;somefield&#039;]
         ],
         &#039;requireJsModules&#039; =&gt; [&#039;TYPO3/CMS/Something/ImportData&#039;],
      ];
      return $result;
   }
}</code></pre>
            <dl>
                        <dt>This example is still in RequireJS. RequireJS has been deprecated with</dt>
        
        <dd>TYPO3 v12. Help us transferring the example into ES6.
See h2document:contribute.</dd>    </dl>
            <p>Add the JavaScript for defining the behavior of the control in
Resources/Public/JavaScript/ImportData.js:</p>
            <pre><code class="language-javascript">/**
* Module: TYPO3/CMS/Something/ImportData
*
* JavaScript to handle data import
* @exports TYPO3/CMS/Something/ImportData
*/
define(function () {
   &#039;use strict&#039;;

   /**
   * @exports TYPO3/CMS/Something/ImportData
   */
   var ImportData = {};

   /**
   * @param {int} id
   */
   ImportData.import = function (id) {
      $.ajax({
         type: &#039;POST&#039;,
         url: TYPO3.settings.ajaxUrls[&#039;something-import-data&#039;],
         data: {
            &#039;id&#039;: id
         }
      }).done(function (response) {
         if (response.success) {
            top.TYPO3.Notification.success(&#039;Import Done&#039;, response.output);
         } else {
            top.TYPO3.Notification.error(&#039;Import Error!&#039;);
         }
      });
   };

   /**
   * initializes events using deferred bound to document
   * so Ajax reloads are no problem
   */
   ImportData.initializeEvents = function () {

      $(&#039;.importData&#039;).on(&#039;click&#039;, function (evt) {
         evt.preventDefault();
         ImportData.import($(this).attr(&#039;data-id&#039;));
      });
   };

   $(ImportData.initializeEvents);

   return ImportData;
});</code></pre>
            <p>Add an Ajax route for the request in
Configuration/Backend/AjaxRoutes.php:</p>
            <pre><code class="language-php">&lt;?php
return [
   &#039;something-import-data&#039; =&gt; [
      &#039;path&#039; =&gt; &#039;/something/import-data&#039;,
      &#039;target&#039; =&gt; \T3G\Something\Controller\Ajax\ImportDataController::class . &#039;::importDataAction&#039;
   ],
];</code></pre>
            <p>Add the Ajax controller class in
Classes/Controller/Ajax/ImportDataController.php:</p>
            <pre><code class="language-php">declare(strict_types=1);

namespace T3G\Something\Controller\Ajax;

use Psr\Http\Message\ResponseInterface;
use Psr\Http\Message\ServerRequestInterface;

class ImportDataController
{
   /**
   * @param ServerRequestInterface $request
   * @param ResponseInterface $response
   * @return ResponseInterface
   */
   public function importDataAction(ServerRequestInterface $request, ResponseInterface $response)
   {
      $queryParameters = $request-&gt;getParsedBody();
      $id = (int)$queryParameters[&#039;id&#039;];

      if (empty($id)) {
         $response-&gt;getBody()-&gt;write(json_encode([&#039;success&#039; =&gt; false]));
         return $response;
      }
      $param = &#039; -id=&#039; . $id;

      // trigger data import (simplified as example)
      $output = shell_exec(&#039;.&#039; . DIRECTORY_SEPARATOR . &#039;import.sh&#039; . $param);

      $response-&gt;getBody()-&gt;write(json_encode([&#039;success&#039; =&gt; true, &#039;output&#039; =&gt; $output]));
      return $response;
   }
}</code></pre>
    </div>

    </section>
                            </div>
            <section data-search-results class="phpdocumentor-search-results phpdocumentor-search-results--hidden">
    <section class="phpdocumentor-search-results__dialog">
        <header class="phpdocumentor-search-results__header">
            <h2 class="phpdocumentor-search-results__title">Search results</h2>
            <button class="phpdocumentor-search-results__close"><i class="fas fa-times"></i></button>
        </header>
        <section class="phpdocumentor-search-results__body">
            <ul class="phpdocumentor-search-results__entries"></ul>
        </section>
    </section>
</section>
        </div>
        <a href="guide/ApiOverview/FormEngine/Rendering/Index.html#top" class="phpdocumentor-back-to-top"><i class="fas fa-chevron-circle-up"></i></a>

    </main>

    <script>
        cssVars({});
    </script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/prism.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/plugins/line-numbers/prism-line-numbers.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/plugins/line-highlight/prism-line-highlight.min.js"></script>
</body>
</html>