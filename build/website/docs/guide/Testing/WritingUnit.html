<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
                    <title>phpDocumentor</title>
    

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <base href="../../">
    <link rel="icon" href="images/favicon.ico"/>
    <link rel="stylesheet" href="css/normalize.css">
    <link rel="stylesheet" href="css/base.css">
            <link rel="preconnect" href="https://fonts.gstatic.com">
        <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@100;200;300;400;600;700&display=swap" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:wght@400;600;700&display=swap" rel="stylesheet">
        <link rel="stylesheet" href="css/template.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0/css/all.min.css" integrity="sha256-ybRkN9dBjhcS2qrW1z+hfCxq+1aBdwyQM5wlQoQVt/0=" crossorigin="anonymous" />
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/themes/prism-okaidia.css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/plugins/line-numbers/prism-line-numbers.css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/plugins/line-highlight/prism-line-highlight.css">
                <script src="https://cdn.jsdelivr.net/npm/fuse.js@3.4.6"></script>
        <script src="https://cdn.jsdelivr.net/npm/css-vars-ponyfill@2"></script>
        <script src="js/template.js"></script>
        <script src="js/search.js"></script>
        <script defer src="js/searchIndex.js"></script>
    </head>
<body id="top">
    <header class="phpdocumentor-header phpdocumentor-section">
    <h1 class="phpdocumentor-title"><a href="" class="phpdocumentor-title__link">phpDocumentor</a></h1>
    <input class="phpdocumentor-header__menu-button" type="checkbox" id="menu-button" name="menu-button" />
    <label class="phpdocumentor-header__menu-icon" for="menu-button">
        <i class="fas fa-bars"></i>
    </label>
    <section data-search-form class="phpdocumentor-search">
    <label>
        <span class="visually-hidden">Search for</span>
        <svg class="phpdocumentor-search__icon" width="21" height="20" viewBox="0 0 21 20" fill="none" xmlns="http://www.w3.org/2000/svg">
            <circle cx="7.5" cy="7.5" r="6.5" stroke="currentColor" stroke-width="2"/>
            <line x1="12.4892" y1="12.2727" x2="19.1559" y2="18.9393" stroke="currentColor" stroke-width="3"/>
        </svg>
        <input type="search" class="phpdocumentor-field phpdocumentor-search__field" placeholder="Loading .." disabled />
    </label>
</section>

    <nav class="phpdocumentor-topnav">
    <ul class="phpdocumentor-topnav__menu">
        </ul>
</nav>
</header>

    <main class="phpdocumentor">
        <div class="phpdocumentor-section">
            <input class="phpdocumentor-sidebar__menu-button" type="checkbox" id="sidebar-button" name="sidebar-button" />
<label class="phpdocumentor-sidebar__menu-icon" for="sidebar-button">
    Menu
</label>
<aside class="phpdocumentor-column -three phpdocumentor-sidebar">
                    <section class="phpdocumentor-sidebar__category">
            <h2 class="phpdocumentor-sidebar__category-header">typo3-explained</h2>
                                    <h4 class="phpdocumentor-sidebar__root-namespace">
    <a href="guide/Introduction/Index.html#introduction" class="">Introduction</a>
</h4>
    <ul class="phpdocumentor-list">
                    <li>
                <a href="guide/Introduction/Index.html#system-overview-1" class="">System Overview</a>
                
            </li>
                    <li>
                <a href="guide/Introduction/Index.html#a-basic-installation" class="">A basic installation</a>
                
            </li>
            </ul>

                                    <h4 class="phpdocumentor-sidebar__root-namespace">
    <a href="guide/ApiOverview/Index.html#api-a-z" class="">API A-Z</a>
</h4>

                                    <h4 class="phpdocumentor-sidebar__root-namespace">
    <a href="guide/CodingGuidelines/Index.html#cgl" class="">Coding Guidelines</a>
</h4>
    <ul class="phpdocumentor-list">
                    <li>
                <a href="guide/CodingGuidelines/Introduction.html#cgl-introduction" class="">Introduction</a>
                
            </li>
                    <li>
                <a href="guide/CodingGuidelines/CglPhp/Index.html#cgl-php" class="">PHP Coding Guidelines</a>
                
            </li>
                    <li>
                <a href="guide/CodingGuidelines/CglJavaScript/Index.html#cgl-javascript" class="">JavaScript Coding Guidelines</a>
                
            </li>
                    <li>
                <a href="guide/CodingGuidelines/CglTypeScript/Index.html#cgl-typescript" class="">TypeScript Coding Guidelines</a>
                
            </li>
                    <li>
                <a href="guide/CodingGuidelines/CglTypoScript/Index.html#cgl-typoscript" class="">TypoScript Coding Guidelines</a>
                
            </li>
                    <li>
                <a href="guide/CodingGuidelines/CglTsConfig.html#cgl-tsconfig" class="">TSconfig Coding Guidelines</a>
                
            </li>
                    <li>
                <a href="guide/CodingGuidelines/CglXliff/Index.html#cgl-xliff" class="">Xliff Coding Guidelines</a>
                
            </li>
                    <li>
                <a href="guide/CodingGuidelines/CglYaml.html#cgl-yaml" class="">Yaml Coding Guidelines</a>
                
            </li>
                    <li>
                <a href="guide/CodingGuidelines/CglRest/Index.html#cgl-rest" class="">reStructuredText (reST)</a>
                
            </li>
            </ul>

                                    <h4 class="phpdocumentor-sidebar__root-namespace">
    <a href="guide/Configuration/Index.html#configuration" class="">Configuration</a>
</h4>
    <ul class="phpdocumentor-list">
                    <li>
                <a href="guide/Configuration/ConfigurationOverview.html#config-overview" class="">Configuration overview</a>
                
            </li>
                    <li>
                <a href="guide/Configuration/Glossary.html#configuration-classification" class="">Glossary</a>
                
            </li>
                    <li>
                <a href="guide/Configuration/ConfigurationFiles.html#configuration-files" class="">Configuration files</a>
                
            </li>
                    <li>
                <a href="guide/Configuration/ConfigurationModule/Index.html#configuration-module" class="">Configuration module</a>
                
            </li>
                    <li>
                <a href="guide/Configuration/FeatureToggles.html#feature-toggles" class="">Feature toggles</a>
                
            </li>
                    <li>
                <a href="guide/Configuration/GlobalVariables.html#globals-variables" class="">$GLOBALS</a>
                
            </li>
                    <li>
                <a href="guide/Configuration/Typo3ConfVars/Index.html#typo3-conf-vars" class="">TYPO3_CONF_VARS</a>
                
            </li>
                    <li>
                <a href="guide/Configuration/Typo3Information.html#typo3Information" class="">Global meta information about TYPO3</a>
                
            </li>
                    <li>
                <a href="guide/Configuration/Tsconfig.html#tsconfig" class="">TSconfig</a>
                
            </li>
                    <li>
                <a href="guide/Configuration/TypoScriptSyntax/Index.html#typoscript-syntax-about" class="">TypoScript syntax</a>
                
            </li>
                    <li>
                <a href="guide/Configuration/UserSettingsConfiguration/Index.html#user-settings" class="">User settings configuration</a>
                
            </li>
                    <li>
                <a href="guide/Configuration/Yaml/Index.html#yaml" class="">YAML</a>
                
            </li>
            </ul>

                                    <h4 class="phpdocumentor-sidebar__root-namespace">
    <a href="guide/ExtensionArchitecture/Index.html#extension-development" class="">Extension development</a>
</h4>
    <ul class="phpdocumentor-list">
                    <li>
                <a href="guide/ExtensionArchitecture/Concepts/Index.html#extension-concepts" class="">Concepts</a>
                
            </li>
                    <li>
                <a href="guide/ExtensionArchitecture/FileStructure/Index.html#extension-reserved-folders-legacy" class="">File structure</a>
                
            </li>
                    <li>
                <a href="guide/ExtensionArchitecture/HowTo/Index.html#extension-howto" class="">Howto</a>
                
            </li>
                    <li>
                <a href="guide/ExtensionArchitecture/Extbase/Index.html#extbase" class="">Extbase</a>
                
            </li>
                    <li>
                <a href="guide/ExtensionArchitecture/BestPractises/Index.html#extension-Best-practises" class="">Best practises and conventions</a>
                
            </li>
                    <li>
                <a href="guide/ExtensionArchitecture/Tutorials/Index.html#extension-tutorials" class="">Tutorials</a>
                
            </li>
            </ul>

                                    <h4 class="phpdocumentor-sidebar__root-namespace">
    <a href="guide/Security/Index.html#security" class="">Security guidelines</a>
</h4>
    <ul class="phpdocumentor-list">
                    <li>
                <a href="guide/Security/Introduction/Index.html#security-introduction" class="">Introduction</a>
                
            </li>
                    <li>
                <a href="guide/Security/SecurityTeam/Index.html#security-team" class="">The TYPO3 Security Team</a>
                
            </li>
                    <li>
                <a href="guide/Security/GeneralInformation/Index.html#security-general-information" class="">General Information</a>
                
            </li>
                    <li>
                <a href="guide/Security/TypesOfThreats/Index.html#security-threats" class="">Types of Security Threats</a>
                
            </li>
                    <li>
                <a href="guide/Security/GeneralGuidelines/Index.html#security-general-guidelines" class="">General guidelines</a>
                
            </li>
                    <li>
                <a href="guide/Security/GuidelinesAdministrators/Index.html#security-administrators" class="">Guidelines for System Administrators</a>
                
            </li>
                    <li>
                <a href="guide/Security/GuidelinesExtensionDevelopment/Index.html#security-extension-development" class="">Guidelines for extension development</a>
                
            </li>
                    <li>
                <a href="guide/Security/GuidelinesIntegrators/Index.html#security-integrators" class="">Guidelines for TYPO3 integrators</a>
                
            </li>
                    <li>
                <a href="guide/Security/GuidelinesEditors/Index.html#security-editors" class="">Guidelines for editors</a>
                
            </li>
                    <li>
                <a href="guide/Security/Backups/Index.html#security-backups" class="">Backup strategy</a>
                
            </li>
                    <li>
                <a href="guide/Security/HackedSite/Index.html#security-detect-analyze-repair" class="">Detect, analyze and repair a hacked site</a>
                
            </li>
            </ul>

                                    <h4 class="phpdocumentor-sidebar__root-namespace">
    <a href="guide/Testing/Index.html#testing" class="">Testing</a>
</h4>
    <ul class="phpdocumentor-list">
                    <li>
                <a href="guide/Testing/History.html#testing-history" class="">History</a>
                
            </li>
                    <li>
                <a href="guide/Testing/CoreTesting.html#testing-core" class="">Core testing</a>
                
            </li>
                    <li>
                <a href="guide/Testing/ExtensionTesting.html#testing-extensions" class="">Extension testing</a>
                
            </li>
                    <li>
                <a href="guide/Testing/ProjectTesting.html#testing-projects" class="">Project testing</a>
                
            </li>
                    <li>
                <a href="guide/Testing/WritingUnit.html#testing-writing-unit" class="">Writing unit tests</a>
                
            </li>
                    <li>
                <a href="guide/Testing/WritingFunctional.html#testing-writing-functional" class="">Writing functional tests</a>
                
            </li>
                    <li>
                <a href="guide/Testing/WritingAcceptance.html#testing-writing-acceptance" class="">Writing acceptance tests</a>
                
            </li>
                    <li>
                <a href="guide/Testing/Faq.html#testing-faq" class="">FAQ</a>
                
            </li>
            </ul>

                                    <h4 class="phpdocumentor-sidebar__root-namespace">
    <a href="guide/About.html#about" class="">About This Manual</a>
</h4>
    <ul class="phpdocumentor-list">
                    <li>
                <a href="guide/About.html#intended-audience" class="">Intended Audience</a>
                
            </li>
                    <li>
                <a href="guide/About.html#code-examples-1" class="">Code examples</a>
                
            </li>
                    <li>
                <a href="guide/About.html#feedback-and-contribute" class="">Feedback and Contribute</a>
                
            </li>
                    <li>
                <a href="guide/About.html#credits-1" class="">Credits</a>
                
            </li>
                    <li>
                <a href="guide/About.html#dedication-1" class="">Dedication</a>
                
            </li>
            </ul>

                                    <h4 class="phpdocumentor-sidebar__root-namespace">
    <a href="guide/Sitemap.html#sitemap" class="">Sitemap</a>
</h4>

                                    <h4 class="phpdocumentor-sidebar__root-namespace">
    <a href="guide/genindex.html#index" class="">Index</a>
</h4>

                        </section>
            
    <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Reports</h2>
                <h3 class="phpdocumentor-sidebar__root-package"><a href="reports/deprecated.html">Deprecated</a></h3>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="reports/errors.html">Errors</a></h3>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="reports/markers.html">Markers</a></h3>
    </section>

    <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Indices</h2>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="indices/files.html">Files</a></h3>
    </section>
</aside>

            <div class="phpdocumentor-column -nine phpdocumentor-content">
                                        <section>
        
<div class="section" id="testing-writing-unit">
    <h1>Writing unit tests</h1>
    </div>
<div class="section" id="introduction">
    <h1>Introduction</h1>
            <p>This chapter goes into details about writing and maintaining unit tests in the TYPO3
world. Core developers over the years gained quite some knowledge and experience on
this topic, this section outlines some best practices and goes into details about
some of the TYPO3 specific unit testing details that have been put on top of the native
phpunit stack: At the time of this writing the TYPO3 Core contains about ten thousand
unit tests - many of them are good, some are bad and we&#039;re constantly improving
details. Unit testing is a great playground for interested contributors, and most
extension developers probably learn something useful from reading this section, too.</p>
            <p>Note this chapter is not a full &quot;How to write unit tests&quot; documentation: It contains
some examples, but mostly goes into details of the additions <a href="https://github.com/TYPO3/testing-framework">typo3/testing-framework</a>
puts on top.</p>
            <p>Furthermore, this documentation is a general guide. There can be reasons to violate them.
These are no hard rules to always follow.</p>
    </div>
<div class="section" id="when-to-unit-test">
    <h1>When to unit test</h1>
            <p>It depends on the code you&#039;re writing if unit testing that specific code is useful or not.
There are certain areas that scream to be unit tested: You&#039;re writing a method that does some PHP
array munging or sorting, juggling keys and values around? Unit test this! You&#039;re
writing something that involves date calculations? No way to get that right without unit
testing! You&#039;re throwing a regex at some string? The unit test data provider should already
exist before you start with implementing the method!</p>
            <p>In general, whenever a rather small piece of code does some dedicated munging on a rather
small set of data, unit testing this isolated piece is helpful. It&#039;s a healthy developer
attitude to assume any written code is broken. Isolating that code and throwing unit tests at
it will proof its broken. Promised. Add edge cases to your unit test data provider, feed
it with whatever you can think of and continue doing that until your code survives all that.
Depending on your use case, develop <a href="https://en.wikipedia.org/wiki/Test-driven_development">test-driven</a>: Test first, fail, fix, refactor, next iteration.</p>
            <p>Good to-be-unit-tested code does usually not contain much state, sometimes it&#039;s static.
Services or utilities are often good
targets for unit testing, sometimes some detail method of a class that has not been extracted
to an own class, too.</p>
    </div>
<div class="section" id="when-not-to-unit-test">
    <h1>When not to unit test</h1>
            <p>Simply put: Do not unit test &quot;glue code&quot;. There are persons proclaiming &quot;100% unit test coverage&quot;.
This does not make sense. As an extension developer working on top of framework functionality, it
usually does not make sense to unit test glue code. What is glue code? Well, code
that fetches things from one underlying part and feeds it to some other part: Code that &quot;glues&quot;
framework functionality together.</p>
            <p>Good examples are often Extbase MVC controller actions: A typical controller usually does not do much
more than fetching some objects from a repository just to assign them to the view. There is no benefit in
adding a unit test for this: A unit test can&#039;t do much more than verifying some specific framework
methods are actually called. It thus needs to mock the object dependencies to only verify some
method is hit with some argument. This is tiresome to set up and you&#039;re then testing a trivial
part of your controller: Looking at the controller clearly shows the underlying method <em>is</em> called.
Why bother?</p>
            <p>Another example are Extbase models: Most Extbase model properties consist of a protected property,
a getter and a setter method. This is near no-brainer code, and many developers auto-generate
getters and setters by an IDE anyway. Unit testing this code leads to broken tests with each trivial
change of the model class. That&#039;s tiresome and likely some waste of time. Concentrate unit testing
efforts on stuff that does data munging magic as outlined above! One of your model getters initializes
some object storage, then sorts and filters objects? <em>That</em> can be helpful if unit tested, your filter
code is otherwise most likely broken. Add unit tests to prove it&#039;s not.</p>
            <p>A much better way of testing glue code are functional tests: Set up a proper scenario in your
database, then call your controller that will use your repository and models, then verify your
view returns something useful. With adding a functional test for this you can kill many
birds with one stone. This has many more benefits than trying to unit test glue code.</p>
            <p>A good sign that your unit test would be more useful if it is turned into a functional test is if
the unit tests needs lots of lines of code to mock dependencies, just to test something using
-shouldBeCalled() on some mock to verify on some dependency is actually called. Go ahead and
read some unit tests provided by the Core: We&#039;re sure you&#039;ll find a bad unit test that could be improved
by creating a functional test from it.</p>
    </div>
<div class="section" id="unit-test-conventions">
    <h1>Unit test conventions</h1>
            <p>TYPO3 unit testing means using the <a href="https://phpunit.de/">phpunit</a> testing framework. TYPO3 comes with
as basic <a href="https://github.com/TYPO3/testing-framework/blob/main/Resources/Core/Build/UnitTests.xml">UnitTests.xml</a>
file that can be used by Core and extensions. This references a phpunit <a href="https://github.com/TYPO3/testing-framework/blob/main/Resources/Core/Build/UnitTestsBootstrap.php">bootstrap file</a> so
phpunit does find our main classes. Apart from that, there are little conventionsClasses/ folder should be located at the same position within the Test/Unit
folder having the additional suffix Test.php to the system under test file name. The class of the
test file should extend the basic unit test abstract TYPO3\TestingFramework\Core\Unit\UnitTestCase. Single
tests should be named starting with the method that is tested plus some explaining suffix and should
be annotated with @test.</p>
            <p>Example for a system under test located at typo3/sysext/core/Utility/ArrayUtility.php (stripped):</p>
            <pre><code class="language-php">&lt;?php
namespace TYPO3\CMS\Core\Utility;
class ArrayUtility
{

    //...

    public static function filterByValueRecursive($needle = &#039;&#039;, array $haystack = [])
    {
        // System under test code
    }
}</code></pre>
            <p>The test file is located at typo3/sysext/core/Tests/Unit/Utility/ArrayUtilityTest.php (stripped):</p>
            <pre><code class="language-php">&lt;?php
namespace TYPO3\CMS\Core\Tests\Unit\Utility;
use TYPO3\CMS\Core\Utility\ArrayUtility;
use TYPO3\TestingFramework\Core\Unit\UnitTestCase;
class ArrayUtilityTest extends UnitTestCase
{

    //...

    /**
     * @test
     * @dataProvider filterByValueRecursive
     */
    public function filterByValueRecursiveCorrectlyFiltersArray($needle, $haystack, $expectedResult)
    {
        // Unit test code
    }
}</code></pre>
            <p>This way it is easy to find unit tests for any given file. Note PhpStorm understands this structure and
can jump from a file to the according test file by hitting CTRL+Shift+T.</p>
    </div>
<div class="section" id="keep-it-simple">
    <h1>Keep it simple</h1>
            <p>This is an importing rule in testingsetUp() just to
park it as in property. It is easier to read to just have a $subject = new MyClass()
call in each test at the appropriate place. Test classes are often much longer than the
system under test. That is ok. It&#039;s better if a single test is very simple and to copy over
lines from one to the other test over and over again than trying to abstract that away.
Keep tests as simple as possible to read and don&#039;t use fancy abstraction features.</p>
    </div>
<div class="section" id="extending-unittestcase">
    <h1>Extending UnitTestCase</h1>
            <p>Extending a unit test from class TYPO3\TestingFramework\Core\Unit\UnitTestCase of the
typo3/testing-framework package instead of the native phpunit class PHPUnit\Framework\TestCase
adds some functionality on top of phpunit:</p>
            

<ul>
    <li>Environment backupEnvironment class, setting
property $backupEnvironment to true instructs the unit test to reset the state after each call.</li>
    <li>If a system under test creates instances of classes implementing SingletonInterface, setting
property $resetSingletonInstances to true instructs the unit test to reset internal
GeneralUtility scope after each test. tearDown() will fail if there are dangling singletons,
otherwise.</li>
    <li>Adding files or directories to array property $testFilesToDelete instructs the test to delete
certain files or entire directories that have been created by unit tests. This property is useful
to keep the system clean.</li>
    <li>A generic tearDown() methodparent::tearDown()
at the end of the inherited method to have the parent method kick in!</li>
    <li>A getAccessibleMock() methodgetAccessibleMock()
can be very helpful to get things done.</li>
</ul>
    </div>
<div class="section" id="general-hints">
    <h1>General hints</h1>
            

<ul>
    <li>Creating an instance of the system under test should be done with new in the unit test and
not using GeneralUtility::makeInstance().</li>
    <li>Only use getAccessibleMock() if parts of the system under test class itself needs to be
mocked. Never use it for an object that is created by the system under test itself.</li>
    <li>Unit tests are by default configured to fail if a notice level PHP error is triggered.
This has been used in the Core to slowly make the framework notice free. Extension authors may fall
into a trap here: First, the unit test code itself, or the system under test may trigger notices.
Developers should fix that. But it may happen a Core
dependency triggers a notice that in turn lets the extensions unit test fail. At best, the extension
developer pushes a patch to the Core to fix that notice. Another solution is to mock the dependency
away, which may however not be desired or possible - especially with static dependencies.</li>
</ul>
    </div>
<div class="section" id="a-casual-data-provider">
    <h1>A casual data provider</h1>
            <p>This is one of the most common use cases in unit testingArrayUtilityTest:</p>
            <pre><code class="language-php">/**
 * Data provider for removeByPathRemovesCorrectPath
 */
public function removeByPathRemovesCorrectPathDataProvider()
{
    return [
        &#039;single value&#039; =&gt; [
            [
                &#039;foo&#039; =&gt; [
                    &#039;toRemove&#039; =&gt; 42,
                    &#039;keep&#039; =&gt; 23
                ],
            ],
            &#039;foo/toRemove&#039;,
            [
                &#039;foo&#039; =&gt; [
                    &#039;keep&#039; =&gt; 23,
                ],
            ],
        ],
        &#039;whole array&#039; =&gt; [
            [
                &#039;foo&#039; =&gt; [
                    &#039;bar&#039; =&gt; 42
                ],
            ],
            &#039;foo&#039;,
            [],
        ],
        &#039;sub array&#039; =&gt; [
            [
                &#039;foo&#039; =&gt; [
                    &#039;keep&#039; =&gt; 23,
                    &#039;toRemove&#039; =&gt; [
                        &#039;foo&#039; =&gt; &#039;bar&#039;,
                    ],
                ],
            ],
            &#039;foo/toRemove&#039;,
            [
                &#039;foo&#039; =&gt; [
                    &#039;keep&#039; =&gt; 23,
                ],
            ],
        ],
    ];
}

/**
 * @test
 * @dataProvider removeByPathRemovesCorrectPathDataProvider
 * @param array $array
 * @param string $path
 * @param array $expectedResult
 */
public function removeByPathRemovesCorrectPath(array $array, $path, $expectedResult)
{
    $this-&gt;assertEquals(
        $expectedResult,
        ArrayUtility::removeByPath($array, $path)
    );
}</code></pre>
            <p>Some hints on this: Try to give the single data sets good names, here &quot;single value&quot;, &quot;whole array&quot; and &quot;sub array&quot;.
This helps to find a broken data set in the code, it forces the test writer to think about what they are feeding
to the test and it helps avoiding duplicate sets. Additionally, put the data provider directly before the according
test and name it &quot;test name&quot; + &quot;DataProvider&quot;. Data providers are often not used in multiple tests, so that should
almost always work.</p>
    </div>
<div class="section" id="mocking">
    <h1>Mocking</h1>
            <p>Unit tests should test one thing at a time, often one method only. If the system under test has dependencies
like additional objects, they should be usually &quot;mocked away&quot;. A simple example is this, taken from
TYPO3\CMS\Backend\Tests\Unit\Controller\FormInlineAjaxControllerTest:</p>
            <pre><code class="language-php">/**
 * @test
 */
public function createActionThrowsExceptionIfContextIsEmpty(): void
{
    $requestProphecy = $this-&gt;prophesize(ServerRequestInterface::class);
    $requestProphecy-&gt;getParsedBody()-&gt;shouldBeCalled()-&gt;willReturn(
        [
            &#039;ajax&#039; =&gt; [
                &#039;context&#039; =&gt; &#039;&#039;,
            ],
        ]
    );
    $this-&gt;expectException(\RuntimeException::class);
    $this-&gt;expectExceptionCode(1489751361);
    (new FormInlineAjaxController())-&gt;createAction($requestProphecy-&gt;reveal());
}</code></pre>
            <p><a href="https://github.com/phpspec/prophecy">Prophecy</a> is a nice mocking framework bundled into phpunit
by default. Many people prefer it nowadays over phpunit&#039;s own mock framework based on -getMock()
and we encourage to use prophecy: Prophecy code is often easier to read and the separation of
the dummy object that is given to the system under test, the &quot;revelation&quot;, and the object prophecy
is quite handy. Prophecy is quite some fun to use, go ahead and play around with it.</p>
            <p>The above case is pretty straight since the mocked dependency is hand over as argument to
the system under test. If the system under test however creates an instance of the to-mock
dependency on its own - typically using GeneralUtility::makeInstance(), the mock instance
can be manually registered for makeInstance:</p>
            <pre><code class="language-php">use TYPO3\CMS\Core\Utility\GeneralUtility;
use TYPO3\CMS\Core\Imaging\IconFactory;

GeneralUtility::addInstance(IconFactory::class, $iconFactoryProphecy-&gt;reveal());</code></pre>
            <p>This works well for prototypes. addInstance() adds objects to a LiFo, multiple instances
of the same class can be stacked. The generic -tearDown() later confirms the stack is
empty to avoid side effects on other tests. Singleton instances can be registered in a
similar way:</p>
            <pre><code class="language-php">use TYPO3\CMS\Core\Utility\GeneralUtility;
use TYPO3\CMS\Extbase\Service\EnvironmentService;

 GeneralUtility::setSingletonInstance(EnvironmentService::class, $environmentServiceMock);</code></pre>
            <p>If adding singletons, make sure to set the property protected $resetSingletonInstances = true;,
otherwise -tearDown() will detect a dangling singleton and let&#039;s the unit test fail
to avoid side effects on other tests.</p>
    </div>
<div class="section" id="static-dependencies">
    <h1>Static dependencies</h1>
            <p>If a system under test has a dependency to a static method (typically from a utility class), then
hopefully the static method is a &quot;good&quot; dependency that sticks to the general
static method guide: A &quot;good&quot; static dependency has no state,
triggers no further code that has state. If this is the case, think of this dependency code as
being inlined within the system under test directly. Do not try to mock it away, just test
it along with the system under test.</p>
            <p>If however the static method that is called is a &quot;bad&quot; dependency that statically calls further
magic by creating new objects, doing database calls and has own state, this is harder to come by.
One solution is to extract the static method call to an own method, then use getAccessibleMock()
to mock that method away. And yeah, that is ugly. Unit tests can quite quickly show which parts
of the framework are not modelled in a good way. A typical case is
TYPO3\CMS\Backend\Utility\BackendUtility - trying to unit test systems that have this
class as dependency is often very painful. There is not much developers can do in this case. The
Core tries to slowly improve these areas over time and indeed BackendUtility is shrinking
each version.</p>
    </div>
<div class="section" id="exception-handling">
    <h1>Exception handling</h1>
            <p>Code should throw exceptions if something goes wrong. See working with exceptions for some general guides on proper exception handling.
Exceptions are often very easy to unit test and testing them can be beneficial. Let&#039;s take
a simple example, this is from TYPO3\CMS\Core\Tests\Unit\Cache\CacheManagerTest
and tests both the exception class and the exception code:</p>
            <pre><code class="language-php">use TYPO3\CMS\Core\Cache\CacheManager;
use TYPO3\CMS\Core\Cache\Exception\NoSuchCacheGroupException;

/**
* @test
*/
public function flushCachesInGroupThrowsExceptionForNonExistingGroup()
{
  $this-&gt;expectException(NoSuchCacheGroupException::class);
  $this-&gt;expectExceptionCode(1390334120);
  $subject = new CacheManager();
  $subject-&gt;flushCachesInGroup(&#039;nonExistingGroup&#039;);
}</code></pre>
    </div>

    </section>
                            </div>
            <section data-search-results class="phpdocumentor-search-results phpdocumentor-search-results--hidden">
    <section class="phpdocumentor-search-results__dialog">
        <header class="phpdocumentor-search-results__header">
            <h2 class="phpdocumentor-search-results__title">Search results</h2>
            <button class="phpdocumentor-search-results__close"><i class="fas fa-times"></i></button>
        </header>
        <section class="phpdocumentor-search-results__body">
            <ul class="phpdocumentor-search-results__entries"></ul>
        </section>
    </section>
</section>
        </div>
        <a href="guide/Testing/WritingUnit.html#top" class="phpdocumentor-back-to-top"><i class="fas fa-chevron-circle-up"></i></a>

    </main>

    <script>
        cssVars({});
    </script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/prism.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/plugins/line-numbers/prism-line-numbers.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/plugins/line-highlight/prism-line-highlight.min.js"></script>
</body>
</html>