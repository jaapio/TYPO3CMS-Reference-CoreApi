<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
                    <title>phpDocumentor</title>
    

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <base href="../../../../">
    <link rel="icon" href="images/favicon.ico"/>
    <link rel="stylesheet" href="css/normalize.css">
    <link rel="stylesheet" href="css/base.css">
            <link rel="preconnect" href="https://fonts.gstatic.com">
        <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@100;200;300;400;600;700&display=swap" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:wght@400;600;700&display=swap" rel="stylesheet">
        <link rel="stylesheet" href="css/template.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0/css/all.min.css" integrity="sha256-ybRkN9dBjhcS2qrW1z+hfCxq+1aBdwyQM5wlQoQVt/0=" crossorigin="anonymous" />
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/themes/prism-okaidia.css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/plugins/line-numbers/prism-line-numbers.css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/plugins/line-highlight/prism-line-highlight.css">
                <script src="https://cdn.jsdelivr.net/npm/fuse.js@3.4.6"></script>
        <script src="https://cdn.jsdelivr.net/npm/css-vars-ponyfill@2"></script>
        <script src="js/template.js"></script>
        <script src="js/search.js"></script>
        <script defer src="js/searchIndex.js"></script>
    </head>
<body id="top">
    <header class="phpdocumentor-header phpdocumentor-section">
    <h1 class="phpdocumentor-title"><a href="" class="phpdocumentor-title__link">phpDocumentor</a></h1>
    <input class="phpdocumentor-header__menu-button" type="checkbox" id="menu-button" name="menu-button" />
    <label class="phpdocumentor-header__menu-icon" for="menu-button">
        <i class="fas fa-bars"></i>
    </label>
    <section data-search-form class="phpdocumentor-search">
    <label>
        <span class="visually-hidden">Search for</span>
        <svg class="phpdocumentor-search__icon" width="21" height="20" viewBox="0 0 21 20" fill="none" xmlns="http://www.w3.org/2000/svg">
            <circle cx="7.5" cy="7.5" r="6.5" stroke="currentColor" stroke-width="2"/>
            <line x1="12.4892" y1="12.2727" x2="19.1559" y2="18.9393" stroke="currentColor" stroke-width="3"/>
        </svg>
        <input type="search" class="phpdocumentor-field phpdocumentor-search__field" placeholder="Loading .." disabled />
    </label>
</section>

    <nav class="phpdocumentor-topnav">
    <ul class="phpdocumentor-topnav__menu">
        </ul>
</nav>
</header>

    <main class="phpdocumentor">
        <div class="phpdocumentor-section">
            <input class="phpdocumentor-sidebar__menu-button" type="checkbox" id="sidebar-button" name="sidebar-button" />
<label class="phpdocumentor-sidebar__menu-icon" for="sidebar-button">
    Menu
</label>
<aside class="phpdocumentor-column -three phpdocumentor-sidebar">
                    <section class="phpdocumentor-sidebar__category">
            <h2 class="phpdocumentor-sidebar__category-header">typo3-explained</h2>
                                    <h4 class="phpdocumentor-sidebar__root-namespace">
    <a href="guide/Introduction/Index.html#introduction" class="">Introduction</a>
</h4>
    <ul class="phpdocumentor-list">
                    <li>
                <a href="guide/Introduction/Index.html#system-overview-1" class="">System Overview</a>
                
            </li>
                    <li>
                <a href="guide/Introduction/Index.html#a-basic-installation" class="">A basic installation</a>
                
            </li>
            </ul>

                                    <h4 class="phpdocumentor-sidebar__root-namespace">
    <a href="guide/ApiOverview/Index.html#api-a-z" class="">API A-Z</a>
</h4>

                                    <h4 class="phpdocumentor-sidebar__root-namespace">
    <a href="guide/CodingGuidelines/Index.html#cgl" class="">Coding Guidelines</a>
</h4>
    <ul class="phpdocumentor-list">
                    <li>
                <a href="guide/CodingGuidelines/Introduction.html#cgl-introduction" class="">Introduction</a>
                
            </li>
                    <li>
                <a href="guide/CodingGuidelines/CglPhp/Index.html#cgl-php" class="">PHP Coding Guidelines</a>
                
            </li>
                    <li>
                <a href="guide/CodingGuidelines/CglJavaScript/Index.html#cgl-javascript" class="">JavaScript Coding Guidelines</a>
                
            </li>
                    <li>
                <a href="guide/CodingGuidelines/CglTypeScript/Index.html#cgl-typescript" class="">TypeScript Coding Guidelines</a>
                
            </li>
                    <li>
                <a href="guide/CodingGuidelines/CglTypoScript/Index.html#cgl-typoscript" class="">TypoScript Coding Guidelines</a>
                
            </li>
                    <li>
                <a href="guide/CodingGuidelines/CglTsConfig.html#cgl-tsconfig" class="">TSconfig Coding Guidelines</a>
                
            </li>
                    <li>
                <a href="guide/CodingGuidelines/CglXliff/Index.html#cgl-xliff" class="">Xliff Coding Guidelines</a>
                
            </li>
                    <li>
                <a href="guide/CodingGuidelines/CglYaml.html#cgl-yaml" class="">Yaml Coding Guidelines</a>
                
            </li>
                    <li>
                <a href="guide/CodingGuidelines/CglRest/Index.html#cgl-rest" class="">reStructuredText (reST)</a>
                
            </li>
            </ul>

                                    <h4 class="phpdocumentor-sidebar__root-namespace">
    <a href="guide/Configuration/Index.html#configuration" class="">Configuration</a>
</h4>
    <ul class="phpdocumentor-list">
                    <li>
                <a href="guide/Configuration/ConfigurationOverview.html#config-overview" class="">Configuration overview</a>
                
            </li>
                    <li>
                <a href="guide/Configuration/Glossary.html#configuration-classification" class="">Glossary</a>
                
            </li>
                    <li>
                <a href="guide/Configuration/ConfigurationFiles.html#configuration-files" class="">Configuration files</a>
                
            </li>
                    <li>
                <a href="guide/Configuration/ConfigurationModule/Index.html#configuration-module" class="">Configuration module</a>
                
            </li>
                    <li>
                <a href="guide/Configuration/FeatureToggles.html#feature-toggles" class="">Feature toggles</a>
                
            </li>
                    <li>
                <a href="guide/Configuration/GlobalVariables.html#globals-variables" class="">$GLOBALS</a>
                
            </li>
                    <li>
                <a href="guide/Configuration/Typo3ConfVars/Index.html#typo3-conf-vars" class="">TYPO3_CONF_VARS</a>
                
            </li>
                    <li>
                <a href="guide/Configuration/Typo3Information.html#typo3Information" class="">Global meta information about TYPO3</a>
                
            </li>
                    <li>
                <a href="guide/Configuration/Tsconfig.html#tsconfig" class="">TSconfig</a>
                
            </li>
                    <li>
                <a href="guide/Configuration/TypoScriptSyntax/Index.html#typoscript-syntax-about" class="">TypoScript syntax</a>
                
            </li>
                    <li>
                <a href="guide/Configuration/UserSettingsConfiguration/Index.html#user-settings" class="">User settings configuration</a>
                
            </li>
                    <li>
                <a href="guide/Configuration/Yaml/Index.html#yaml" class="">YAML</a>
                
            </li>
            </ul>

                                    <h4 class="phpdocumentor-sidebar__root-namespace">
    <a href="guide/ExtensionArchitecture/Index.html#extension-development" class="">Extension development</a>
</h4>
    <ul class="phpdocumentor-list">
                    <li>
                <a href="guide/ExtensionArchitecture/Concepts/Index.html#extension-concepts" class="">Concepts</a>
                
            </li>
                    <li>
                <a href="guide/ExtensionArchitecture/FileStructure/Index.html#extension-reserved-folders-legacy" class="">File structure</a>
                
            </li>
                    <li>
                <a href="guide/ExtensionArchitecture/HowTo/Index.html#extension-howto" class="">Howto</a>
                
            </li>
                    <li>
                <a href="guide/ExtensionArchitecture/Extbase/Index.html#extbase" class="">Extbase</a>
                
            </li>
                    <li>
                <a href="guide/ExtensionArchitecture/BestPractises/Index.html#extension-Best-practises" class="">Best practises and conventions</a>
                
            </li>
                    <li>
                <a href="guide/ExtensionArchitecture/Tutorials/Index.html#extension-tutorials" class="">Tutorials</a>
                
            </li>
            </ul>

                                    <h4 class="phpdocumentor-sidebar__root-namespace">
    <a href="guide/Security/Index.html#security" class="">Security guidelines</a>
</h4>
    <ul class="phpdocumentor-list">
                    <li>
                <a href="guide/Security/Introduction/Index.html#security-introduction" class="">Introduction</a>
                
            </li>
                    <li>
                <a href="guide/Security/SecurityTeam/Index.html#security-team" class="">The TYPO3 Security Team</a>
                
            </li>
                    <li>
                <a href="guide/Security/GeneralInformation/Index.html#security-general-information" class="">General Information</a>
                
            </li>
                    <li>
                <a href="guide/Security/TypesOfThreats/Index.html#security-threats" class="">Types of Security Threats</a>
                
            </li>
                    <li>
                <a href="guide/Security/GeneralGuidelines/Index.html#security-general-guidelines" class="">General guidelines</a>
                
            </li>
                    <li>
                <a href="guide/Security/GuidelinesAdministrators/Index.html#security-administrators" class="">Guidelines for System Administrators</a>
                
            </li>
                    <li>
                <a href="guide/Security/GuidelinesExtensionDevelopment/Index.html#security-extension-development" class="">Guidelines for extension development</a>
                
            </li>
                    <li>
                <a href="guide/Security/GuidelinesIntegrators/Index.html#security-integrators" class="">Guidelines for TYPO3 integrators</a>
                
            </li>
                    <li>
                <a href="guide/Security/GuidelinesEditors/Index.html#security-editors" class="">Guidelines for editors</a>
                
            </li>
                    <li>
                <a href="guide/Security/Backups/Index.html#security-backups" class="">Backup strategy</a>
                
            </li>
                    <li>
                <a href="guide/Security/HackedSite/Index.html#security-detect-analyze-repair" class="">Detect, analyze and repair a hacked site</a>
                
            </li>
            </ul>

                                    <h4 class="phpdocumentor-sidebar__root-namespace">
    <a href="guide/Testing/Index.html#testing" class="">Testing</a>
</h4>
    <ul class="phpdocumentor-list">
                    <li>
                <a href="guide/Testing/History.html#testing-history" class="">History</a>
                
            </li>
                    <li>
                <a href="guide/Testing/CoreTesting.html#testing-core" class="">Core testing</a>
                
            </li>
                    <li>
                <a href="guide/Testing/ExtensionTesting.html#testing-extensions" class="">Extension testing</a>
                
            </li>
                    <li>
                <a href="guide/Testing/ProjectTesting.html#testing-projects" class="">Project testing</a>
                
            </li>
                    <li>
                <a href="guide/Testing/WritingUnit.html#testing-writing-unit" class="">Writing unit tests</a>
                
            </li>
                    <li>
                <a href="guide/Testing/WritingFunctional.html#testing-writing-functional" class="">Writing functional tests</a>
                
            </li>
                    <li>
                <a href="guide/Testing/WritingAcceptance.html#testing-writing-acceptance" class="">Writing acceptance tests</a>
                
            </li>
                    <li>
                <a href="guide/Testing/Faq.html#testing-faq" class="">FAQ</a>
                
            </li>
            </ul>

                                    <h4 class="phpdocumentor-sidebar__root-namespace">
    <a href="guide/About.html#about" class="">About This Manual</a>
</h4>
    <ul class="phpdocumentor-list">
                    <li>
                <a href="guide/About.html#intended-audience" class="">Intended Audience</a>
                
            </li>
                    <li>
                <a href="guide/About.html#code-examples-1" class="">Code examples</a>
                
            </li>
                    <li>
                <a href="guide/About.html#feedback-and-contribute" class="">Feedback and Contribute</a>
                
            </li>
                    <li>
                <a href="guide/About.html#credits-1" class="">Credits</a>
                
            </li>
                    <li>
                <a href="guide/About.html#dedication-1" class="">Dedication</a>
                
            </li>
            </ul>

                                    <h4 class="phpdocumentor-sidebar__root-namespace">
    <a href="guide/Sitemap.html#sitemap" class="">Sitemap</a>
</h4>

                                    <h4 class="phpdocumentor-sidebar__root-namespace">
    <a href="guide/genindex.html#index" class="">Index</a>
</h4>

                        </section>
            
    <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Reports</h2>
                <h3 class="phpdocumentor-sidebar__root-package"><a href="reports/deprecated.html">Deprecated</a></h3>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="reports/errors.html">Errors</a></h3>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="reports/markers.html">Markers</a></h3>
    </section>

    <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Indices</h2>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="indices/files.html">Files</a></h3>
    </section>
</aside>

            <div class="phpdocumentor-column -nine phpdocumentor-content">
                                        <section>
        
<div class="section" id="cgl-working-with-exceptions">
    <h1>Working With Exceptions</h1>
    </div>
<div class="section" id="introduction">
    <h1>Introduction</h1>
            <p>Working with exceptions in a sane way is a frequently asked topic. This
section aims to give some good advice on how to deal with exceptions in
TYPO3 world and especially which types of exceptions should be thrown
under which circumstances.</p>
            <p>First of, exceptions are a good thing - there is nothing bad with
throwing them. It is often better to throw an exception than to return
a “mixed” return value from a method to signal that something went
wrong. TYPO3 has a tradition of methods that return either an expected
result set - for instance an array - or alternatively a boolean false
on error. This is often confusing for callers and developers tend to
forget to implement proper error handling for such “false was returned”
cases. This easily leads to hard to track problems. It is often a much
better choice to throw an exception if something went wrong: This gives
the chance to throw a meaningful message directly to the developer or to
a log file for later analysis. Additionally, an exception usually comes
along with a backtrace.</p>
    </div>
<div class="section" id="exception-types">
    <h1>Exception Types</h1>
            <p>Exceptions are a good thing, but how to decide on what to throw exactly?
The basic idea is\RuntimeException fits - it is much more important
to throw a meaningful exception message in those cases.</p>
            <div class="section" id="typical-cases-for-exceptions-that-are-designed-to-be-caught">
    <h2>Typical Cases for Exceptions That are Designed to be Caught</h2>
            

<ul>
    <li><p>Race conditions than can be created by editors in a normal workflow:</p>

<ul>
    <li>Editor 1 calls list module and a record is shown.</li>
    <li>Editor 2 deletes this record.</li>
    <li>Editor 1 clicks the link to open this deleted record.</li>
    <li>The code throws a catchable, specific named exception that is turned
into a localized error message shown to the user &quot;The record 12
from table tt_content you tried to open has been deleted …&quot;.</li>
</ul></li>
    <li>Temporary issues: Updating the extension list in the Extension Manager
fails because of a network issue - The code throws a catchable, named
exception that is turned into a localized error message shown to the
user &quot;Can not connect to update servers, please check internet
connection …&quot;.</li>
</ul>
    </div>
            <div class="section" id="typical-cases-for-exceptions-that-should-not-be-caught">
    <h2>Typical Cases for Exceptions That Should not be Caught</h2>
            

<ul>
    <li>Wrong configurationtype=inline field.
At the time of this writing, this case was not implemented, so the
code checks for this case and throws a top-level PHP built-in
exception (\RuntimeException in this case) to point developers
to an invalid configuration scenario.</li>
    <li>Programming error/ wrong API usage\RuntimeException should be thrown.</li>
</ul>
    </div>
    </div>
<div class="section" id="typical-exception-arguments">
    <h1>Typical Exception Arguments</h1>
            <p>The standard exception signature:</p>
            <pre><code class="language-php">public function __construct($message = &quot;&quot;, $code = 0, Exception $previous = null) { }</code></pre>
            <p>TYPO3 typically uses a meaningful exception message and a unique code.
Uniqueness of $code is created by using a UNIX timestamp of now
(the time when the exception is created)date +%s. The resulting
number of this command should be directly used as the exception code and never changed again.</p>
            <p>Throwing a meaningful message is important especially if top-level exceptions
are thrown. A developer receiving this exception should get all useful
data that can help to debug and mitigate the issue.</p>
            <p>Example:</p>
            <pre><code class="language-php">use Vendor\SomeExtension\File\FileNotAccessibleException;
use Vendor\SomeExtension\File\FileNotFoundException;

// ...

if ($pid === 0) {
    throw new \RuntimeException(&#039;The page &quot;&#039; . $pid . &#039;&quot; cannot be accessed.&#039;, 1548145665);
}

$absoluteFilePath = GeneralUtility::getFileAbsFileName($filePath);

if (is_file($absoluteFilePath)) {
    $file = fopen($absoluteFilePath, &#039;rb&#039;);
} else {
    // prefer speaking exception names, add custom exceptions if necessary
    throw new FileNotFoundException(&#039;File &quot;&#039; . $absoluteFilePath . &#039;&quot; does not exist.&#039;, 1548145672);
}

if ($file == null) {
    throw new FileNotAccessibleException(&#039;File &quot;&#039; . $absoluteFilePath . &#039;&quot; cannot be read.&#039;, 1548145672);
}</code></pre>
    </div>
<div class="section" id="exception-inheritance">
    <h1>Exception Inheritance</h1>
            <p>A typical exception hierarchy for specific exceptions in the Core
looks like Vendor\SomeExtension\Exception extends TYPO3\CMS\Core\Exception,
where TYPO3\CMS\Core\Exception is the base of all exceptions in TYPO3.</p>
            <p>Building on that you can have Vendor\MyExt\Exception\AFunctionality\ASpecificException extends
Vendor\MyExt\Exception for more specific exceptions. All of your exceptions
should extend your extension-specific base exception.</p>
            <p>So, as rule:
As soon as multiple different specific exceptions are thrown within
some extension, there should be a generic base exception within the extension
that is not thrown itself, and the specific exceptions that are thrown
then extend from this class.</p>
            <p>Typically, only the specific exceptions are
caught however. In general, the inheritance hierarchy shouldn’t be
extended much deeper and should be kept relatively flat.</p>
    </div>
<div class="section" id="extending-exceptions">
    <h1>Extending Exceptions</h1>
            <p>It can become handy to extend exceptions in order to transport further
data to the code that catches the exception. This can be useful if an
exception is caught and transformed into a localized flash message or
a notification. Typically, those additional pieces of information
should be added as additional constructor arguments:</p>
            <pre><code class="language-php">public function __construct($message = &quot;&quot;, $code = 0, Exception $previous = null,
            string $additionalArgument, int $anotherArgument)</code></pre>
            <p>There should be getters for those additional data parts within the
exception class. Enriching an exception with additional data should not
happen with setter methods: Exceptions have a characteristica similar
to “value objects” that should not be changed. Having setters would
spoil this idea: Once thrown, exceptions should be immutable, thus the
only way to add data is by handing it over as constructor arguments.</p>
    </div>
<div class="section" id="good-examples">
    <h1>Good Examples</h1>
            

<ul>
    <li><p>\TYPO3\CMS\Backend\Form\FormDataProvider\AbstractDatabaseRecordProvider,
\TYPO3\CMS\Backend\Form\FormDataProvider\DatabaseEditRow,
\TYPO3\CMS\Backend\Form\Exception\DatabaseRecordException,
\TYPO3\CMS\Backend\Form\FormDataProvider\TcaInline</p>

<ul>
    <li>ScenarioDatabaseEditRow may throw a DatabaseRecordException
if the record to open has been deleted meanwhile. This can happen
in inline scenarios, so the TcaInline data provider catches this
exception.</li>
    <li>Good: Next to a meaningful exception message, the exception is
enriched with the table name and the uid it was handling in
:php:`__construct()` to hand over further useful information to the
catching code.</li>
    <li>Good: The catching code catches this specific exception, uses the
getters of the exception to get the additional data and creates a
localized error message from it that is enriched with further data
that only the catching code knows.</li>
    <li>GoodBackend\Form\Exception which itself extends
from Backend\Exception which extends \Exception.
The Backend\Form\Exception could have been left out, but
since the backend extension is so huge, the author decided to have
this additional class layer in between.</li>
    <li>Good@throws annotations to hint
IDEs like PhpStorm that an exception may be received using that
method.</li>
    <li>BadDatabaseRecordVanishedException or similar.</li>
</ul></li>
    <li><p>\TYPO3\CMS\Backend\Form\FormDataProvider\AbstractDatabaseRecordProvider</p>

<ul>
    <li>GoodgetRecordFromDatabase() throws exceptions at
four different places with only one of them being catchable
(DatabaseRecordException) and the other three being
top-level PHP built-in exceptions that indicate a developer/ code
usage error.</li>
    <li>Bad: The generic exception messages could be more verbose and
explain in more detail on what went wrong.</li>
</ul></li>
</ul>
    </div>
<div class="section" id="bad-examples">
    <h1>Bad Examples</h1>
            

<ul>
    <li><p>TYPO3\CMS\Core\Resource\FileRepository method findFileReferenceByUid()</p>

<ul>
    <li><p>Bad: The top-level PHP built-in is caught.</p><p>This is not a good idea
and indicates something is wrong in the code that may throw this
exception. A specific exception should be caught here only.</p></li>
    <li><p>Bad\RuntimeException.</p><p>This may hide more serious
failures from an underlying library that should better have been
bubbling up. The same holds for \Exception.</p></li>
    <li><p>Bad: Catching this exception is used to change the return value of
the method to false.</p><p>This would make it a method that returns multiple different types.</p></li>
</ul></li>
</ul>
            <div class="section" id="further-readings">
    <h2>Further readings</h2>
            <p>See <a href="https://blogs.msdn.microsoft.com/kcwalina/2007/01/30/how-to-design-exception-hierarchies/">https://blogs.msdn.microsoft.com/kcwalina/2007/01/30/how-to-design-exception-hierarchies/</a>.</p>
    </div>
    </div>

    </section>
                            </div>
            <section data-search-results class="phpdocumentor-search-results phpdocumentor-search-results--hidden">
    <section class="phpdocumentor-search-results__dialog">
        <header class="phpdocumentor-search-results__header">
            <h2 class="phpdocumentor-search-results__title">Search results</h2>
            <button class="phpdocumentor-search-results__close"><i class="fas fa-times"></i></button>
        </header>
        <section class="phpdocumentor-search-results__body">
            <ul class="phpdocumentor-search-results__entries"></ul>
        </section>
    </section>
</section>
        </div>
        <a href="guide/CodingGuidelines/CglPhp/PhpArchitecture/WorkingWithExceptions.html#top" class="phpdocumentor-back-to-top"><i class="fas fa-chevron-circle-up"></i></a>

    </main>

    <script>
        cssVars({});
    </script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/prism.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/plugins/line-numbers/prism-line-numbers.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/plugins/line-highlight/prism-line-highlight.min.js"></script>
</body>
</html>